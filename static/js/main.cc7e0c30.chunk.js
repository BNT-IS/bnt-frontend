(this["webpackJsonpbnt-frontend"]=this["webpackJsonpbnt-frontend"]||[]).push([[0],{10:function(e,t){e.exports={BACKEND_BASE_URI:"http://localhost:3000",INFURA_URI:"https://mainnet.infura.io/v3/efaece4f5f4443979063839c124c8171",IDB_NAME:"TicketMirror"}},219:function(e,t,a){},256:function(e,t,a){e.exports=a(521)},261:function(e,t,a){},263:function(e,t,a){},278:function(e,t){},303:function(e,t){},305:function(e,t){},349:function(e,t){},351:function(e,t){},380:function(e,t){},488:function(e,t,a){},512:function(e,t,a){},521:function(e,t,a){"use strict";a.r(t);var n=a(0),r=a.n(n),i=a(47),s=a.n(i),c=a(23),o=(a(261),a(3)),l=a.n(o),u=a(5),h=a(6),d=a(7),m=a(2),p=a(8),g=a(9),k=(a(263),r.a.createContext()),f=a(31),b=a(535),v=a(144),E=a(547),S=a(253),y=a(548),w=a(10),T=a.n(w),O=function(e){Object(p.a)(a,e);var t=Object(g.a)(a);function a(e){var n;return Object(h.a)(this,a),(n=t.call(this,e)).createUser=n.createUser.bind(Object(m.a)(n)),n.login=n.login.bind(Object(m.a)(n)),n.loginPassHandler=n.loginPassHandler.bind(Object(m.a)(n)),n.mailHandler=n.mailHandler.bind(Object(m.a)(n)),n.otpBest\u00e4tigen=n.otpBest\u00e4tigen.bind(Object(m.a)(n)),n.otpInputHandler=n.otpInputHandler.bind(Object(m.a)(n)),n.pass1Handler=n.pass1Handler.bind(Object(m.a)(n)),n.pass2Handler=n.pass2Handler.bind(Object(m.a)(n)),n.setState0=n.setState0.bind(Object(m.a)(n)),n.setState1=n.setState1.bind(Object(m.a)(n)),n.setState6=n.setState6.bind(Object(m.a)(n)),n.state={dhbw_mail:"",login_pass:"",new_pass:"",otp:"",pass1:"",pass2:"",step:0,access_token:""},n.tokenHandler=n.tokenHandler.bind(Object(m.a)(n)),n.verifyPasswort=n.verifyPasswort.bind(Object(m.a)(n)),n}return Object(d.a)(a,[{key:"componentDidUpdate",value:function(){this.context.user&&this.context.redirectUserToHome()}},{key:"otpInputHandler",value:function(e){this.setState({otp:e.target.value})}},{key:"tokenHandler",value:function(e){this.setState({access_token:e.target.value})}},{key:"otpBest\xe4tigen",value:function(){console.log(this.state.otp),this.setState({step:2})}},{key:"pass1Handler",value:function(e){this.setState({pass1:e.target.value})}},{key:"pass2Handler",value:function(e){this.setState({pass2:e.target.value})}},{key:"mailHandler",value:function(e){this.setState({dhbw_mail:e.target.value})}},{key:"loginPassHandler",value:function(e){this.setState({login_pass:e.target.value})}},{key:"verifyPasswort",value:function(){this.state.pass1===this.state.pass2?(alert("Die angegebenen Passw\xf6rter stimmen \xfcberein!"),this.createUser(this.state.pass2)):(alert("Die angegebenen Passw\xf6rter stimmen nicht \xfcberein!"),this.setState({pass1:""}),this.setState({pass2:""}))}},{key:"displayError",value:function(){alert("Ups, das hat leider nicht funktioniert. Bitte versuchen Sie es erneut.")}},{key:"createUser",value:function(){var e=Object(u.a)(l.a.mark((function e(t){var a,n,r;return l.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,fetch(T.a.BACKEND_BASE_URI+"/auth/createUser/"+this.state.otp,{method:"POST",mode:"cors",cache:"no-cache",headers:{"Content-Type":"application/json"},body:JSON.stringify({newPassword:t})}).catch(console.log);case 2:if((a=e.sent).ok){e.next=12;break}return alert("F\xfcr das eingegebene OTP konnte kein User angelegt werden."),e.next=7,a.json().catch(console.log);case 7:return(n=e.sent).message&&(alert(n.message+" Ihr angegebenes OTP scheint nicht zu exisitieren. Bitte \xfcberpr\xfcfen Sie die Eingabe."),this.setState({step:1})),e.abrupt("return");case 12:return e.next=14,a.json().catch(console.log);case 14:(r=e.sent)&&(alert("Der Nutzer wurde erfolgreich angelegt."),this.handleFinalLogin(r));case 16:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"login",value:function(){var e=Object(u.a)(l.a.mark((function e(){var t,a,n;return l.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,fetch(T.a.BACKEND_BASE_URI+"/auth/login",{method:"POST",mose:"cors",cache:"no-cache",headers:{"Content-Type":"application/json"},body:JSON.stringify({email:this.state.dhbw_mail,password:this.state.login_pass})}).catch(console.log);case 2:if((t=e.sent).ok){e.next=19;break}return e.next=6,t.json().catch(console.log);case 6:a=e.sent,e.t0=t.status,e.next=401===e.t0?10:500===e.t0?12:14;break;case 10:return alert("Ihre Anmeldedaten scheinen nicht zu stimmen. Bitte \xfcberpr\xfcfen Sie ihre Angaben."),e.abrupt("break",15);case 12:return alert("Die Anmeldung ist aufgrund eines Server-Fehlers fehlgeschlagen. Bitte versuchen Sie es sp\xe4ter erneut."),e.abrupt("break",15);case 14:alert(a.message);case 15:return this.setState({step:6}),e.abrupt("return");case 19:return e.next=21,t.json().catch(console.log);case 21:(n=e.sent)&&this.handleFinalLogin(n);case 23:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"handleFinalLogin",value:function(e){this.context.setUserContext(e),this.context.redirectUserToHome()}},{key:"setState0",value:function(){this.setState({step:0})}},{key:"setState1",value:function(){this.setState({step:1})}},{key:"setState6",value:function(){this.setState({step:6})}},{key:"render",value:function(){return r.a.createElement(f.a,{className:"AccountManagement",gap:"small"},r.a.createElement(b.a,{background:"brand",justify:"between",pad:"10px"},r.a.createElement(v.a,null,r.a.createElement("a",{style:{textDecoration:"none",color:"white"},href:"./"},"BNT Ticketsystem"))),r.a.createElement(f.a,{pad:"small"},0===this.state.step&&r.a.createElement(f.a,{gap:"small"},r.a.createElement(E.a,null,"Login"),r.a.createElement(v.a,null,"Klicke hier, um einen neuen Account anzulegen"),r.a.createElement(S.a,{label:"Neuen Account anlegen",gap:"small",onClick:this.setState1}),r.a.createElement(v.a,null,"Klicke hier, um dich mit einem bestehenden Account anzumelden"),r.a.createElement(S.a,{label:"Mit bestehendem Account anmelden",onClick:this.setState6})),1===this.state.step&&r.a.createElement(f.a,{gap:"small"},r.a.createElement(E.a,null,"Angabe des Einmal-Passworts"),r.a.createElement(v.a,null,"Bitte geben Sie das OneTime-Passwort ein, das wir an Ihre DHBW-Mailadresse versendet haben, und best\xe4tigen Sie die Eingabe"),r.a.createElement(y.a,{placeholder:"OTP eingeben",value:this.state.otp,onChange:this.otpInputHandler}),r.a.createElement(S.a,{label:"Eingabe best\xe4tigen",onClick:this.otpBest\u00e4tigen}),r.a.createElement(S.a,{label:"Zur\xfcck zur \xdcbersicht",onClick:this.setState0})),2===this.state.step&&r.a.createElement(f.a,{classname:"Passwortvergabe",direction:"column",gap:"small"},r.a.createElement(E.a,null,"Passwortvergabe"),r.a.createElement(v.a,null,"Bitte vergeben Sie ein neues Passwort f\xfcr Ihren Account"),r.a.createElement(y.a,{placeholder:"Neues Passwort vergeben",value:this.state.pass1,onChange:this.pass1Handler}),r.a.createElement(y.a,{placeholder:"Neues Passwort best\xe4tigen",value:this.state.pass2,onChange:this.pass2Handler}),r.a.createElement(S.a,{label:"Passwort best\xe4tigen",onClick:this.verifyPasswort})),6===this.state.step&&r.a.createElement(f.a,{gap:"small"},r.a.createElement(E.a,null,"Anmeldung mit einem vorhandenen Account"),r.a.createElement(y.a,{placeholder:"DHBW-Mailadresse eingeben",value:this.state.dhbw_mail,onChange:this.mailHandler}),r.a.createElement(y.a,{placeholder:"Account-Passwort eingeben",value:this.state.login_pass,onChange:this.loginPassHandler}),r.a.createElement(S.a,{label:"Anmelden",onClick:this.login}),r.a.createElement(S.a,{label:"Zur\xfcck zur \xdcbersicht",onClick:this.setState0}))))}}]),a}(r.a.Component);O.contextType=k;var C=O,x=a(537),P=a(544),A=function(e){Object(p.a)(a,e);var t=Object(g.a)(a);function a(e){var n;return Object(h.a)(this,a),(n=t.call(this,e)).state={},n.getConfigured=n.getConfigured.bind(Object(m.a)(n)),n}return Object(d.a)(a,[{key:"getConfigured",value:function(e){var t=this.props.statusMap.get(e);return t?t?r.a.createElement(v.a,{key:e},"Erledigt"):void 0:r.a.createElement(v.a,{key:e},"Nicht erledigt")}},{key:"render",value:function(){var e=[];return 0===this.props.initializeStep&&!1===this.props.doneOnce&&(e[0]=r.a.createElement(f.a,{pad:"medium",key:"start"},r.a.createElement(v.a,{textAlign:"center",weight:"bold",size:"xxlarge"},"Herzlich Wilkommen zum Bachelors-Night Ticketsystem."),r.a.createElement(f.a,{pad:"medium"}),r.a.createElement(v.a,null,"Die n\xe4chsten Schritte dienen zur Initalisierung des Systems. Sie werden durch die notwendigen Vorbereitungsschritte gef\xfchrt."),r.a.createElement(v.a,{textAlign:"center"},"F\xfcr die Initalisierung sind folgende Schritte notwendig"))),(7===this.props.initializeStep||this.props.doneOnce)&&(e[0]=r.a.createElement(f.a,{pad:"medium",key:"end"},r.a.createElement(v.a,{weight:"bold",size:"xxlarge",textAlign:"center"},"Konfiguration abgeschlossen"),r.a.createElement(f.a,{pad:"medium"}),r.a.createElement(v.a,{textAlign:"center"},'Herzlich Gl\xfcckwunsch Sie haben das Ticketsystem erfolgreich konfiguriert! Mit "Zur\xfcck" gelangen Sie wieder zur ersten Ansicht und k\xf6nnen erneut durch die Konfiguration navigieren. Mit "Initalisierung abschlie\xdfen" k\xf6nnen Sie zur Login-Seite zur\xfcck.'))),e[1]=r.a.createElement(f.a,null,r.a.createElement(x.a,{primaryKey:"initializeStep",secondaryKey:"doneSteps",data:[{initializeStep:r.a.createElement(v.a,{size:"large",weight:"bold",key:"header"},"Vorbereitsungsschritt"),doneSteps:r.a.createElement(v.a,{size:"large",weight:"bold",key:"headerZustand"},"Zustand")},{initializeStep:r.a.createElement(v.a,{weight:"normal",key:"StatusDB"}," Initalisieren der Datenbank"),doneSteps:this.getConfigured("DB")},{initializeStep:r.a.createElement(v.a,{weight:"normal",key:"StatusAdminAccount"},"Hinzuf\xfcgen eines Administratorbenutzers"),doneSteps:this.getConfigured("AA")},{initializeStep:r.a.createElement(v.a,{weight:"normal",key:"StatusMS"},"Initialisieren des Mailservers"),doneSteps:this.getConfigured("MS")},{initializeStep:r.a.createElement(v.a,{weight:"normal",key:"StatusAdminWallet"},"Einrichten des Master-Wallets"),doneSteps:this.getConfigured("AW")},{initializeStep:r.a.createElement(v.a,{weight:"normal",key:"StatusSmartContract"},"Ver\xf6ffentlichen des Smart Contracts"),doneSteps:this.getConfigured("DC")},{initializeStep:r.a.createElement(v.a,{weight:"normal",key:"StatusShopConfig"},"Anzahl der Pl\xe4tze, Tickets und VIP-Pl\xe4tze festlegen"),doneSteps:this.getConfigured("SC")}]})),e}}]),a}(r.a.Component),B=function(e){Object(p.a)(a,e);var t=Object(g.a)(a);function a(e){var n;return Object(h.a)(this,a),(n=t.call(this,e)).state={httpProvider:"",created:!1,deploymentPrice:""},n.configureTheAdminWallet=n.configureTheAdminWallet.bind(Object(m.a)(n)),n}return Object(d.a)(a,[{key:"configureTheAdminWallet",value:function(){var e=Object(u.a)(l.a.mark((function e(){var t,a,n;return l.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,fetch(T.a.BACKEND_BASE_URI+"/setup/generateWallet",{method:"POST",mode:"cors",cache:"no-cache",headers:{"Content-Type":"application/json"},body:JSON.stringify({http_provider:this.state.httpProvider})}).catch(console.log);case 2:if((t=e.sent).ok){e.next=8;break}return e.next=6,t.json().catch(console.log);case 6:a=e.sent,alert(a.message);case 8:if(!t.ok){e.next=19;break}return console.log(t),e.next=12,t.json().catch(console.log);case 12:n=e.sent,this.props.setWalletAddress(n.wallet_address),this.props.changeValueOfStatusMap("AW"),this.props.changeValueOfGasprices("deployContract",n.price_deployment),this.setState({deploymentPrice:n.price_deployment}),this.setState({created:!0}),this.props.setHttpProvider(this.state.httpProvider);case 19:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"render",value:function(){var e=this,t=[];return this.state.created||(t=r.a.createElement(f.a,null,r.a.createElement(f.a,{pad:"medium"}),r.a.createElement(v.a,{weight:"bold",size:"xxlarge",align:"center"},"Hinzuf\xfcgen des Wallets f\xfcr den Master-User"),r.a.createElement(f.a,{pad:"medium"}),r.a.createElement(f.a,{pad:"medium"},r.a.createElement(y.a,{placeholder:"HTTP-Provider DNS:Port",value:this.state.httpProvider,onChange:function(t){e.setState({httpProvider:t.target.value})}})),r.a.createElement(S.a,{onClick:this.configureTheAdminWallet,label:"Hinzuf\xfcgen"}))),this.state.created&&(t=r.a.createElement(f.a,null,r.a.createElement(f.a,{pad:"medium"},r.a.createElement(v.a,{size:"large",weight:"bold"},"Hinzuf\xfcgen des Wallets f\xfcr den Master-User:")),r.a.createElement(f.a,{pad:"medium"},r.a.createElement(v.a,null,"Die Einrichtung wurde Erfolgreich abgeschlossen. F\xfcr die Ver\xf6ffentlichung des Smart Contracts wird"),r.a.createElement(f.a,{pad:"medium"}),r.a.createElement(v.a,{weight:"bold",size:"xxlarge",align:"center"},"Ethereum: ",this.state.deploymentPrice),r.a.createElement(v.a,null,"ben\xf6tigt."),r.a.createElement(f.a,{pad:"medium"}),r.a.createElement(v.a,null,"Im n\xe4chsten Schritt wird zus\xe4tzlich noch eine geringe Menge Ethereum f\xfcr die Erstellung eines Testtickets ben\xf6tigt."),r.a.createElement(v.a,null,"Laden Sie daher etwas mehr Ethereum in das Wallet!")),r.a.createElement(S.a,{label:"Guthaben aufgeladen",onClick:this.props.changeStep}))),t}}]),a}(r.a.Component),j=function(e){Object(p.a)(n,e);var t=Object(g.a)(n);function n(e){var a;return Object(h.a)(this,n),(a=t.call(this,e)).state={walletBalance:"",deployed:!1},a.getBalanceFromWallet=a.getBalanceFromWallet.bind(Object(m.a)(a)),a.checkBalancesAndExecute=a.checkBalancesAndExecute.bind(Object(m.a)(a)),a}return Object(d.a)(n,[{key:"componentDidMount",value:function(){this.getBalanceFromWallet()}},{key:"getBalanceFromWallet",value:function(){var e=Object(u.a)(l.a.mark((function e(){var t,n,r=this;return l.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:""!==this.props.httpProvider||""!==this.props.walletAddress?(t=a(135),n=new t(new t.providers.HttpProvider(this.props.httpProvider)),console.log(t),n.eth.getBalance(this.props.walletAddress,(function(e,t){if(console.log(t),e)console.log(e);else{if(!t)return console.log("Fehler beim Abruf der Balance des Wallets"),void alert(t.message);if(t){var a=n.utils.fromWei(t,"ether");console.log(a),r.setState({walletBalance:a})}}}))):alert("Fehler beim Abruf des Guthabens mit den Daten: ");case 1:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"checkBalancesAndExecute",value:function(){this.getBalanceFromWallet(),console.log(this.state.walletBalance),console.log(this.props.getValueOfGasPrices("deployContract")),this.state.walletBalance>this.props.getValueOfGasPrices("deployContract")?(this.deploySmartContract(),console.log("Deployment Done")):this.state.walletBalance<this.props.getValueOfGasPrices("deployContract")?alert("Bitte zuerst das Wallet aufladen!"):alert("Ein unbestimmter Fehler ist aufgetreten! Das Deployment konnte nicht durchgef\xfchrt werden!")}},{key:"deploySmartContract",value:function(){var e=Object(u.a)(l.a.mark((function e(){var t,a,n;return l.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,fetch(T.a.BACKEND_BASE_URI+"/setup/deployContract",{method:"POST",mode:"cors",cache:"no-cache",headers:{"Content-Type":"application/json"}}).catch(console.log);case 2:if((t=e.sent).ok){e.next=10;break}return console.log("Fehler im Deployment"),e.next=7,t.json().catch(console.log);case 7:a=e.sent,alert(a.message),console.log(a.message);case 10:if(!t.ok){e.next=19;break}return e.next=13,t.json();case 13:n=e.sent,this.props.changeValueOfGasprices("createTicket",n.create_ticket_price),this.props.changeValueOfGasprices("relinquishPlace",n.relinquish_place_price),this.props.changeValueOfStatusMap("DC"),this.setState({deployed:!0}),this.getBalanceFromWallet();case 19:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"render",value:function(){var e=[];return this.state.deployed||(e=r.a.createElement(f.a,null,r.a.createElement(f.a,{pad:"medium"}),r.a.createElement(v.a,{weight:"bold",size:"xxlarge",align:"center"},"Ver\xf6ffentlichen des Smart Contracts"),r.a.createElement(f.a,{pad:"medium"}),r.a.createElement(v.a,{weight:"bold",size:"large"},"Wallet-Daten"),r.a.createElement(v.a,null,"Die Wallet-Adresse ist: ",this.props.walletAddress),r.a.createElement(v.a,null," Das Guthaben des Wallets betr\xe4gt: ",this.state.walletBalance),r.a.createElement(f.a,{pad:"medium"}),r.a.createElement(v.a,{size:"large",weight:"bold"},"Smart Contract auf der Blockchain ver\xf6ffentlichen:"),r.a.createElement(f.a,{pad:"medium"}),r.a.createElement(S.a,{onClick:this.checkBalancesAndExecute,label:"Hinzuf\xfcgen"}))),this.state.deployed&&(e=r.a.createElement(f.a,null,r.a.createElement(v.a,null,"Der Contract wurde erfolgreich deployed."),r.a.createElement(f.a,{pad:"medium"}),r.a.createElement(v.a,null," Das Guthaben des Wallets betr\xe4gt: ",this.state.walletBalance),r.a.createElement(v.a,null," Der Preis f\xfcr die Erstellung eines Tickets betr\xe4gt: ",this.props.getValueOfGasPrices("createTicket")),r.a.createElement(v.a,null," Der Preis f\xfcr die \xdcbertragung eines Tickets betr\xe4gt: ",this.props.getValueOfGasPrices("relinquishPlace")),r.a.createElement(S.a,{onClick:this.props.changeStep,label:"Weiter"}))),e}}]),n}(r.a.Component),D=function(e){Object(p.a)(a,e);var t=Object(g.a)(a);function a(e){var n;return Object(h.a)(this,a),(n=t.call(this,e)).state={email:"",password:""},n.configureTheAdminAcc=n.configureTheAdminAcc.bind(Object(m.a)(n)),n}return Object(d.a)(a,[{key:"configureTheAdminAcc",value:function(){var e=Object(u.a)(l.a.mark((function e(){var t,a;return l.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,fetch(T.a.BACKEND_BASE_URI+"/setup/adminUser",{method:"POST",mode:"cors",cache:"no-cache",headers:{"Content-Type":"application/json"},body:JSON.stringify({email:this.state.email,password:this.state.password})}).catch(console.log);case 2:if((t=e.sent).ok){e.next=8;break}return e.next=6,t.json().catch(console.log);case 6:a=e.sent,t.ok||alert(a.message);case 8:t.ok&&(this.props.changeValueOfStatusMap("AA"),this.props.changeStep());case 9:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"render",value:function(){var e=this;return r.a.createElement(f.a,null,r.a.createElement(f.a,{pad:"medium"}),r.a.createElement(v.a,{weight:"bold",size:"xxlarge",align:"center"},"Hinzuf\xfcgen des Administratorbenutzers"),r.a.createElement(f.a,{pad:"medium"}),r.a.createElement(f.a,{pad:"medium"},r.a.createElement(v.a,{weight:"bold"},"E-Mail-Adresse"),r.a.createElement(y.a,{placeholder:"E-Mail",value:this.state.email,onChange:function(t){e.setState({email:t.target.value})}})),r.a.createElement(f.a,{pad:"medium"},r.a.createElement(v.a,{weight:"bold"},"Passwort:"),r.a.createElement(y.a,{placeholder:"Passwort",value:this.state.password,onChange:function(t){e.setState({password:t.target.value})}})),r.a.createElement(S.a,{onClick:this.configureTheAdminAcc,label:"Hinzuf\xfcgen"}))}}]),a}(r.a.Component),z=function(e){Object(p.a)(a,e);var t=Object(g.a)(a);function a(e){var n;return Object(h.a)(this,a),(n=t.call(this,e)).state={host:"",user:"",password:"",db:"",port:""},n.configureTheDatabase=n.configureTheDatabase.bind(Object(m.a)(n)),n}return Object(d.a)(a,[{key:"configureTheDatabase",value:function(){var e=Object(u.a)(l.a.mark((function e(){var t,a;return l.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,fetch(T.a.BACKEND_BASE_URI+"/setup/database",{method:"POST",mode:"cors",cache:"no-cache",headers:{"Content-Type":"application/json"},body:JSON.stringify({host:this.state.host,user:this.state.user,password:this.state.password,database:this.state.db,port:this.state.port})}).catch(console.log);case 2:if((t=e.sent).ok){e.next=8;break}return e.next=6,t.json().catch(console.log);case 6:a=e.sent,alert(a.message);case 8:t.ok&&(this.props.changeValueOfStatusMap("DB"),this.props.changeStep());case 9:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"render",value:function(){var e=this;return r.a.createElement(f.a,null,r.a.createElement(f.a,{pad:"medium"}),r.a.createElement(v.a,{weight:"bold",size:"xxlarge",align:"center"},"Konfigurieren der Datenbank"),r.a.createElement(f.a,{pad:"medium"}),r.a.createElement(f.a,{pad:"medium"},r.a.createElement(v.a,{weight:"bold"},"Datenbank-Host:"),r.a.createElement(y.a,{placeholder:"Hier bitte den Datenbank-Host eingeben",value:this.state.host,onChange:function(t){e.setState({host:t.target.value})}})),r.a.createElement(f.a,{pad:"medium"},r.a.createElement(v.a,{weight:"bold"},"Port:"),r.a.createElement(y.a,{placeholder:"Hier bitte den Port eingeben",value:this.state.port,onChange:function(t){e.setState({port:t.target.value})}})),r.a.createElement(f.a,{pad:"small"},r.a.createElement(v.a,{weight:"bold"},"Benutzer:"),r.a.createElement(y.a,{placeholder:"Hier bitte den Benutzer eingeben",value:this.state.user,onChange:function(t){e.setState({user:t.target.value})}})),r.a.createElement(f.a,{pad:"small"},r.a.createElement(v.a,{weight:"bold"},"Passwort:"),r.a.createElement(y.a,{placeholder:"Hier bitte das Passwort eingeben",value:this.state.password,onChange:function(t){e.setState({password:t.target.value})}})),r.a.createElement(f.a,{pad:"small"},r.a.createElement(v.a,{weight:"bold"}," Datenbank:"),r.a.createElement(y.a,{placeholder:"Hier bitte die Datenbank eingeben",value:this.state.db,onChange:function(t){e.setState({db:t.target.value})}})),r.a.createElement(f.a,{pad:"medium"},r.a.createElement(S.a,{onClick:this.configureTheDatabase,label:"Abschlie\xdfen"})))}}]),a}(r.a.Component),M=function(e){Object(p.a)(a,e);var t=Object(g.a)(a);function a(e){var n;return Object(h.a)(this,a),(n=t.call(this,e)).state={host:"",port:"",conncetion:"true",user:"",password:"",standardMail:"",standardPrefix:""},n.configureTheMailserver=n.configureTheMailserver.bind(Object(m.a)(n)),n}return Object(d.a)(a,[{key:"configureTheMailserver",value:function(){var e=Object(u.a)(l.a.mark((function e(){var t,a;return l.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,fetch(T.a.BACKEND_BASE_URI+"/setup/mailserver",{method:"POST",mode:"cors",cache:"no-cache",headers:{"Content-Type":"application/json"},body:JSON.stringify({host:this.state.host,port:this.state.port,secure:this.state.conncetion,user:this.state.user,password:this.state.password,default_from:this.state.standardMail,default_subject_prefix:this.state.standardPrefix})}).catch(console.log);case 2:if((t=e.sent).ok){e.next=8;break}return e.next=6,t.json().catch(console.log);case 6:a=e.sent,t.ok||alert(a.message);case 8:t.ok&&(this.props.changeValueOfStatusMap("MS"),this.props.changeStep());case 9:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"render",value:function(){var e=this;return r.a.createElement(f.a,null,r.a.createElement(f.a,{pad:"medium"}),r.a.createElement(v.a,{weight:"bold",size:"xxlarge",align:"center"},"Konfigurieren des Mailservers"),r.a.createElement(f.a,{pad:"medium"}),r.a.createElement(f.a,{pad:"small"},r.a.createElement(v.a,{weight:"bold"},"Mailserver-Host:"),r.a.createElement(y.a,{placeholder:"Hier bitte den Mailserver-Host eingeben",value:this.state.textInput,onChange:function(t){e.setState({host:t.target.value})}})),r.a.createElement(f.a,{pad:"small"},r.a.createElement(v.a,{weight:"bold"}," Port:"),r.a.createElement(y.a,{placeholder:"Hier bitte den Port eingeben",value:this.state.port,onChange:function(t){e.setState({port:t.target.value})}})),r.a.createElement(f.a,{pad:"small"},r.a.createElement(v.a,{weight:"bold"},"Sichere Verbindung:"),r.a.createElement(P.a,{options:["true","false"],value:this.state.conncetion,onChange:function(t){t.value;var a=t.option;e.setState({conncetion:a})}})),r.a.createElement(f.a,{pad:"small"},r.a.createElement(v.a,{weight:"bold"}," Benutzer:"),r.a.createElement(y.a,{placeholder:"Hier bitte den Benutzer eingeben",value:this.state.user,onChange:function(t){e.setState({user:t.target.value})}})),r.a.createElement(f.a,{pad:"small"},r.a.createElement(v.a,{weight:"bold"},"Passwort: "),r.a.createElement(y.a,{placeholder:"Hier bitte das Passwort eingeben",value:this.state.password,onChange:function(t){e.setState({password:t.target.value})}})),r.a.createElement(f.a,{pad:"small"},r.a.createElement(v.a,{weight:"bold"},"Standard Mail:"),r.a.createElement(y.a,{placeholder:"Hier bitte die Standard Mail eingeben",value:this.state.standardMail,onChange:function(t){e.setState({standardMail:t.target.value})}})),r.a.createElement(f.a,{pad:"small"},r.a.createElement(v.a,{weight:"bold"},"Standard Subject Prefix:"),r.a.createElement(y.a,{placeholder:"Hier bitte den Standard Prefix eingeben",value:this.state.standardPrefix,onChange:function(t){e.setState({standardPrefix:t.target.value})}})),r.a.createElement(f.a,{pad:"small"},r.a.createElement(S.a,{onClick:this.configureTheMailserver,label:"Abschlie\xdfen"})))}}]),a}(r.a.Component),N=function(e){Object(p.a)(a,e);var t=Object(g.a)(a);function a(e){var n;return Object(h.a)(this,a),(n=t.call(this,e)).state={maxPersonenProEvent:"",maxTicketProEvent:"",maxVIPPersonen:""},n.configureTheShopConfig=n.configureTheShopConfig.bind(Object(m.a)(n)),n}return Object(d.a)(a,[{key:"configureTheShopConfig",value:function(){var e=Object(u.a)(l.a.mark((function e(){var t,a;return l.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,fetch(T.a.BACKEND_BASE_URI+"/setup/shopConfig",{method:"POST",mode:"cors",cache:"no-cache",headers:{"Content-Type":"application/json"},body:JSON.stringify({max_Person_pro_Event:this.state.maxPersonenProEvent,max_Tickets_pro_Event:this.state.maxTicketProEvent,max_VIP_Person:this.state.maxVIPPersonen})}).catch(console.log);case 2:if((t=e.sent).ok){e.next=8;break}return e.next=6,t.json().catch(console.log);case 6:a=e.sent,t.ok||alert(a.message);case 8:t.ok&&(this.props.setShopConfiguration(this.state.maxPersonenProEvent,this.state.maxTicketProEvent,this.state.maxVIPPersonen),this.props.changeStep());case 9:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"render",value:function(){var e=this,t=[];return t[0]=r.a.createElement(f.a,null,r.a.createElement(f.a,{pad:"medium"}),r.a.createElement(v.a,{weight:"bold",size:"xxlarge"},"Konfigurieren der Shop Grundeinstellungen:"),r.a.createElement(f.a,{pad:"medium"}),r.a.createElement(f.a,{pad:"small"},r.a.createElement(v.a,{weight:"bold"},"Maximale Personen pro Event:"),r.a.createElement(y.a,{placeholder:"Max Personen pro Event",value:this.state.maxPersonenProEvent,onChange:function(t){e.setState({maxPersonenProEvent:t.target.value})}})),r.a.createElement(f.a,{pad:"small"},r.a.createElement(v.a,{weight:"bold"},"Maximale Anzahl an Tickets pro Event:"),r.a.createElement(y.a,{placeholder:"Max Tickets pro Event",value:this.state.maxTicketProEvent,onChange:function(t){e.setState({maxTicketProEvent:t.target.value})}})),r.a.createElement(f.a,{pad:"small"},r.a.createElement(v.a,{weight:"bold"},"Maximale Anzahl der VIP-Personen pro Event:"),r.a.createElement(y.a,{placeholder:"Max VIP-Personen pro Event",value:this.state.maxVIPPersonen,onChange:function(t){e.setState({maxVIPPersonen:t.target.value})}})),r.a.createElement(f.a,{pad:"small"},r.a.createElement(S.a,{onClick:this.configureTheShopConfig,label:"Hinzuf\xfcgen"}))),t}}]),a}(r.a.Component),R=function(e){Object(p.a)(a,e);var t=Object(g.a)(a);function a(e){var n;return Object(h.a)(this,a),(n=t.call(this,e)).changeStep=n.changeStep.bind(Object(m.a)(n)),n.changeValueOfStatusMap=n.changeValueOfStatusMap.bind(Object(m.a)(n)),n.setWalletAddress=n.setWalletAddress.bind(Object(m.a)(n)),n.changeValueOfGasprices=n.changeValueOfGasprices.bind(Object(m.a)(n)),n.getValueOfGasPrices=n.getValueOfGasPrices.bind(Object(m.a)(n)),n.setShopConfiguration=n.setShopConfiguration.bind(Object(m.a)(n)),n.goToStep=n.goToStep.bind(Object(m.a)(n)),n.state={initializeStep:0,doneOnce:!1,statusMap:new Map([["AW",!1],["DB",!1],["MS",!1],["AL",!1],["AA",!1],["DC",!1],["SC",!1]]),gasPrices:new Map([["deployContract",""],["createTicket",""],["relinquishPlace",""]]),shopConfig:new Map([["MaxPersonProEvent",""],["MaxTicketProEvent",""],["MaxVIPPersonen",""]]),walletAddress:"",httpProvider:""},n}return Object(d.a)(a,[{key:"changeValueOfGasprices",value:function(e,t){this.setState(this.state.gasPrices.set(e,t))}},{key:"getValueOfGasPrices",value:function(e){return this.state.gasPrices.get(e)}},{key:"changeValueOfStatusMap",value:function(e){this.setState(this.state.statusMap.set(e,!0))}},{key:"setWalletAddress",value:function(e){this.setState({walletAddress:e})}},{key:"setHttpProvider",value:function(e){this.setState({httpProvider:e})}},{key:"setShopConfiguration",value:function(e,t,a){var n=this.state.shopConfig;n=new Map([["MaxPersonProEvent",e],["MaxTicketProEvent",t],["MaxVIPPersonen",a]]),this.setState({shopConfig:n})}},{key:"changeStep",value:function(){var e;this.state.initializeStep>6&&(e=0,this.setState({initializeStep:e})),6===this.state.initializeStep&&(e=1+this.state.initializeStep,!0,this.setState({initializeStep:e,doneOnce:!0})),this.state.initializeStep<7&&(e=1+this.state.initializeStep,this.setState({initializeStep:e}))}},{key:"finishSystemSetup",value:function(){window.location.assign("#/login")}},{key:"goToStep",value:function(e){this.setState({initializeStep:e})}},{key:"render",value:function(){return r.a.createElement(f.a,{className:"SystemSetup",direction:"column",gap:"medium",pad:"medium",align:"center"},0===this.state.initializeStep&&r.a.createElement(A,{goToStep:this.goToStep.bind(this),doneOnce:this.state.doneOnce,statusMap:this.state.statusMap,initializeStep:this.state.initializeStep}),1===this.state.initializeStep&&r.a.createElement(z,{changeValueOfStatusMap:this.changeValueOfStatusMap.bind(this),changeStep:this.changeStep.bind(this)}),2===this.state.initializeStep&&r.a.createElement(D,{changeValueOfStatusMap:this.changeValueOfStatusMap.bind(this),changeStep:this.changeStep.bind(this)}),3===this.state.initializeStep&&r.a.createElement(M,{changeValueOfStatusMap:this.changeValueOfStatusMap.bind(this),changeStep:this.changeStep.bind(this)}),4===this.state.initializeStep&&r.a.createElement(B,{setWalletAddress:this.setWalletAddress.bind(this),changeValueOfStatusMap:this.changeValueOfStatusMap.bind(this),changeStep:this.changeStep.bind(this),changeValueOfGasprices:this.changeValueOfGasprices.bind(this),getValueOfGasPrices:this.getValueOfGasPrices.bind(this),setHttpProvider:this.setHttpProvider.bind(this)}),5===this.state.initializeStep&&r.a.createElement(j,{httpProvider:this.state.httpProvider,walletAddress:this.state.walletAddress,changeValueOfStatusMap:this.changeValueOfStatusMap.bind(this),changeStep:this.changeStep.bind(this),getValueOfGasPrices:this.getValueOfGasPrices.bind(this),changeValueOfGasprices:this.changeValueOfGasprices.bind(this)}),6===this.state.initializeStep&&r.a.createElement(N,{setShopConfiguration:this.setShopConfiguration.bind(this),changeStep:this.changeStep.bind(this)}),7===this.state.initializeStep&&r.a.createElement(A,{goToStep:this.goToStep.bind(this),doneOnce:this.state.doneOnce,statusMap:this.state.statusMap,initializeStep:this.state.initializeStep,changeStep:this.changeStep.bind(this)}),0===this.state.initializeStep&&!1===this.state.doneOnce&&r.a.createElement(S.a,{onClick:this.changeStep,label:"Konfiguration beginnen"}),0===this.state.initializeStep&&!0===this.state.doneOnce&&r.a.createElement(S.a,{onClick:this.changeStep,label:"Erneuter Durchlauf"}),7!==this.state.initializeStep&&0!==this.state.initializeStep&&this.state.initializeStep<7&&r.a.createElement(S.a,{onClick:this.changeStep,label:"Schritt \xfcberspringen"}),7===this.state.initializeStep&&r.a.createElement(f.a,{pad:"medium"}," ",r.a.createElement(S.a,{label:"Zur\xfcck",onClick:this.changeStep})),!0===this.state.doneOnce&&(0===this.state.initializeStep||7===this.state.initializeStep)&&r.a.createElement(S.a,{label:"Initialisierung abschlie\xdfen",onClick:this.finishSystemSetup}))}}]),a}(r.a.Component),_=a(539),H=a(48),I=(a(488),function(e){Object(p.a)(a,e);var t=Object(g.a)(a);function a(e){var n;return Object(h.a)(this,a),(n=t.call(this,e)).state={},n}return Object(d.a)(a,[{key:"render",value:function(){return r.a.createElement(f.a,{className:"UserMainMenu",direction:"row",pad:"medium",wrap:!0},r.a.createElement(c.b,{className:"MenuLink",to:"/guest/tickets"},"Tickets Anzeigen"),r.a.createElement(c.b,{className:"MenuLink",to:"/guest/buy"},"Tickets Buchen"),r.a.createElement(c.b,{className:"MenuLink",to:"/guest/bookings"},"Buchungen Anzeigen"))}}]),a}(r.a.Component)),V=(a(219),a(67)),U=a.n(V),L=function(e){Object(p.a)(a,e);var t=Object(g.a)(a);function a(e){var n;Object(h.a)(this,a),(n=t.call(this,e)).state={},n.identifier=window.location.hash.replace("#/guest/tickets/",""),n.ticket={forename:null,surename:null,ticketType:null};var r=n.props.tickets.find((function(e){return e.identifier===n.identifier}));return r&&(n.ticket=r),n}return Object(d.a)(a,[{key:"componentDidMount",value:function(){this.generateQRCode(this.ticket)}},{key:"generateQRCode",value:function(){var e=Object(u.a)(l.a.mark((function e(t){var a,n=this;return l.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:a={id:t.identifier,sIG:this.context.user.secretIngredient},U.a.toDataURL(JSON.stringify(a)).then((function(e){n.setState({qrcode:e})})).catch(console.log);case 2:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"render",value:function(){return r.a.createElement(f.a,{className:"SingleTicket"},r.a.createElement(f.a,{pad:"small"},r.a.createElement("p",null,this.ticket.forename),r.a.createElement("p",null,this.ticket.surname),r.a.createElement("p",null,this.ticket.ticketType)),r.a.createElement(f.a,{pad:"small"},r.a.createElement("img",{width:"300",height:"300",src:this.state.qrcode,alt:"Hier sollte ein QR-Code stehen"}),r.a.createElement(S.a,{onClick:window.print,label:"Drucken"})))}}]),a}(r.a.Component);function K(e){return r.a.createElement(f.a,{className:"TicketListItem",direction:"row",gap:"small",pad:"small"},r.a.createElement(v.a,{className:"Name"},e.ticket.forename," ",e.ticket.surname),r.a.createElement(v.a,{className:"Type"},e.ticket.ticketType),r.a.createElement(S.a,{label:"Anzeigen",onClick:function(){window.location.assign("#/guest/tickets/"+e.ticket.identifier)}}))}L.contextType=k;var F=function(e){Object(p.a)(a,e);var t=Object(g.a)(a);function a(e){var n;return Object(h.a)(this,a),(n=t.call(this,e)).state={tickets:[],loading:!1},n}return Object(d.a)(a,[{key:"componentDidMount",value:function(){this.fetchTickets()}},{key:"fetchTickets",value:function(){var e=Object(u.a)(l.a.mark((function e(){var t,a;return l.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return this.setState({loading:!0}),e.next=3,fetch(T.a.BACKEND_BASE_URI+"/api/v2/users/"+this.context.user.id+"/tickets",{mode:"cors",cache:"no-cache",headers:{"Content-Type":"application/json",Authorization:"Bearer "+this.context.token}}).catch(console.log);case 3:if((t=e.sent).ok){e.next=8;break}return this.setState({loading:!1}),alert("Beim Laden der Tickets ist ein Fehler aufgetreten."),e.abrupt("return");case 8:return e.next=10,t.json().catch(console.log);case 10:if(a=e.sent){e.next=13;break}return e.abrupt("return");case 13:a.forEach((function(e){switch(e.ticketType){case"0":e.ticketType="Absolvent";break;case"1":e.ticketType="Begleitperson";break;case"2":e.ticketType="Parkticket"}})),this.setState({tickets:a,loading:!1});case 15:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"setToken",value:function(e){localStorage.setItem("Tokenwert",e)}},{key:"getToken",value:function(){var e=localStorage.getItem("Tokenwert");console.log(e)}},{key:"render",value:function(){var e=this.state.tickets.map((function(e){return r.a.createElement(K,{key:e.identifier,ticket:e})}));return r.a.createElement(f.a,{className:"TicketOverview",direction:"column",gap:"medium",pad:"medium"},r.a.createElement(H.c,null,r.a.createElement(H.a,{path:"/guest/tickets/:identifier"},r.a.createElement(c.b,{to:"/guest/tickets/"},"Alle Tickets anzeigen"),r.a.createElement(L,{tickets:this.state.tickets})),r.a.createElement(H.a,{path:"/guest/tickets/"},r.a.createElement(f.a,null,r.a.createElement(f.a,null,r.a.createElement("h1",{className:"NumberOfTickets"},this.state.tickets.length)),r.a.createElement(f.a,{className:"TicketList"},this.state.loading&&r.a.createElement("p",{className:"loader"}),e)))))}}]),a}(r.a.Component);F.contextType=k;var W=F,G=a(549),q=a(538),J=function(e){Object(p.a)(a,e);var t=Object(g.a)(a);function a(e){var n;return Object(h.a)(this,a),(n=t.call(this,e)).state={},n}return Object(d.a)(a,[{key:"render",value:function(){var e=[];this.props.tickets.forEach((function(t){e.push(r.a.createElement(f.a,{key:t.identifier,pad:"small"},r.a.createElement("span",null,"Ticket Identifier: ",t.identifier),r.a.createElement("span",null,"Nachname: ",t.surname),r.a.createElement("span",null,"Vorname: ",t.forename),r.a.createElement("span",null,"Ticket Typ: ",t.ticketType)))}));var t=this.props.booking,a="Buchung "+t.id+", gebucht am "+new Date(t.createdAt).toLocaleDateString()+" - "+(t.paidAt?"Bezahlt":"Zahlung ausstehend");return r.a.createElement(G.a,{label:a},e.length>0&&r.a.createElement(v.a,{margin:"small"},"Folgende Tickets wurden gebucht:"),e.length>0&&e,0===e.length&&r.a.createElement(v.a,{margin:"small"},"Keine Daten vorhanden."))}}]),a}(r.a.Component),Z=function(e){Object(p.a)(a,e);var t=Object(g.a)(a);function a(e){var n;return Object(h.a)(this,a),(n=t.call(this,e)).loadListHandler=n.loadListHandler.bind(Object(m.a)(n)),n.loadTicketsHandler=n.loadTicketsHandler.bind(Object(m.a)(n)),n.translateTicketType=n.translateTicketType.bind(Object(m.a)(n)),n.state={buchungen:[],tickets:[]},n}return Object(d.a)(a,[{key:"componentDidMount",value:function(){this.loadListHandler()}},{key:"loadListHandler",value:function(){var e=Object(u.a)(l.a.mark((function e(){var t,a;return l.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return this.setState({loading:!0}),e.next=3,fetch(T.a.BACKEND_BASE_URI+"/api/v2/users/"+this.context.user.id+"/bookings",{method:"GET",mode:"cors",cache:"no-cache",headers:{"Content-Type":"application/json",Authorization:"Bearer "+this.context.token}}).catch(console.log);case 3:if((t=e.sent).ok){e.next=7;break}return alert("Buchungen konnten nicht geladen werden."),e.abrupt("return");case 7:return e.next=9,t.json().catch(console.log);case 9:if(a=e.sent){e.next=12;break}return e.abrupt("return");case 12:this.setState({buchungen:a,loading:!1});case 13:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"loadTicketsHandler",value:function(){var e=Object(u.a)(l.a.mark((function e(t){var a,n,r,i,s=this;return l.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(void 0!==t){e.next=2;break}return e.abrupt("return");case 2:if(a=this.state.buchungen[t].id,-1===this.state.tickets.findIndex((function(e){return e.bookingId===a}))){e.next=6;break}return e.abrupt("return");case 6:return e.next=8,fetch(T.a.BACKEND_BASE_URI+"/api/v2/bookings/"+a+"/ticketsBooked",{method:"GET",mode:"cors",cache:"no-cache",headers:{"Content-Type":"application/json",Authorization:"Bearer "+this.context.token}}).catch(console.log);case 8:if((n=e.sent).ok){e.next=12;break}return alert("Gebuchte Tickets konnten nicht geladen werden."),e.abrupt("return");case 12:return e.next=14,n.json().catch(console.log);case 14:if(r=e.sent){e.next=17;break}return e.abrupt("return");case 17:(i=(i=this.state.tickets).concat(r)).forEach((function(e){e.ticketType=s.translateTicketType(e.ticketType)})),this.setState({tickets:i});case 21:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"translateTicketType",value:function(e){switch(e){case 0:return"Absolvent";case 1:return"Begleitperson";case 2:return"Parkticket";default:return"Kein g\xfcltiger Tickettyp"}}},{key:"render",value:function(){var e=this,t=[];return this.state.buchungen.forEach((function(a){var n=e.state.tickets.filter((function(e){return e.bookingId===a.id}));t.push(r.a.createElement(J,{key:a.id,booking:a,tickets:n}))})),r.a.createElement(f.a,{className:"BookingOverview",direction:"column",gap:"medium",pad:"medium"},r.a.createElement(f.a,null,this.state.loading&&r.a.createElement("p",{className:"loader"}),t.length>0&&r.a.createElement(q.a,{onActive:function(t){e.loadTicketsHandler(t[0])}},t),0===t.length&&r.a.createElement(v.a,null,"Keine Buchungen vorhanden")))}}]),a}(r.a.Component);Z.contextType=k;var Q=Z,X=a(101),Y=a(550),$=function(e){Object(p.a)(a,e);var t=Object(g.a)(a);function a(e){var n;return Object(h.a)(this,a),(n=t.call(this,e)).onInputHandler=n.onInputHandler.bind(Object(m.a)(n)),n.onCheckBox=n.onCheckBox.bind(Object(m.a)(n)),n.state={forename:"",surname:"",isWheelchairUser:!1},n}return Object(d.a)(a,[{key:"onInputHandler",value:function(e){var t=this.state;t[e.target.name]=e.target.value,this.setState(t),this.props.onInput(this.state)}},{key:"onCheckBox",value:function(e){var t=this.state;t[e.target.name]=!t[e.target.name],this.setState(t),this.props.onInput(this.state)}},{key:"render",value:function(){return r.a.createElement(f.a,null,r.a.createElement(y.a,{name:"forename",placeholder:"Vorname des Gastes",value:this.state.forename,onChange:this.onInputHandler}),r.a.createElement(y.a,{name:"surname",placeholder:"Nachname des Gastes",value:this.state.surname,onChange:this.onInputHandler}),r.a.createElement(Y.a,{name:"isWheelchairUser",label:"Rollstuhlfahrer bitte ankreuzen",onChange:this.onCheckBox,checked:this.state.isWheelchairUser}))}}]),a}(r.a.Component),ee=function(e){Object(p.a)(a,e);var t=Object(g.a)(a);function a(e){var n;return Object(h.a)(this,a),(n=t.call(this,e)).increment=function(e){if("guest"===e&&n.state.guestcount<n.state.MaxAnzahBesuchertickets){var t=n.state.persons.length,a=r.a.createElement($,{key:t,onInput:function(e){var a=n.state.persons;a[t]=e,n.setState({persons:a})}}),i=n.state.persons;i[t]={},n.state.personInputFields.push(a),n.setState({persons:i,personInputFields:n.state.personInputFields,guestcount:n.state.guestcount+1})}else"park"===e&&n.state.parkcount<1+n.state.guestcount&&n.setState({parkcount:n.state.parkcount+1})},n.decrement=function(e){"guest"===e&&n.state.guestcount>0?(n.state.personInputFields.pop(),n.state.persons.pop(),n.setState({guestcount:n.state.guestcount-1,personInputFields:n.state.personInputFields,persons:n.state.persons})):"park"===e&&n.state.parkcount>0&&n.setState({parkcount:n.state.parkcount-1})},n.windowAbsolventTicket=n.windowAbsolventTicket.bind(Object(m.a)(n)),n.windowGuestTicket=n.windowGuestTicket.bind(Object(m.a)(n)),n.windowParkTicket=n.windowParkTicket.bind(Object(m.a)(n)),n.toOverview=n.toOverview.bind(Object(m.a)(n)),n.toPayment=n.toPayment.bind(Object(m.a)(n)),n.createTickets=n.createTickets.bind(Object(m.a)(n)),n.createBooking=n.createBooking.bind(Object(m.a)(n)),n.onInputHandler=n.onInputHandler.bind(Object(m.a)(n)),n.ShopConfig=n.ShopConfig.bind(Object(m.a)(n)),n.getPaymentOptions=n.getPaymentOptions.bind(Object(m.a)(n)),n.paymentCalculation=n.paymentCalculation.bind(Object(m.a)(n)),n.state={MaxAnzahlAbsolvententickets:0,MaxAnzahBesuchertickets:0,TicketPrice_Type0:0,TicketPrice_Type1:0,TicketPrice_Type2:0,PaymentBankActive:!1,PaymentBankReceiver:"",PaymentBankName:"",PaymentBankIban:"",PaymentPayPalActive:!1,PaymentPayPalLink:"",PaymentPayPalMail:"",TotalInvoice:0,guestcount:0,parkcount:0,step:0,persons:[],personInputFields:[],graduate:{forename:"",surname:"",isWheelchairUser:!1},bookingResult:null},n}return Object(d.a)(a,[{key:"onInputHandler",value:function(e,t){"forename"===t?this.setState({graduate:{forename:e.target.value,surname:this.state.graduate.surname}}):this.setState({graduate:{surname:e.target.value,forename:this.state.graduate.forename}})}},{key:"componentDidMount",value:function(){this.ShopConfig(),this.getPaymentOptions()}},{key:"windowAbsolventTicket",value:function(){this.setState({step:0})}},{key:"windowGuestTicket",value:function(){this.setState({step:1})}},{key:"windowParkTicket",value:function(){this.setState({step:2})}},{key:"toOverview",value:function(){this.setState({step:3}),this.paymentCalculation()}},{key:"toPayment",value:function(){this.createBooking(),this.setState({step:4})}},{key:"showPaymentOptions",value:function(e){!0===e&&(this.state.PaymentBankName.print(),this.state.PaymentBankReceiver.print(),this.state.PaymentBankIban.print())}},{key:"paymentCalculation",value:function(){var e=this.state.TicketPrice_Type0+this.state.guestcount*this.state.TicketPrice_Type1+this.state.parkcount*this.state.TicketPrice_Type2;this.setState({TotalInvoice:e})}},{key:"ShopConfig",value:function(){var e=Object(u.a)(l.a.mark((function e(){var t,a;return l.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,fetch(T.a.BACKEND_BASE_URI+"/api/v2/shopConfig",{method:"GET",mose:"cors",cache:"no-cache",headers:{"Content-Type":"application/json",Authorization:"Bearer "+this.context.token}}).catch(console.log);case 2:if((t=e.sent).ok||alert(t.message),!t.ok){e.next=14;break}return e.next=7,t.json();case 7:a=e.sent,this.setState({MaxAnzahlAbsolvententickets:a.max_TicketType_0_pro_Absolvent}),this.setState({MaxAnzahBesuchertickets:a.max_TicketType_1_pro_Absolvent}),this.setState({TicketPrice_Type0:parseInt(a.price_TicketType_0)}),this.setState({TicketPrice_Type1:parseInt(a.price_TicketType_1)}),this.setState({TicketPrice_Type2:parseInt(a.price_TicketType_2)}),a.salesStatus||(alert("Der Ticketverkauf ist derzeit nicht aktiv!"),this.context.redirectUserToHome());case 14:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"getPaymentOptions",value:function(){var e=Object(u.a)(l.a.mark((function e(){var t,a;return l.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,fetch(T.a.BACKEND_BASE_URI+"/api/v2/paymentOptions",{method:"GET",mode:"cors",cache:"no-cache",headers:{"Content-Type":"application/json",Authorization:"Bearer "+this.context.token}}).catch(console.log);case 2:if(!(t=e.sent)){e.next=15;break}return e.next=6,t.json().catch(console.log);case 6:return a=e.sent,this.setState({PaymentBankActive:a.Bank.Aktiviert}),this.setState({PaymentBankReceiver:a.Bank.Empf\u00e4nger}),this.setState({PaymentBankName:a.Bank.Name_der_Bank}),this.setState({PaymentBankIban:a.Bank.IBAN}),this.setState({PaymentPayPalActive:a.PayPal.Aktiviert}),this.setState({PaymentPayPalLink:a.PayPal.PayPal_Link}),this.setState({PaymentPayPalMail:a.PayPal.PayPal_Verwendung}),e.abrupt("return");case 15:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"createBooking",value:function(){var e=Object(u.a)(l.a.mark((function e(){var t,a;return l.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,fetch(T.a.BACKEND_BASE_URI+"/api/v2/bookings",{method:"POST",mode:"cors",cache:"no-cache",headers:{"Content-Type":"application/json",Authorization:"Bearer "+this.context.token},body:JSON.stringify({userId:this.context.user.id})}).catch(console.log);case 2:if((t=e.sent).ok){e.next=6;break}return this.setState({step:100}),e.abrupt("return");case 6:return e.next=8,t.json().catch(console.log);case 8:if(a=e.sent,this.setState({bookingResult:a}),a){e.next=13;break}return this.setState({step:100}),e.abrupt("return");case 13:return e.next=15,this.createTickets();case 15:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"createTickets",value:function(){var e=Object(u.a)(l.a.mark((function e(){var t,a,n,r,i,s,c;return l.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:t=this.state.bookingResult.id,a=Object(X.a)(this.state.persons),e.prev=2,a.s();case 4:if((n=a.n()).done){e.next=20;break}return r=n.value,e.next=8,fetch(T.a.BACKEND_BASE_URI+"/api/v2/ticketsBooked",{method:"POST",mode:"cors",cache:"no-cache",headers:{"Content-Type":"application/json",Authorization:"Bearer "+this.context.token},body:JSON.stringify({bookingId:t,ticketType:1,forename:r.forename,surname:r.surname,isWheelchairUser:r.isWheelchairUser})}).catch(console.log);case 8:if((i=e.sent).ok){e.next=12;break}return this.setState({step:100}),e.abrupt("return");case 12:return e.next=14,i.json().catch(console.log);case 14:if(e.sent){e.next=18;break}return this.setState({step:100}),e.abrupt("return");case 18:e.next=4;break;case 20:e.next=25;break;case 22:e.prev=22,e.t0=e.catch(2),a.e(e.t0);case 25:return e.prev=25,a.f(),e.finish(25);case 28:return e.next=30,fetch(T.a.BACKEND_BASE_URI+"/api/v2/ticketsBooked",{method:"POST",mode:"cors",cache:"no-cache",headers:{"Content-Type":"application/json",Authorization:"Bearer "+this.context.token},body:JSON.stringify({bookingId:t,ticketType:0,forename:this.state.graduate.forename,surname:this.state.graduate.surname,isWheelchairUser:!1})}).catch(console.log);case 30:if((i=e.sent).ok){e.next=34;break}return this.setState({step:100}),e.abrupt("return");case 34:return e.next=36,i.json().catch(console.log);case 36:if(e.sent){e.next=40;break}return this.setState({step:100}),e.abrupt("return");case 40:s=this.state.parkcount,c=0;case 42:if(!(c<s)){e.next=58;break}return e.next=45,fetch(T.a.BACKEND_BASE_URI+"/api/v2/ticketsBooked",{method:"POST",mode:"cors",cache:"no-cache",headers:{"Content-Type":"application/json",Authorization:"Bearer "+this.context.token},body:JSON.stringify({bookingId:t,ticketType:2,forename:this.state.graduate.forename+" "+c,surname:this.state.graduate.surname,isWheelchairUser:!1})}).catch(console.log);case 45:if((i=e.sent).ok){e.next=49;break}return this.setState({step:100}),e.abrupt("return");case 49:return e.next=51,i.json().catch(console.log);case 51:if(e.sent){e.next=55;break}return this.setState({step:100}),e.abrupt("return");case 55:c++,e.next=42;break;case 58:case"end":return e.stop()}}),e,this,[[2,22,25,28]])})));return function(){return e.apply(this,arguments)}}()},{key:"render",value:function(){var e=this;return r.a.createElement(f.a,{className:"TicketBestellung",direction:"column",gap:"medium",pad:"medium"},0===this.state.step&&r.a.createElement(f.a,{gap:"small"},r.a.createElement(E.a,null,"Angaben zu Ihnen"),r.a.createElement(v.a,null,"Bitte tragen Sie Ihren vollst\xe4ndigen Namen ein."),r.a.createElement(v.a,null,"Ticketpreis in EURO: ",this.state.TicketPrice_Type0," \u20ac"),r.a.createElement(y.a,{name:"forename",placeholder:"Vorname des Absolventen",value:this.state.graduate.forename,onChange:function(t){return e.onInputHandler(t,"forename")}}),r.a.createElement(y.a,{name:"surname",placeholder:"Nachname des Absolventen",value:this.state.graduate.surname,onChange:function(t){return e.onInputHandler(t,"surname")}}),r.a.createElement(Y.a,{name:"isWheelchairUser",label:"Rollstuhlfahrer bitte ankreuzen",value:this.state.graduate.isWheelchairUser,onChange:this.onCheckBox,checked:this.state.isWheelchairUser}),r.a.createElement(S.a,{label:"Weiter",onClick:this.windowGuestTicket,gap:"small"})),1===this.state.step&&r.a.createElement(f.a,{gap:"small"},r.a.createElement(E.a,null,"Angaben zu Begleitpersonen"),r.a.createElement(v.a,null,"Bitte geben Sie an, wie viele Begleitpersonen Sie mitnehmen wollen."),r.a.createElement(v.a,null,"Ticketpreis in EURO: ",this.state.TicketPrice_Type1," \u20ac"),r.a.createElement(S.a,{onClick:function(){return e.increment("guest")},className:"guestcount",label:"+"}),r.a.createElement(S.a,{onClick:function(){return e.decrement("guest")},className:"guestcount",label:"-"}),r.a.createElement("h2",null,"Anzahl der Begleitpersonen: ",this.state.guestcount),this.state.personInputFields,r.a.createElement(S.a,{onClick:this.windowAbsolventTicket,label:"Zur\xfcck"}),r.a.createElement(S.a,{onClick:this.windowParkTicket,label:"Weiter"})),2===this.state.step&&r.a.createElement(f.a,{gap:"small"},r.a.createElement(E.a,null,"Parktickets"),r.a.createElement(v.a,null,"Bitte geben Sie an, wie viele Parktickets Sie ben\xf6tigen."),r.a.createElement(v.a,null,"Ticketpreis in EURO: ",this.state.TicketPrice_Type2," \u20ac"),r.a.createElement(S.a,{onClick:function(){return e.increment("park")},className:"parkcount",label:"+"}),r.a.createElement(S.a,{onClick:function(){return e.decrement("park")},className:"parkcount",label:"-"}),r.a.createElement("h2",null,"Anzahl der Parktickets: ",this.state.parkcount),r.a.createElement(S.a,{onClick:this.windowGuestTicket,label:"Zur\xfcck"}),r.a.createElement(S.a,{onClick:this.toOverview,label:"Weiter"})),3===this.state.step&&r.a.createElement(f.a,{gap:"small"},r.a.createElement(v.a,null,"Sie haben folgende Tickets bestellt: ",r.a.createElement("br",null),"Absolvent: 1 x  ",this.state.TicketPrice_Type0," \u20ac",r.a.createElement("br",null),"Begleitpersonen: ",this.state.guestcount," x ",this.state.TicketPrice_Type1," \u20ac",r.a.createElement("br",null),"Parkticket: ",this.state.parkcount," x ",this.state.TicketPrice_Type2," \u20ac"),r.a.createElement(v.a,null,"Summe: ",this.state.TotalInvoice),r.a.createElement(S.a,{onClick:this.windowParkTicket,label:"Zur\xfcck"}),r.a.createElement(S.a,{onClick:this.toPayment,label:"Zahlungspflichtig bestellen"})),4===this.state.step&&r.a.createElement(f.a,{gap:"small"},r.a.createElement(v.a,null,"Die Buchung wurde erfolgreich \xfcbermittelt.",r.a.createElement("br",null),"Bitte \xfcberweisen Sie folgenden Betrag auf das Konto: XXXXYYYYZZZZ.",r.a.createElement("br",null),this.showPaymentOptions,"Geben Sie ihren Namen als Verwendungszweck an.",r.a.createElement("br",null),'Nach Rechnungseingang k\xf6nnen Sie Ihre Tickets unter "Tickets Anzeigen" einsehen.',r.a.createElement("br",null)),r.a.createElement(v.a,null,"Sie haben folgende Tickets bestellt: ",r.a.createElement("br",null),"Absolvent: 1 ",r.a.createElement("br",null),"Begleitpersonen: ",this.state.guestcount," ",r.a.createElement("br",null),"Parkticket: ",this.state.parkcount)),100===this.state.step&&r.a.createElement(f.a,{gap:"small"},r.a.createElement(v.a,null,"Es ist ein Fehler beim Bestellvorgang aufgetreten. Bitte versuche Sie es sp\xe4ter erneut.")))}}]),a}(r.a.Component);ee.contextType=k;var te=ee,ae=function(e){Object(p.a)(a,e);var t=Object(g.a)(a);function a(e){var n;return Object(h.a)(this,a),(n=t.call(this,e)).state={},n}return Object(d.a)(a,[{key:"componentDidMount",value:function(){this.context.requireLogin(1)}},{key:"componentDidUpdate",value:function(){this.context.requireLogin(1)}},{key:"render",value:function(){return r.a.createElement(f.a,{className:"Guest"},r.a.createElement(b.a,{background:"brand",justify:"between",pad:"10px"},r.a.createElement(c.b,{to:"/guest"},"Home"),r.a.createElement(_.a,{label:"Account",items:[{label:"Logout",onClick:this.context.logout}]})),r.a.createElement(H.c,null,r.a.createElement(H.a,{path:"/guest/buy"},r.a.createElement(te,null)),r.a.createElement(H.a,{path:"/guest/tickets/"},r.a.createElement(W,null)),r.a.createElement(H.a,{path:"/guest/bookings"},r.a.createElement(Q,null)),r.a.createElement(H.a,{path:"/guest/"},r.a.createElement(I,null))))}}]),a}(r.a.Component);ae.contextType=k;var ne=ae,re=a(250),ie=a(246),se=a.n(ie),ce=function(e){Object(p.a)(a,e);var t=Object(g.a)(a);function a(e){var n;return Object(h.a)(this,a),(n=t.call(this,e)).state={},n.video=r.a.createRef(),n.canvasElement=r.a.createRef(),n.startScan=n.startScan.bind(Object(m.a)(n)),n.tick=n.tick.bind(Object(m.a)(n)),n}return Object(d.a)(a,[{key:"componentWillUnmount",value:function(){this.stopScan()}},{key:"tick",value:function(){if(this.video&&this.video.current){if(this.video.current.readyState===this.video.current.HAVE_ENOUGH_DATA){this.canvasElement.current.height=320,this.canvasElement.current.width=320,this.canvas.drawImage(this.video.current,0,0,this.canvasElement.current.width,this.canvasElement.current.height);var e=this.canvas.getImageData(0,0,this.canvasElement.current.width,this.canvasElement.current.height),t=se()(e.data,e.width,e.height,{inversionAttempts:"dontInvert"});if(t)switch(this.props.contentType){case"ETHEREUM_ADDRESS":var a=t.data.match(Object(re.a)(/(?:ethereum:)(0x[0-9A-Za-z]*)/,{address:1}));if(a&&a.groups.address)return this.stopScan(),void this.props.onDone(a.groups.address);break;case"ETHEREUM_SIGNATURE":case"IP_ADDRESS":case"JSON_DATA":break;default:return this.stopScan(),void this.props.onDone(t.data)}}requestAnimationFrame(this.tick)}}},{key:"startScan",value:function(){var e=this;if(!navigator.mediaDevices)return alert("Der Browser unterst\xfctzt diese Funktion nicht.");navigator.mediaDevices.getUserMedia({video:{facingMode:"environment",width:320,height:320}}).then((function(t){e.canvas=e.canvasElement.current.getContext("2d"),e.video.current.srcObject=t,e.video.current.setAttribute("playsinline",!0),e.video.current.play(),requestAnimationFrame(e.tick),e.setState({isScanning:!0})})).catch((function(e){console.error(e),alert("Sorry, Kamera-Stream konnte nicht geladen werden.")}))}},{key:"stopScan",value:function(){this.video&&this.video.current&&this.video.current.srcObject&&(this.video.current.srcObject.getVideoTracks()[0].stop(),this.setState({isScanning:!1}))}},{key:"render",value:function(){return r.a.createElement(f.a,{className:"QRScanner"},r.a.createElement("div",null,r.a.createElement("canvas",{ref:this.canvasElement,hidden:!this.state.isScanning}),r.a.createElement("video",{ref:this.video,hidden:!0})),!this.state.isScanning&&r.a.createElement(S.a,{label:this.props.label||"Scan",onClick:this.startScan}))}}]),a}(r.a.Component),oe=(a(512),function(e){Object(p.a)(a,e);var t=Object(g.a)(a);function a(e){var n;return Object(h.a)(this,a),(n=t.call(this,e)).state={},n}return Object(d.a)(a,[{key:"render",value:function(){return r.a.createElement("div",{className:"dialog"},r.a.createElement("div",{className:"dialog-background-box"}),r.a.createElement("div",{className:"dialog-center"},r.a.createElement("div",{className:"dialog-content"},r.a.createElement("div",{className:"dialog-header"},r.a.createElement("h1",null,this.props.title),r.a.createElement(S.a,{className:"abort",onClick:this.props.onAbort},"X")),r.a.createElement("div",{className:"dialog-body"},this.props.children))))}}]),a}(r.a.Component)),le=(a(229),function(){function e(){Object(h.a)(this,e),this._iceCandidatesHandler=this._iceCandidatesHandler.bind(this),this._dataChannelOpenHandler=this._dataChannelOpenHandler.bind(this),this._receiveChannelHandler=this._receiveChannelHandler.bind(this),this._dataChannelClosedHandler=this._dataChannelClosedHandler.bind(this),this._connectionChangeHandler=this._connectionChangeHandler.bind(this),this._generateAnswer=this._generateAnswer.bind(this),this._messageHandler=this._messageHandler.bind(this),this.requestMap=new Map,this.icecandidates=[],this.remoteICECandidates=[],this.onConnectionChanged=function(e){},this._initConnection()}return Object(d.a)(e,[{key:"_initConnection",value:function(){var e=Object(u.a)(l.a.mark((function e(){return l.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:null,this.localPeerConnection=new RTCPeerConnection(null),this.localPeerConnection.addEventListener("icecandidate",this._iceCandidatesHandler),this.localPeerConnection.addEventListener("connectionstatechange",this._connectionChangeHandler),this.localPeerConnection.addEventListener("datachannel",this._receiveChannelHandler);case 5:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"_iceCandidatesHandler",value:function(e){this.icecandidates.push(e.candidate),this.answer&&!this.qrcode&&setTimeout(this._generateAnswer,200)}},{key:"_connectionChangeHandler",value:function(e){console.debug(e);var t=e.target.connectionState;this.onConnectionChanged(t)}},{key:"_dataChannelOpenHandler",value:function(e){console.debug(e),this.onReady()}},{key:"_dataChannelClosedHandler",value:function(e){console.debug(e)}},{key:"_messageHandler",value:function(e){console.debug(e.data);try{var t=JSON.parse(e.data);if(t.reqId){var a=this.requestMap.get(t.reqId);t.error?a.reject(t.error):a.resolve(t.result)}}catch(n){console.error(n)}}},{key:"_receiveChannelHandler",value:function(e){this.dataChannel=e.channel,this.dataChannel.addEventListener("message",this._messageHandler),this.dataChannel.addEventListener("open",this._dataChannelOpenHandler),this.dataChannel.addEventListener("close",this._dataChannelClosedHandler)}},{key:"_createUUID",value:function(){var e=(new Date).getTime();return"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,(function(t){var a=(e+16*Math.random())%16|0;return e=Math.floor(e/16),("x"===t?a:0&a).toString(16)}))}},{key:"readTicketRemote",value:function(e){var t=this;return new Promise((function(a,n){var r=t._createUUID();t.requestMap.set(r,{resolve:a,reject:n});var i={type:"Request",reqId:r,context:"ticketMirror",method:"getTicket",params:[e]};try{t.dataChannel.send(JSON.stringify(i))}catch(s){n(s)}}))}},{key:"obliterateTicketRemote",value:function(e,t){var a=this;return new Promise((function(n,r){var i=a._createUUID();a.requestMap.set(i,{resolve:n,reject:r});var s={type:"Request",reqId:i,context:"ticketMirror",method:"obliterateTicket",params:[e,t]};try{a.dataChannel.send(JSON.stringify(s))}catch(c){r(c)}}))}},{key:"setMasterConfig",value:function(){var e=Object(u.a)(l.a.mark((function e(t){var a=this;return l.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.localPeerConnection.setRemoteDescription(new RTCSessionDescription(t.offer)).catch(console.error);case 2:return t.candidates.forEach((function(e){a.localPeerConnection.addIceCandidate(e).catch(console.error),a.remoteICECandidates.push(e)})),e.next=5,this.localPeerConnection.createAnswer().catch(console.error);case 5:return this.answer=e.sent,e.next=8,this.localPeerConnection.setLocalDescription(this.answer).catch(console.error);case 8:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"_generateAnswer",value:function(){var e={answer:this.answer,candidates:this.icecandidates};this.onAnswer(e)}},{key:"toJSON",value:function(){var e={localDescription:this.localPeerConnection.currentLocalDescription,remoteDescription:this.localPeerConnection.currentRemoteDescription,candidates:this.remoteICECandidates};return JSON.stringify(e)}}]),e}()),ue=a(69),he=a.n(ue),de=function(e){Object(p.a)(a,e);var t=Object(g.a)(a);function a(e){var n;return Object(h.a)(this,a),(n=t.call(this,e)).state={connected:null,currentTicket:null},n.connectTicketReader=n.connectTicketReader.bind(Object(m.a)(n)),n.scanDoneHandler=n.scanDoneHandler.bind(Object(m.a)(n)),n.capturedTicketHandler=n.capturedTicketHandler.bind(Object(m.a)(n)),n.obliterateTicketHandler=n.obliterateTicketHandler.bind(Object(m.a)(n)),n.closeTicketViewHandler=n.closeTicketViewHandler.bind(Object(m.a)(n)),n.ticketReader=null,n}return Object(d.a)(a,[{key:"translateTicketType",value:function(e){switch(e){case"0":return"Absolvent";case"1":return"Begleitperson";case"2":return"Parkticket"}}},{key:"connectTicketReader",value:function(){var e=this,t=new le;t.onReady=function(){e.ticketReader=e.state.connectTR,e.setState({connectTR:null})},t.onConnectionChanged=function(t){switch(t){case"connected":case"disconnected":case"failed":case"closed":e.setState({connected:t})}},t.onAnswer=function(){var t=Object(u.a)(l.a.mark((function t(a){var n,r;return l.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return n=he.a.deflate(JSON.stringify(a),{level:9,to:"string"}),t.next=3,U.a.toDataURL(n).catch(console.error);case 3:r=t.sent,e.setState({TRQRCode:r,connectTRStep:1});case 5:case"end":return t.stop()}}),t)})));return function(e){return t.apply(this,arguments)}}(),this.setState({connectTR:t,connectTRStep:0})}},{key:"scanDoneHandler",value:function(e){var t=JSON.parse(he.a.inflate(e,{to:"string"}));this.state.connectTR.setMasterConfig(t)}},{key:"capturedTicketHandler",value:function(){var e=Object(u.a)(l.a.mark((function e(t){var a,n;return l.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(e.prev=0,(a=JSON.parse(t)).id&&a.sIG){e.next=4;break}throw Error("Fehlende Angaben im Ticket-QR-Code. M\xf6glicherweise liegt eine F\xe4lschung vor.");case 4:return e.next=6,this.ticketReader.readTicketRemote(a.id);case 6:n=e.sent,this.setState({currentTicket:n,currentSecretIngredient:a.sIG}),e.next=13;break;case 10:e.prev=10,e.t0=e.catch(0),alert(e.t0);case 13:case"end":return e.stop()}}),e,this,[[0,10]])})));return function(t){return e.apply(this,arguments)}}()},{key:"obliterateTicketHandler",value:function(){var e=Object(u.a)(l.a.mark((function e(){return l.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,this.ticketReader.obliterateTicketRemote(this.state.currentTicket.identifier,this.state.currentSecretIngredient);case 3:alert("Erfolgreich entwertet!"),this.closeTicketViewHandler(),e.next=10;break;case 7:e.prev=7,e.t0=e.catch(0),alert(e.t0);case 10:case"end":return e.stop()}}),e,this,[[0,7]])})));return function(){return e.apply(this,arguments)}}()},{key:"closeTicketViewHandler",value:function(){this.setState({currentTicket:null,currentSecretIngredient:null})}},{key:"render",value:function(){var e=this;return r.a.createElement(f.a,{className:"Entrance",pad:"medium"},!this.state.connected&&r.a.createElement(f.a,null,r.a.createElement("p",null,"Wenn Sie dieses Ger\xe4t als Ticket Leser verwenden m\xf6chten, m\xfcssen Sie es erst mit dem Event-Manager verbinden."),r.a.createElement("p",null,"Bitte stellen Sie sicher, dass dieses Ger\xe4t mit dem selben lokalen Netzwerk, wie der Event-Manager verbunden ist."),r.a.createElement(S.a,{onClick:this.connectTicketReader,label:"Ticket Reader Aktivieren"}),this.state.connectTR&&r.a.createElement(oe,{title:"Als Ticket Reader verbinden",onAbort:function(){e.setState({connectTR:null})}},0===this.state.connectTRStep&&r.a.createElement("div",null,r.a.createElement("div",{className:"scanner"},r.a.createElement(ce,{onDone:this.scanDoneHandler,label:"Scanvorgang starten"})),r.a.createElement("div",{className:"description"},r.a.createElement("p",null,"Bitte den Code des Initiators scannen"))),1===this.state.connectTRStep&&r.a.createElement("div",null,r.a.createElement("div",{className:"qrcode"},!this.state.TRQRCode&&r.a.createElement("div",{className:"loader"},"Loading..."),this.state.TRQRCode&&r.a.createElement("img",{src:this.state.TRQRCode,width:"100%",alt:"Ein QR-Code sollte hier angezeigt werden."})),r.a.createElement("div",{className:"description"},r.a.createElement("p",null,"Bitte nun mit dem Initiator Ger\xe4t scannen"))))),"connected"===this.state.connected&&r.a.createElement(f.a,null,r.a.createElement("p",null,"Sie sind verbunden"),null===this.state.currentTicket&&r.a.createElement(ce,{onDone:this.capturedTicketHandler,label:"Scanvorgang starten"}),this.state.currentTicket&&r.a.createElement(f.a,null,r.a.createElement("h1",null,this.state.currentTicket.surname,", ",this.state.currentTicket.forename),r.a.createElement(v.a,{size:"2em",pad:"small"},this.translateTicketType(this.state.currentTicket.ticketType)),r.a.createElement(v.a,{size:"2em",pad:"small"},this.state.currentTicket.isValid&&!this.state.currentTicket.isUsed?"OK":"Ung\xfcltiges Ticket!"),r.a.createElement(f.a,{gap:"small"},r.a.createElement(S.a,{label:"Entwerte Ticket",onClick:this.obliterateTicketHandler}),r.a.createElement(S.a,{label:"Schlie\xdfen",onClick:this.closeTicketViewHandler})))),"disconnected"===this.state.connected&&r.a.createElement(f.a,null,r.a.createElement("p",null,"Die Verbindung wurde unterbrochen!"),r.a.createElement("p",null,"Bitte warten Sie einen Moment..."),r.a.createElement("p",{className:"loader"})),"failed"===this.state.connected&&r.a.createElement(f.a,null,r.a.createElement("p",null,"Die Verbindung wurde unterbrochen!"),r.a.createElement("p",null,"Bitte aktivieren Sie den Reader erneut."),r.a.createElement(S.a,{onClick:function(){e.setState({connected:null}),e.connectTicketReader()},label:"Ticket Reader Aktivieren"})))}}]),a}(r.a.Component),me=a(546),pe=a(551),ge=a(542),ke=a(135),fe=a.n(ke),be=function(){function e(){if(Object(h.a)(this,e),this._createDB=this._createDB.bind(this),this.saveTicketMirror=this.saveTicketMirror.bind(this),this.getTicketList=this.getTicketList.bind(this),!window.indexedDB)throw Error("Your browser doesn't support a stable version of IndexedDB. Such and such feature will not be available.");this.waitingForIDBReadyQueue=[],this._initDB(),this.onTicketListChanged=function(e){}}return Object(d.a)(e,[{key:"_initDB",value:function(){var e=this;console.debug("Initializing IDB Connection");var t=window.indexedDB.open(T.a.IDB_NAME,1);t.addEventListener("upgradeneeded",this._createDB),t.addEventListener("success",(function(t){console.debug("IDB Connection established"),e.db=t.target.result,e.waitingForIDBReadyQueue.forEach((function(t){t(e.db)}))})),t.addEventListener("error",(function(e){console.error("Database error: "+e.target.errorCode)}))}},{key:"_createDB",value:function(e){this.db=e.target.result;var t=this.db.createObjectStore("tickets",{keyPath:"identifier"});t.createIndex("forename","forename",{unique:!1}),t.createIndex("surname","surname",{unique:!1}),t.createIndex("ticketType","ticketType",{unique:!1})}},{key:"_getIDB",value:function(){var e=this;return new Promise((function(t){e.db?t(e.db):e.waitingForIDBReadyQueue.push(t)}))}},{key:"saveTicketMirror",value:function(){var e=Object(u.a)(l.a.mark((function e(t){var a,n;return l.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,this._getIDB();case 3:a=e.sent,(n=a.transaction("tickets","readwrite").objectStore("tickets")).clear(),t.forEach((function(e){n.add(e)})),this.onTicketListChanged(),e.next=14;break;case 10:e.prev=10,e.t0=e.catch(0),console.error(e.t0),alert("Es ist ein Fehler bei der Indexed DB aufgetreten");case 14:case"end":return e.stop()}}),e,this,[[0,10]])})));return function(t){return e.apply(this,arguments)}}()},{key:"getTicketList",value:function(){var e=this;return new Promise(function(){var t=Object(u.a)(l.a.mark((function t(a,n){var r,i,s;return l.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,e._getIDB().catch(console.error);case 2:if(r=t.sent){t.next=5;break}return t.abrupt("return",n());case 5:i=r.transaction("tickets","readonly").objectStore("tickets"),(s=i.getAll()).onerror=n,s.onsuccess=function(e){var t=e.target.result;return a(t)};case 9:case"end":return t.stop()}}),t)})));return function(e,a){return t.apply(this,arguments)}}())}},{key:"getTicket",value:function(e){var t=this;return new Promise(function(){var a=Object(u.a)(l.a.mark((function a(n,r){var i,s,c;return l.a.wrap((function(a){for(;;)switch(a.prev=a.next){case 0:return a.next=2,t._getIDB().catch(console.error);case 2:if(i=a.sent){a.next=5;break}return a.abrupt("return",r());case 5:s=i.transaction("tickets","readonly").objectStore("tickets"),(c=s.get(e)).onerror=r,c.onsuccess=function(e){var t=e.target.result;return t?n(t):r("Ticket does not exist.")};case 9:case"end":return a.stop()}}),a)})));return function(e,t){return a.apply(this,arguments)}}())}},{key:"obliterateTicket",value:function(e,t){var a=this;return new Promise(function(){var n=Object(u.a)(l.a.mark((function n(r,i){var s,c,o;return l.a.wrap((function(n){for(;;)switch(n.prev=n.next){case 0:return n.next=2,a._getIDB().catch(console.error);case 2:if(s=n.sent){n.next=5;break}return n.abrupt("return",i());case 5:c=s.transaction("tickets","readwrite").objectStore("tickets"),(o=c.get(e)).onerror=i,o.onsuccess=function(n){var s=n.target.result;if(!s)return i("Das Ticket existiert nicht.");var o=t+s.forename+s.surname+s.ticketType;if(fe.a.utils.sha3(o)!==e)return i("Die Identit\xe4t des Tickets konnte nicht verifiziert werden.");if(!s.isValid)return i("Das Ticket ist nicht g\xfcltig.");if(s.isUsed)return i("Das Ticket wurde breits entwertet.");s.isUsed=!0;var h=c.put(s);h.onerror=i,h.onsuccess=function(){var e=Object(u.a)(l.a.mark((function e(t){return l.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:r(t),a.onTicketListChanged();case 2:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}()};case 9:case"end":return n.stop()}}),n)})));return function(e,t){return n.apply(this,arguments)}}())}}]),e}(),ve=function(e){Object(p.a)(a,e);var t=Object(g.a)(a);function a(e){var n;if(Object(h.a)(this,a),(n=t.call(this,e)).state={lockDataset:!1,tickets:[]},n.handleDumpMirror=n.handleDumpMirror.bind(Object(m.a)(n)),n.showTickets=n.showTickets.bind(Object(m.a)(n)),n.lockHandler=n.lockHandler.bind(Object(m.a)(n)),n.usedTicketsCount=n.usedTicketsCount.bind(Object(m.a)(n)),!n.props.localTicketMirror)throw new Error("Missing LocalTicketMirror");return n.props.localTicketMirror.onTicketListChanged=n.showTickets,n}return Object(d.a)(a,[{key:"componentDidMount",value:function(){this.showTickets()}},{key:"translateTicketType",value:function(e){switch(e){case"0":return"Absolvent";case"1":return"Begleitperson";case"2":return"Parkticket"}}},{key:"handleDumpMirror",value:function(){var e=Object(u.a)(l.a.mark((function e(){var t,a,n;return l.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t=this.props.localTicketMirror,e.next=3,fetch(T.a.BACKEND_BASE_URI+"/api/v2/tickets/",{method:"GET",mode:"cors",cache:"no-cache",headers:{"Content-Type":"application/json",Authorization:"Bearer "+this.context.token}}).catch(console.log);case 3:if((a=e.sent).ok){e.next=6;break}return e.abrupt("return",alert("Beim Laden der Tickets ist ein Fehler aufgetreten."));case 6:return e.next=8,a.json().catch(console.log);case 8:if(n=e.sent){e.next=11;break}return e.abrupt("return",alert("Beim Laden der Tickets ist ein Fehler aufgetreten."));case 11:t.saveTicketMirror(n),this.showTickets();case 13:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"showTickets",value:function(){var e=Object(u.a)(l.a.mark((function e(){var t,a;return l.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t=this.props.localTicketMirror,e.next=3,t.getTicketList().catch(console.error);case 3:if(a=e.sent){e.next=6;break}return e.abrupt("return");case 6:this.setState({tickets:a.filter((function(e){return e.isValid&&e.ticketType<2})),lockDataset:a.length>0});case 7:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"lockHandler",value:function(e){e.target.checked?this.setState({lockDataset:e.target.checked}):window.confirm("Sind Sie sich sicher, dass sie den Datensatz erneut herunterladen m\xf6chten? Sie werden alle Daten zu bisher eingel\xf6sten Tickets verlieren.")&&this.setState({lockDataset:e.target.checked})}},{key:"usedTicketsCount",value:function(){var e=this.state.tickets.filter((function(e){return e.isUsed}));return e.length}},{key:"render",value:function(){var e=this,t=this.usedTicketsCount(),a=this.state.tickets.length-t;return r.a.createElement(f.a,{className:"EntranceDashboard",pad:"medium",gap:"small",direction:"column",wrap:!0},r.a.createElement(f.a,{className:"dashboardHead",direction:"row",wrap:!0,justify:"center"},r.a.createElement(me.a,{type:"digital",size:"xxlarge"})),r.a.createElement(f.a,{className:"dashboardRow1",direction:"row",wrap:!0,justify:"center",gap:"small"},r.a.createElement(f.a,{className:"dataControls",direction:"column",gap:"small",justify:"center"},r.a.createElement(S.a,{alignSelf:"center",label:"Ticketdaten f\xfcr den Offline-Einlass herunterladen",onClick:this.handleDumpMirror,disabled:this.state.lockDataset}),r.a.createElement(Y.a,{label:"Datensatz sch\xfctzen",toggle:!0,onChange:this.lockHandler,checked:this.state.lockDataset})),r.a.createElement(f.a,{className:"StatisticalSummary",direction:"column",wrap:!1},r.a.createElement("p",null,"Anzahl noch g\xfcltiger Personen-Tickets"),r.a.createElement(pe.a,null,r.a.createElement(ge.a,{type:"bar",values:[{value:a,label:"Anzahl noch g\xfcltiger Personen-Tickets"}],"aria-label":"meter",max:this.state.tickets.length,thickness:"large"}),r.a.createElement(v.a,{size:"2em",margin:"0.2em",alignSelf:"center"},a)),r.a.createElement("p",null,"Anzahl eingetretener Personen"),r.a.createElement(pe.a,null,r.a.createElement(ge.a,{type:"bar",values:[{value:t,label:"Anzahl eingetretener Personen"}],"aria-label":"meter",max:this.state.tickets.length,thickness:"large"}),r.a.createElement(v.a,{size:"2em",margin:"0.2em",alignSelf:"center"},t)))),r.a.createElement(f.a,{className:"TicketList"},r.a.createElement(x.a,{primaryKey:function(t){return r.a.createElement("b",{key:t.identifier+"t"},t.surname||"Unkown",", ",t.forename||"Unkown"," - ",e.translateTicketType(t.ticketType)," ",t.isWheelchairUser?"!Rollstuhlfahrer!":"")},secondaryKey:function(e){return r.a.createElement("span",{key:e.identifier+"s"},e.isUsed?"benutzt":"unbenutzt")},data:this.state.tickets})))}}]),a}(r.a.Component);ve.contextType=k;var Ee=ve,Se=function(){function e(){Object(h.a)(this,e),this.iceCandidatesHandler=this.iceCandidatesHandler.bind(this),this.dataChannelOpenHandler=this.dataChannelOpenHandler.bind(this),this.generateOfferCode=this.generateOfferCode.bind(this),this.dataChannelClosedHandler=this.dataChannelClosedHandler.bind(this),this.connectionChangeHandler=this.connectionChangeHandler.bind(this),this.setTicketReaderConfig=this.setTicketReaderConfig.bind(this),this.messageHandler=this.messageHandler.bind(this),this.uuid=this.createUUID(),this.onConnectionChanged=function(e){},this.onReady=function(){},this.onOffer=function(e){},this.onGetTicket=function(e,t){},this.onObliterateTicket=function(e,t,a){},this.initConnection()}return Object(d.a)(e,[{key:"initConnection",value:function(){this.icecandidates=[],this.localPeerConnection=new RTCPeerConnection(null),this.localPeerConnection.addEventListener("icecandidate",this.iceCandidatesHandler),this.localPeerConnection.addEventListener("connectionstatechange",this.connectionChangeHandler),this.dataChannel=this.localPeerConnection.createDataChannel("sendDataChannel",null),this.dataChannel.addEventListener("message",this.messageHandler),this.dataChannel.addEventListener("open",this.dataChannelOpenHandler),this.dataChannel.addEventListener("close",this.dataChannelClosedHandler),this.createOffer()}},{key:"iceCandidatesHandler",value:function(e){this.icecandidates.push(e.candidate),this.offer&&!this.qrcode&&setTimeout(this.generateOfferCode,200)}},{key:"connectionChangeHandler",value:function(e){console.debug(e);var t=e.target.connectionState;this.onConnectionChanged(t)}},{key:"dataChannelOpenHandler",value:function(e){console.debug(e),this.onReady(),this.dataChannel.send("Hallo Client!")}},{key:"dataChannelClosedHandler",value:function(e){console.debug("Data Channel Closed",e)}},{key:"messageHandler",value:function(e){var t,a=this;console.debug("Message received:",e.data);try{t=JSON.parse(e.data)}catch(n){return console.error(n),void console.debug("Message was:",e.data)}switch(t.context){case"ticketMirror":"getTicket"===t.method?this.onGetTicket(t.params[0],(function(e,n){var r={reqId:t.reqId,result:e,error:n};try{a.dataChannel.send(JSON.stringify(r))}catch(i){console.error(i)}})):"obliterateTicket"===t.method&&this.onObliterateTicket(t.params[0],t.params[1],(function(e,n){var r={reqId:t.reqId,result:e,error:n};try{a.dataChannel.send(JSON.stringify(r))}catch(i){console.error(i)}}))}}},{key:"createUUID",value:function(){var e=(new Date).getTime();return"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,(function(t){var a=(e+16*Math.random())%16|0;return e=Math.floor(e/16),("x"===t?a:0&a).toString(16)}))}},{key:"createOffer",value:function(){var e=Object(u.a)(l.a.mark((function e(){return l.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.localPeerConnection.createOffer().catch(console.error);case 2:return this.offer=e.sent,e.next=5,this.localPeerConnection.setLocalDescription(this.offer).catch(console.error);case 5:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"generateOfferCode",value:function(){var e=Object(u.a)(l.a.mark((function e(){var t;return l.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:t={offer:this.offer,candidates:this.icecandidates},this.onOffer(t);case 2:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"setTicketReaderConfig",value:function(){var e=Object(u.a)(l.a.mark((function e(t){var a=this;return l.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.localPeerConnection.setRemoteDescription(new RTCSessionDescription(t.answer)).catch(this.handleError);case 2:t.candidates.forEach((function(e){a.localPeerConnection.addIceCandidate(e).catch(a.handleError)}));case 3:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()}]),e}(),ye=function(e){Object(p.a)(a,e);var t=Object(g.a)(a);function a(e){var n;return Object(h.a)(this,a),(n=t.call(this,e)).state={},n.connectRemoteTicketReader=n.connectRemoteTicketReader.bind(Object(m.a)(n)),n.scanDoneHandler=n.scanDoneHandler.bind(Object(m.a)(n)),n}return Object(d.a)(a,[{key:"scanDoneHandler",value:function(e){var t=JSON.parse(he.a.inflate(e,{to:"string"}));this.state.connectRTR.setTicketReaderConfig(t)}},{key:"connectRemoteTicketReader",value:function(){var e=this,t=new Se;t.onReady=function(){e.setState({connectRTR:null}),e.props.onRTR(t)},t.onOffer=function(){var t=Object(u.a)(l.a.mark((function t(a){var n,r;return l.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return n=he.a.deflate(JSON.stringify(a),{level:9,to:"string"}),t.next=3,U.a.toDataURL(n).catch(console.error);case 3:r=t.sent,e.setState({RTRQRCode:r});case 5:case"end":return t.stop()}}),t)})));return function(e){return t.apply(this,arguments)}}(),this.setState({connectRTR:t,addRTRStep:0})}},{key:"render",value:function(){var e=this;return r.a.createElement(f.a,{className:"TicketReaderManager",pad:"medium"},r.a.createElement("p",null,"Derzeit sind ",this.props.RTRList.length," Ticket Leser verbunden."),r.a.createElement(x.a,{primaryKey:function(e){return r.a.createElement("b",{key:e.uuid+"t"}," ",e.uuid," - ",e.localPeerConnection.connectionState," ")},secondaryKey:function(e){return r.a.createElement("span",{key:e.uuid+"s"}," Click to remove ")},onClickItem:this.props.onRemoveRTR,data:this.props.RTRList}),r.a.createElement(S.a,{onClick:this.connectRemoteTicketReader,label:"Ticket Leser Hinzuf\xfcgen"}),this.state.connectRTR&&r.a.createElement(oe,{title:"Remote Ticket Reader Hinzuf\xfcgen",onAbort:function(){e.setState({connectRTR:null})}},0===this.state.addRTRStep&&r.a.createElement("div",null,r.a.createElement("div",{className:"ticket-reader-qrcode"},!this.state.RTRQRCode&&r.a.createElement("div",{className:"loader"},"Loading..."),this.state.RTRQRCode&&r.a.createElement("img",{src:this.state.RTRQRCode,width:"100%",alt:"Ein QR-Code sollte hier angezeigt werden."})),r.a.createElement("div",{className:"ticket-reader-description"},r.a.createElement("p",null,"Gehen Sie mit dem Zielger\xe4t auf die Unterseite #/entrance/"),r.a.createElement("p",null,"Scannen Sie den angezeigten QR-Code anschlie\xdfend mit dem Zielger\xe4t")),r.a.createElement("div",{className:"ticket-reader-action"},r.a.createElement(S.a,{onClick:function(){e.setState({addRTRStep:1})},label:"Weiter"}))),1===this.state.addRTRStep&&r.a.createElement("div",null,r.a.createElement("div",{className:"ticket-reader-scanner"},r.a.createElement(ce,{onDone:this.scanDoneHandler,label:"Scanvorgang starten"})),r.a.createElement("div",{className:"ticket-reader-description"},r.a.createElement("p",null,"Bitte nun den Code des Zielger\xe4ts scannen")))))}}]),a}(r.a.Component),we=a(541),Te=(a(58),function(e){Object(p.a)(a,e);var t=Object(g.a)(a);function a(e){var n;return Object(h.a)(this,a),(n=t.call(this,e)).state={Absolvententickets:0,Begleitertickets:0},n.setValuesAndChangeStep=n.setValuesAndChangeStep.bind(Object(m.a)(n)),n.changeToShopMangement=n.changeToShopMangement.bind(Object(m.a)(n)),n}return Object(d.a)(a,[{key:"setValuesAndChangeStep",value:function(){this.props.setConfMaxTicketsFromConf(this.state.Absolvententickets,this.state.Begleitertickets),window.location.assign("#/eventmgmt/shop")}},{key:"changeToShopMangement",value:function(){window.location.assign("#/eventmgmt/shop")}},{key:"render",value:function(){var e=this;return[][0]=r.a.createElement(f.a,{className:"outerBoxOverview",direction:"column",align:"center"},r.a.createElement(v.a,{weight:"bold",size:"xxlarge"},"Ticketkonfiguration"),r.a.createElement(f.a,{pad:"medium"}),"Hier k\xf6nnen die maximalen Tickets, die ein Benutzer (Absolvent) erwerben kann, konfiguriert werden.",r.a.createElement(f.a,{pad:"medium"},r.a.createElement(v.a,{weight:"bold"},"Absolvententickets:"),r.a.createElement(y.a,{type:"number",placeholder:"Absolvententickets",value:this.state.Absolvententickets,onChange:function(t){e.setState({Absolvententickets:parseInt(t.target.value)})}})),r.a.createElement(f.a,{pad:"medium"},r.a.createElement(v.a,{weight:"bold"},"Begleitertickets:"),r.a.createElement(y.a,{type:"number",placeholder:"Begleitertickets",value:this.state.Begleitertickets,onChange:function(t){e.setState({Begleitertickets:parseInt(t.target.value)})}})),r.a.createElement(f.a,{direction:"row",pad:"medium"},r.a.createElement(S.a,{label:"Zur\xfcck",onClick:this.changeToShopMangement}),r.a.createElement(S.a,{label:"Best\xe4tigen",onClick:this.setValuesAndChangeStep})))}}]),a}(r.a.Component));Te.contextType=k;var Oe=Te,Ce=function(e){Object(p.a)(a,e);var t=Object(g.a)(a);function a(e){var n;return Object(h.a)(this,a),(n=t.call(this,e)).state={open:[],paid:[],searchOpen:"",searchPaid:"",headline1:[{id:"ID der Buchung",email:"E-Mail-Adresse des Absolventen",createdAt:"Erstellungsdatum",approve:"Buchung freigeben",cancel:"Buchung stornieren"}],headline2:[{id:"ID der Buchung",email:"E-Mail-Adresse des Absolventen",createdAt:"Erstellungsdatum",cancel:"Buchung stornieren"}]},n.changeStep=n.changeStep.bind(Object(m.a)(n)),n.componentDidMount=n.componentDidMount.bind(Object(m.a)(n)),n.getBookings=n.getBookings.bind(Object(m.a)(n)),n.cancel=n.cancel.bind(Object(m.a)(n)),n.approve=n.approve.bind(Object(m.a)(n)),n.searchOpenHandler=n.searchOpenHandler.bind(Object(m.a)(n)),n.searchPaidHandler=n.searchPaidHandler.bind(Object(m.a)(n)),n.postTicket=n.postTicket.bind(Object(m.a)(n)),n}return Object(d.a)(a,[{key:"componentDidMount",value:function(){this.getBookings()}},{key:"getBookings",value:function(){var e=Object(u.a)(l.a.mark((function e(){var t,a,n,r,i,s,c;return l.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,fetch(T.a.BACKEND_BASE_URI+"/api/v2/bookings/",{method:"GET",mose:"cors",cache:"no-cache",headers:{"Content-Type":"application/json",Authorization:"Bearer "+this.context.token}}).catch(console.log);case 2:if((t=e.sent).ok){e.next=15;break}e.t0=t.status,e.next=500===e.t0?7:501===e.t0?9:11;break;case 7:return alert("Die Anmeldung ist aufgrund eines Server-Fehlers fehlgeschlagen. Bitte versuchen Sie es sp\xe4ter erneut."),e.abrupt("break",12);case 9:return alert("Der Server kann die gew\xfcnschte Anfrage nicht ausf\xfchren."),e.abrupt("break",12);case 11:alert(t.message);case 12:return e.abrupt("return");case 15:return e.next=17,t.json().catch(console.log);case 17:if(a=e.sent)for(n=0,r=0,i=[],s=[],c=0;c<a.length;c++)null!==a[c].paidAt&&!1===a[c].canceled&&(null!==a[c]&&(i[n]=a[c]),n+=1),null===a[c].paidAt&&!1===a[c].canceled&&(null!==a[c]&&(s[r]=a[c]),r+=1);this.setState({paid:i}),this.setState({open:s});case 21:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"cancel",value:function(){var e=Object(u.a)(l.a.mark((function e(t){return l.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,fetch(T.a.BACKEND_BASE_URI+"/api/v2/bookings/"+t,{method:"PUT",mode:"cors",cache:"no-cache",headers:{"Content-Type":"application/json",Authorization:"Bearer "+this.context.token},body:JSON.stringify({canceled:1})}).catch(console.log);case 2:if(e.sent.ok){e.next=8;break}return alert("Die Stornierung ist Fehlgeschlagen"),e.abrupt("return");case 8:alert("Die Buchung mit der Buchungs-ID "+t+" wurde storniert."),this.componentDidMount();case 10:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"approve",value:function(){var e=Object(u.a)(l.a.mark((function e(t){var a,n,r,i;return l.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return a=Date.now(),e.next=3,fetch(T.a.BACKEND_BASE_URI+"/api/v2/bookings/"+t,{method:"PUT",mode:"cors",cache:"no-cache",headers:{"Content-Type":"application/json",Authorization:"Bearer "+this.context.token},body:JSON.stringify({paidAt:a})}).catch(console.log);case 3:if(e.sent.ok){e.next=9;break}return alert("Die Best\xe4tigung ist fehlgeschlagen"),e.abrupt("return");case 9:return alert("Die Buchung mit der Buchungs-ID "+t+" wurde best\xe4tigt."),e.next=12,fetch(T.a.BACKEND_BASE_URI+"/api/v2/bookings/"+t+"/ticketsBooked/",{method:"GET",mode:"cors",cache:"no-cache",headers:{"Content-Type":"application/json",Authorization:"Bearer "+this.context.token}}).catch(console.log);case 12:if((n=e.sent).ok){e.next=18;break}return alert("Das Abrufen der Tickets ist fehlgeschlagen!"),e.abrupt("return");case 18:return e.next=20,n.json().catch(console.log);case 20:for(r=e.sent,i=0;i<r.length;i++)this.postTicket(r[i].identifier);case 22:this.componentDidMount();case 23:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"postTicket",value:function(){var e=Object(u.a)(l.a.mark((function e(t){var a;return l.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,fetch(T.a.BACKEND_BASE_URI+"/api/v2/tickets/",{method:"POST",mode:"cors",cache:"no-cache",headers:{"Content-Type":"application/json",Authorization:"Bearer "+this.context.token},body:JSON.stringify({identifier:t})}).catch(console.log);case 2:if(a=e.sent){e.next=6;break}return console.log("Keine Antwort vom Backend bei der Erstellung eines Tickets!"),e.abrupt("return");case 6:if(a.ok){e.next=9;break}return console.log("Fehler bei der Erstellung eines Tickets!"),e.abrupt("return");case 9:if(!a.ok){e.next=12;break}return console.log("Ticket wurde erstellt!"),e.abrupt("return");case 12:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"changeStep",value:function(){window.location.assign("#/eventmgmt/shop")}},{key:"searchOpenHandler",value:function(e){this.setState({searchOpen:e.target.value})}},{key:"searchPaidHandler",value:function(e){this.setState({searchPaid:e.target.value})}},{key:"render",value:function(){var e,t,a=this,n=this.state.searchOpen;e=""!==n?this.state.open.filter((function(e){return e.user.email.toLowerCase().includes(n.toLowerCase())})):this.state.open;var i=this.state.searchPaid;return t=""!==i?this.state.paid.filter((function(e){return e.user.email.toLowerCase().includes(i.toLowerCase())})):this.state.paid,[][0]=r.a.createElement(f.a,{className:"outerBoxOverview",direction:"column",align:"center"},r.a.createElement(v.a,{weight:"bold",size:"xlarge"},"Bestellungs\xfcbersicht"),r.a.createElement(f.a,{pad:"medium"},r.a.createElement(v.a,null,"Hier k\xf6nnen die Bestellungen eingesehen, freigegeben und storniert werden."),r.a.createElement(S.a,{label:"Zur\xfcck zur \xdcbersichtsseite",onClick:this.changeStep,pad:"small"})),r.a.createElement(f.a,{pad:"medium"},r.a.createElement(v.a,null,"Offene Bestellungen: "),r.a.createElement(f.a,{pad:"small"},r.a.createElement(x.a,{pad:"medium",alignSelf:"stretch",margin:"small",primaryKey:function(e){return r.a.createElement("b",{key:e.id+"t"}," ",e.id||"Unknown"," ")},secondaryKey:function(e){return r.a.createElement("span",{key:e.id+"s"}," ","|   "+e.email+"   |"||!1," ",e.createdAt+"   |"||!1," ",e.approve+"   |"||!1," ",e.cancel+"   |"||!1," ")},data:this.state.headline1}),r.a.createElement(y.a,{gap:"small",placeholder:"Zum Suchen in den offenen Buchungen bitte eine E-Mail-Adresse eingeben",value:this.state.searchOpen,onChange:this.searchOpenHandler}),r.a.createElement(x.a,{pad:"medium",alignSelf:"stretch",margin:"small",primaryKey:function(e){return r.a.createElement("b",{key:e.id+"t"}," ",e.id||"Unknown"," ")},secondaryKey:function(e){return r.a.createElement("span",{key:e.id+"s"}," ","|  "+e.user.email+"    |"||!1,"     ",new Date(e.createdAt).toLocaleDateString()+"    |"||!1," ",r.a.createElement(S.a,{label:"Buchung freigeben",onClick:function(){a.approve(e.id)}})," | ",r.a.createElement(S.a,{label:"Buchung stornieren",onClick:function(){a.cancel(e.id)}}))},data:e}))),r.a.createElement(f.a,{pad:"medium"},r.a.createElement(v.a,null,"Abgeschlossene Bestellungen: "),r.a.createElement(f.a,{pad:"small"},r.a.createElement(x.a,{pad:"medium",alignSelf:"stretch",margin:"small",primaryKey:function(e){return r.a.createElement("b",{key:e.id+"t"}," ",e.id||"Unknown"," ")},secondaryKey:function(e){return r.a.createElement("span",{key:e.id+"s"}," ","|   "+e.email+"   |"||!1," ",e.createdAt+"   |"||!1," ",e.cancel+"   |"||!1," ")},data:this.state.headline2}),r.a.createElement(y.a,{gap:"small",placeholder:"Zum Suchen in den bezahlten Buchungen bitte eine E-Mail-Adresse eingeben",value:this.state.searchPaid,onChange:this.searchPaidHandler}),r.a.createElement(x.a,{pad:"medium",alignSelf:"stretch",margin:"small",primaryKey:function(e){return r.a.createElement("b",{key:e.id+"t"}," ",e.id||"Unknown"," ")},secondaryKey:function(e,t){return r.a.createElement("span",{key:e.id+"s"}," ","|  "+e.user.email+"    |"||!1,"     ",new Date(e.createdAt).toLocaleDateString()+"    |"||!1," ",r.a.createElement(S.a,{label:"Buchung stornieren",onClick:function(){a.cancel(e.id)}}))},data:t}))))}}]),a}(r.a.Component);Ce.contextType=k;var xe=Ce,Pe=function(e){Object(p.a)(a,e);var t=Object(g.a)(a);function a(e){var n;return Object(h.a)(this,a),(n=t.call(this,e)).state={salesStatus:"Aktivieren"},n.setValuesAndChangeStep=n.setValuesAndChangeStep.bind(Object(m.a)(n)),n.switchSalesStatus=n.switchSalesStatus.bind(Object(m.a)(n)),n.changeToShopMangement=n.changeToShopMangement.bind(Object(m.a)(n)),n}return Object(d.a)(a,[{key:"switchSalesStatus",value:function(){return this.props.salesStatus?r.a.createElement(v.a,{weight:"bold"},"Aktiv"):this.props.salesStatus?void 0:r.a.createElement(v.a,{weight:"bold"},"Nicht Aktiv")}},{key:"setValuesAndChangeStep",value:function(){var e="";if("Aktivieren"===this.state.salesStatus&&(e=!0),"Deaktivieren"===this.state.salesStatus&&(e=!1),e===this.props.salesStatus)return console.log("Der Sales Status wurde wurde nicht ver\xe4ndert! Es wird keine Nachricht an das Backend gesendet"),void window.location.assign("#/eventmgmt/shop");e!==this.props.salesStatus&&(this.props.setConfSalesStatus(e),window.location.assign("#/eventmgmt/shop"))}},{key:"changeToShopMangement",value:function(){window.location.assign("#/eventmgmt/shop")}},{key:"render",value:function(){var e=this;return[][0]=r.a.createElement(f.a,{pad:"medium",align:"center",style:{position:"absolute",left:"40%",top:"10%"}},r.a.createElement(f.a,{className:"outerBoxOverview",direction:"column",align:"center"},r.a.createElement(v.a,{weight:"bold",size:"xxlarge"},"Status des Verkaufs \xe4ndern"),r.a.createElement(f.a,{pad:"medium"},r.a.createElement(v.a,null,"Der Verkauf ist derzeit: ",this.switchSalesStatus())),r.a.createElement(f.a,null,r.a.createElement(P.a,{options:["Aktivieren","Deaktivieren"],value:this.state.salesStatus,onChange:function(t){var a=t.option;e.setState({salesStatus:a})}})),r.a.createElement(f.a,{direction:"row",pad:"medium"},r.a.createElement(S.a,{label:"Zur\xfcck",onClick:this.changeToShopMangement}),r.a.createElement(S.a,{label:"Best\xe4tigen",onClick:this.setValuesAndChangeStep}))))}}]),a}(r.a.Component);Pe.contextType=k;var Ae=Pe,Be=a(248),je=function(e){Object(p.a)(a,e);var t=Object(g.a)(a);function a(e){var n;return Object(h.a)(this,a),(n=t.call(this,e)).handleOnDrop=function(e){var t=[];e.filter((function(e){return e.data.eMail.match("@")})).forEach((function(e){var a={eMail:e.data.eMail,Name:e.data.Name};t.push(a)})),n.setState({listeEingelesen:!0,initialeListe:t})},n.handleOnError=function(e,t,a,n){console.log(e)},n.handleOnRemoveFile=function(e){},n.state={listeEingelesen:!1,initialeListe:[]},n.transferListForCreation=n.transferListForCreation.bind(Object(m.a)(n)),n.switchBackToShopmanagament=n.switchBackToShopmanagament.bind(Object(m.a)(n)),n}return Object(d.a)(a,[{key:"transferListForCreation",value:function(){var e=Object(u.a)(l.a.mark((function e(){var t,a,n,r,i,s;return l.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:t=this.state.initialeListe,a=0,n=Object(X.a)(t),e.prev=3,n.s();case 5:if((r=n.n()).done){e.next=15;break}return i=r.value,e.next=9,this.props.createOTPwithEmailAndRole(i.eMail,1);case 9:s=e.sent,console.log(s),1===s&&(a+=s),1!==s&&console.log("Fehler beim Senden der One Time Passw\xf6rter in Unterkomponentte: "+s);case 13:e.next=5;break;case 15:e.next=20;break;case 17:e.prev=17,e.t0=e.catch(3),n.e(e.t0);case 20:return e.prev=20,n.f(),e.finish(20);case 23:console.log("One Time Passw\xf6rter f\xfcr: "+a+" E-Mail-Adressen erstellt!"),this.props.setShopConfigInitialList(!0),window.location.assign("#/eventmgmt/shop");case 26:case"end":return e.stop()}}),e,this,[[3,17,20,23]])})));return function(){return e.apply(this,arguments)}}()},{key:"switchBackToShopmanagament",value:function(){window.location.assign("#/eventmgmt/shop")}},{key:"render",value:function(){var e=this.state.initialeListe;return r.a.createElement(f.a,{style:{position:"absolute",left:"40%",top:"10%"}},r.a.createElement(f.a,{pad:"medium"},r.a.createElement(v.a,{size:"large",weight:"bold"},"Einlesen der Absolventen Liste")),r.a.createElement(f.a,{className:"Eingaben"},r.a.createElement(f.a,{pad:"medium"},r.a.createElement(v.a,null,"Bitte eine Liste in der folgenden Darstellung einlesen:"),r.a.createElement("span",null,r.a.createElement(v.a,{weight:"bold"},"Header: "),r.a.createElement(v.a,null,"eMail; Name")),r.a.createElement("span",null,r.a.createElement(v.a,{weight:"bold"},"Datensatz 1: "),r.a.createElement(v.a,null,"Beispiel@web.de; Mustermann, Max"))),r.a.createElement(Be.a,{onDrop:this.handleOnDrop,onError:this.handleOnError,config:{delimiter:";",header:!0},addRemoveButton:!0,onRemoveFile:this.handleOnRemoveFile},r.a.createElement("span",null,"Drop CSV file here or click to upload."))),r.a.createElement(x.a,{className:"langeListe",pad:"medium",primaryKey:"eMail",secondaryKey:"Name",data:e}),r.a.createElement(f.a,{pad:"medium"},r.a.createElement(S.a,{onClick:this.transferListForCreation,label:"Passw\xf6rter erstellen"})),r.a.createElement(f.a,{pad:"medium"},r.a.createElement(S.a,{onClick:this.switchBackToShopmanagament,label:"Zur\xfcck"})))}}]),a}(r.a.Component),De=function(e){Object(p.a)(a,e);var t=Object(g.a)(a);function a(e){var n;return Object(h.a)(this,a),(n=t.call(this,e)).state={receiverName:"",bankName:"",iban:"",bic:"",verwendung:"",bankAktiviert:!1,payPalLink:"",payPalMail:"",payPalVerwendung:"",payPalAktiviert:!1,bankStatus:"Deaktiviert",payPalStatus:"Deaktiviert"},n.changeStep=n.changeStep.bind(Object(m.a)(n)),n.receiverNameHandler=n.receiverNameHandler.bind(Object(m.a)(n)),n.bankNameHandler=n.bankNameHandler.bind(Object(m.a)(n)),n.ibanHandler=n.ibanHandler.bind(Object(m.a)(n)),n.bicHandler=n.bicHandler.bind(Object(m.a)(n)),n.verwendungHandler=n.verwendungHandler.bind(Object(m.a)(n)),n.assignBankValues=n.assignBankValues.bind(Object(m.a)(n)),n.payPalLinkHandler=n.payPalLinkHandler.bind(Object(m.a)(n)),n.payPalMailHandler=n.payPalMailHandler.bind(Object(m.a)(n)),n.payPalVerwendungHandler=n.payPalVerwendungHandler.bind(Object(m.a)(n)),n.assignPayPalValues=n.assignPayPalValues.bind(Object(m.a)(n)),n.switchBankStatus=n.switchBankStatus.bind(Object(m.a)(n)),n.setBankValuesAndChangeStep=n.setBankValuesAndChangeStep.bind(Object(m.a)(n)),n.switchPayPalStatus=n.switchPayPalStatus.bind(Object(m.a)(n)),n.setPayPalValuesAndChangeStep=n.setPayPalValuesAndChangeStep.bind(Object(m.a)(n)),n}return Object(d.a)(a,[{key:"changeStep",value:function(){window.location.assign("#/eventmgmt/shop")}},{key:"componentDidMount",value:function(){this.props.bankStatus&&this.setState({bankStatus:"Aktiviert"}),this.props.bankStatus||this.setState({bankStatus:"Deaktiviert"}),this.props.payPalStatus&&this.setState({payPalStatus:"Aktiviert"}),this.props.payPalStatus||this.setState({payPalStatus:"Deaktiviert"})}},{key:"receiverNameHandler",value:function(e){this.setState({receiverName:e.target.value})}},{key:"bankNameHandler",value:function(e){this.setState({bankName:e.target.value})}},{key:"ibanHandler",value:function(e){this.setState({iban:e.target.value})}},{key:"bicHandler",value:function(e){this.setState({bic:e.target.value})}},{key:"verwendungHandler",value:function(e){this.setState({verwendung:e.target.value})}},{key:"assignBankValues",value:function(){var e=Object(u.a)(l.a.mark((function e(){var t,a,n,r,i,s,c;return l.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t=this.state.receiverName,a=this.state.bankName,n=this.state.iban,r=this.state.bic,i=this.state.verwendung,s=this.state.bankAktiviert,e.next=8,fetch(T.a.BACKEND_BASE_URI+"/api/v2/paymentOptions",{method:"PUT",mode:"cors",cache:"no-cache",headers:{"Content-Type":"application/json",Authorization:"Bearer "+this.context.token},body:JSON.stringify({Bank:{Empf\u00e4nger:t,Name_der_Bank:a,IBAN:n,BIC:r,Verwendungszweck:i,Aktiviert:s}})}).catch(console.log);case 8:if(c=e.sent){e.next=12;break}return console.log("Keine Antwort beim Konfigurieren der Bankverbindung vom Backend-Server erhalten!"),e.abrupt("return");case 12:if(c.ok){e.next=15;break}return console.log("Fehler beim Setzten der Werte f\xfcr die Bankverbindung: "+c.message),e.abrupt("return");case 15:c.ok&&console.log("Die Konfiguration der Bankverbindung wurde erfolgreich ge\xe4ndert. Die gesetzten Werte sind: Empf\xe4nger: "+t+", Name der Bank: "+a+", IBAN: "+n+", BIC: "+r+", Verwendungszweck: "+i);case 16:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"payPalLinkHandler",value:function(e){this.setState({payPalLink:e.target.value})}},{key:"payPalMailHandler",value:function(e){this.setState({payPalMail:e.target.value})}},{key:"payPalVerwendungHandler",value:function(e){this.setState({payPalVerwendung:e.target.value})}},{key:"assignPayPalValues",value:function(){var e=Object(u.a)(l.a.mark((function e(){var t,a,n,r,i;return l.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t=this.state.payPalLink,a=this.state.payPalMail,n=this.state.payPalVerwendung,r=this.state.payPalAktiviert,e.next=6,fetch(T.a.BACKEND_BASE_URI+"/api/v2/paymentOptions",{method:"PUT",mode:"cors",cache:"no-cache",headers:{"Content-Type":"application/json",Authorization:"Bearer "+this.context.token},body:JSON.stringify({PayPal:{PayPal_Link:t,PayPal_Mail:a,PayPal_Verwendung:n,Aktiviert:r}})}).catch(console.log);case 6:if(i=e.sent){e.next=10;break}return console.log("Keine Antwort beim Konfigurieren der PayPal-Verbindung vom Backend-Server erhalten!"),e.abrupt("return");case 10:if(i.ok){e.next=13;break}return console.log("Fehler beim Setzten der Werte f\xfcr die PayPal-Verbindung: "+i.message),e.abrupt("return");case 13:i.ok&&console.log("Die Konfiguration der PayPal-Verbindung wurde erfolgreich ge\xe4ndert. Die gesetzten Werte sind: PayPal-Link: "+t+", PayPal-Mail: "+a+", PayPal-Verwendungszweck: "+n);case 14:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"switchBankStatus",value:function(){return this.props.bankStatus?r.a.createElement(v.a,{weight:"bold"}," Aktiviert "):this.props.bankStatus?void 0:r.a.createElement(v.a,{weight:"bold"}," Deaktiviert ")}},{key:"setBankValuesAndChangeStep",value:function(){var e="";"Deaktiviert"===this.state.bankStatus&&(e=!1),"Aktiviert"===this.state.bankStatus&&(e=!0),e!==this.props.bankStatus?e!==this.props.bankStatus&&this.props.setConfBankStatus(e):alert("Der Status der Bankverbindung wurde wurde nicht ver\xe4ndert! Es wird keine Nachricht an das Backend gesendet")}},{key:"switchPayPalStatus",value:function(){return this.props.payPalStatus?r.a.createElement(v.a,{weight:"bold"}," Aktiviert "):this.props.payPalStatus?void 0:r.a.createElement(v.a,{weight:"bold"}," Deaktiviert ")}},{key:"setPayPalValuesAndChangeStep",value:function(){var e="";"Deaktiviert"===this.state.payPalStatus&&(e=!1),"Aktiviert"===this.state.payPalStatus&&(e=!0),e!==this.props.payPalStatus?e!==this.props.payPalStatus&&this.props.setConfPayPalStatus(e):alert("Der Status der Bankverbindung wurde wurde nicht ver\xe4ndert! Es wird keine Nachricht an das Backend gesendet")}},{key:"render",value:function(){var e=this;return[][0]=r.a.createElement(f.a,{className:"outerBoxOverview",direction:"column",align:"center"},r.a.createElement(E.a,{align:"center",size:"small"},"Konfiguration der Zahlungsmethoden"),r.a.createElement(f.a,{pad:"small",gap:"small",align:"center"},r.a.createElement(f.a,{pad:"medium",gap:"small"},r.a.createElement(v.a,null,r.a.createElement("b",null,"Konfiguration einer Bankverbindung")),r.a.createElement(y.a,{placeholder:"Name des Empf\xe4ngers",value:this.state.receiverName,onChange:this.receiverNameHandler}),r.a.createElement(y.a,{placeholder:"Name der Bank",value:this.state.bankName,onChange:this.bankNameHandler}),r.a.createElement(y.a,{placeholder:"IBAN",value:this.state.iban,onChange:this.ibanHandler}),r.a.createElement(y.a,{placeholder:"BIC",value:this.state.bic,onChange:this.bicHandler}),r.a.createElement(y.a,{placeholder:"Verwendungszweck",value:this.state.verwendung,onChange:this.verwendungHandler}),r.a.createElement(S.a,{label:"Angaben f\xfcr die Bankverbindung best\xe4tigen",onClick:this.assignBankValues}),r.a.createElement(f.a,null,r.a.createElement(v.a,null,"Die Bankverbindung ist derzeit: ",this.switchBankStatus()," ")),r.a.createElement(f.a,null,r.a.createElement(P.a,{options:["Aktiviert","Deaktiviert"],value:this.state.bankStatus,onChange:function(t){var a=t.option;e.setState({bankStatus:a})}}),r.a.createElement(S.a,{label:"Auswahl best\xe4tigen",onClick:this.setBankValuesAndChangeStep}))),r.a.createElement(f.a,{pad:"medium",gap:"small"},r.a.createElement(v.a,null,r.a.createElement("b",null,"Konfiguration einer PayPal-Verbindung")),r.a.createElement(y.a,{placeholder:"PayPal.me-Link",value:this.state.payPalLink,onChange:this.payPalLinkHandler}),r.a.createElement(y.a,{placeholder:"PayPal Mail-Adresse",value:this.state.payPalMail,onChange:this.payPalMailHandler}),r.a.createElement(y.a,{placeholder:"PayPal Verwendungszweck",value:this.state.payPalVerwendung,onChange:this.payPalVerwendungHandler}),r.a.createElement(S.a,{label:"Angaben f\xfcr die PayPal-Verbindung best\xe4tigen",onClick:this.assignPayPalValues}),r.a.createElement(f.a,null,r.a.createElement(v.a,null,"Die PayPal-Verbindung ist derzeit: ",this.switchPayPalStatus()," ")),r.a.createElement(f.a,null,r.a.createElement(P.a,{options:["Aktiviert","Deaktiviert"],value:this.state.payPalStatus,onChange:function(t){var a=t.option;e.setState({payPalStatus:a})}}),r.a.createElement(S.a,{label:"Auswahl best\xe4tigen",onClick:this.setPayPalValuesAndChangeStep}))),r.a.createElement(S.a,{label:"Zur\xfcck zur \xdcbersicht",onClick:this.changeStep})))}}]),a}(r.a.Component);De.contextType=k;var ze=De,Me=function(e){Object(p.a)(a,e);var t=Object(g.a)(a);function a(e){var n;return Object(h.a)(this,a),(n=t.call(this,e)).state={OTP:"",role:1,lastEmail:"",lastRole:""},n.changeToShopMangement=n.changeToShopMangement.bind(Object(m.a)(n)),n.addOTP=n.addOTP.bind(Object(m.a)(n)),n}return Object(d.a)(a,[{key:"changeToShopMangement",value:function(){window.location.assign("#/eventmgmt/shop")}},{key:"addOTP",value:function(){var e=Object(u.a)(l.a.mark((function e(){var t;return l.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return"Administrator"===this.state.role&&(t=0),"Absolvent"===this.state.salesStatus&&(t=1),e.next=4,this.props.createOTPwithEmailAndRole(this.state.OTP,t);case 4:1===e.sent&&this.setState({lastEmail:this.state.OTP,lastRole:this.state.role});case 6:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"render",value:function(){var e=this;return[][0]=r.a.createElement(f.a,{className:"outerBoxOverview",direction:"column",align:"center",style:{position:"absolute",left:"40%",top:"10%"}},r.a.createElement(v.a,{weight:"bold",size:"xxlarge"},"Verwaltung der One Time Passw\xf6rter"),r.a.createElement(f.a,{pad:"medium",direction:"column"},r.a.createElement(v.a,null,"Letzter hinzugef\xfcgter Datensatz"),r.a.createElement(v.a,{weight:"bold"},"E-Mail-Adresse: ",this.state.lastEmail," "),r.a.createElement(v.a,{weight:"bold"},"Rolle: ",this.state.lastRole," ")),r.a.createElement(f.a,{pad:"medium",direction:"row"},r.a.createElement(y.a,{placeholder:"Hier E-Mail-Adresse eingeben",value:this.state.OTP,onChange:function(t){e.setState({OTP:t.target.value})}}),r.a.createElement(P.a,{placeholder:"Rolle ausw\xe4hlen",options:["Administrator","Absolvent"],value:this.state.role,onChange:function(t){var a=t.option;e.setState({role:a})}})),r.a.createElement(f.a,{pad:"medium",direction:"row"},r.a.createElement(S.a,{label:"Zur\xfcck",onClick:this.changeToShopMangement}),r.a.createElement(S.a,{label:"Hinzuf\xfcgen",onClick:this.addOTP})))}}]),a}(r.a.Component),Ne=function(e){Object(p.a)(a,e);var t=Object(g.a)(a);function a(e){var n;return Object(h.a)(this,a),(n=t.call(this,e)).state={OTPs:[],searchOTP:"",headline1:[{id:"ID des One Time Passworts",email:"E-Mail-Adresse des Benutzers",targetRole:"Rolle f\xfcr den Benutzer",createdAt:"Erstellungsdatum",cancel:"OTP l\xf6schen"}]},n.getOTPs=n.getOTPs.bind(Object(m.a)(n)),n.changeStep=n.changeStep.bind(Object(m.a)(n)),n.componentDidMount=n.componentDidMount.bind(Object(m.a)(n)),n.searchOTPHandler=n.searchOTPHandler.bind(Object(m.a)(n)),n.deleteOtp=n.deleteOtp.bind(Object(m.a)(n)),n}return Object(d.a)(a,[{key:"componentDidMount",value:function(){this.getOTPs()}},{key:"getOTPs",value:function(){var e=Object(u.a)(l.a.mark((function e(){var t,a,n;return l.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,fetch(T.a.BACKEND_BASE_URI+"/api/v2/oneTimePasses/",{method:"GET",mose:"cors",cache:"no-cache",headers:{"Content-Type":"application/json",Authorization:"Bearer "+this.context.token}}).catch(console.log);case 2:if((t=e.sent).ok){e.next=8;break}return console.log(t.message),e.abrupt("return");case 8:return e.next=10,t.json().catch(console.log);case 10:a=e.sent,n=[],a.forEach((function(e){1===e.targetRole?e.targetRole="Absolvent":0===e.targetRole?e.targetRole="Administrator":e.targetRole="Undefined",n.push(e)})),this.setState({OTPs:n});case 14:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"deleteOtp",value:function(){var e=Object(u.a)(l.a.mark((function e(t){return l.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,fetch(T.a.BACKEND_BASE_URI+"/api/v2/oneTimePasses/"+t,{method:"DELETE",mode:"cors",cache:"no-cache",headers:{"Content-Type":"application/json",Authorization:"Bearer "+this.context.token}}).catch(console.log);case 2:if(e.sent.ok){e.next=8;break}return alert("Die L\xf6sung des One Time Passworts ist Fehlgeschlagen"),e.abrupt("return");case 8:alert("Das One Time Passwort mit der: "+t+" wurde gel\xf6scht."),this.componentDidMount();case 10:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"changeStep",value:function(){window.location.assign("#/eventmgmt/shop")}},{key:"searchOTPHandler",value:function(e){this.setState({searchOTP:e.target.value})}},{key:"render",value:function(){var e,t=this,a=this.state.searchOTP;return e=""!==a?this.state.OTPs.filter((function(e){return e.email.toLowerCase().includes(a.toLowerCase())})):this.state.OTPs,[][0]=r.a.createElement(f.a,{className:"outerBoxOverview",direction:"column",align:"center"},r.a.createElement(v.a,{weight:"bold",size:"xlarge"},"One Time Passwort \xdcbersicht"),r.a.createElement(f.a,{pad:"medium"}),r.a.createElement(v.a,null,"Hier k\xf6nnen die One Time Passw\xf6rter angezeigt und gel\xf6scht werden."),r.a.createElement(f.a,{pad:"medium"}),r.a.createElement(S.a,{label:"Zur\xfcck zur \xdcbersichtsseite",onClick:this.changeStep,pad:"small"}),r.a.createElement(f.a,{pad:"medium"}),r.a.createElement(f.a,{pad:"small"},r.a.createElement(x.a,{pad:"medium",alignSelf:"stretch",margin:"small",primaryKey:function(e){return r.a.createElement("b",{key:e.id+"t"}," ",e.id||"Unknown"," ")},secondaryKey:function(e){return r.a.createElement("span",{key:e.id+"s"}," ","|   "+e.email+"   |"||!1,e.createdAt+"   |"||!1," ",e.cancel+"   |"||!1," ")},data:this.state.headline1}),r.a.createElement(y.a,{gap:"small",placeholder:"Zum Suchen in den offenen Buchungen bitte eine E-Mail-Adresse eingeben",value:this.state.searchOTP,onChange:this.searchOTPHandler}),r.a.createElement(x.a,{pad:"medium",alignSelf:"stretch",margin:"small",primaryKey:function(e){return r.a.createElement("b",{key:e.id+"t"}," ",e.id||"Unknown"," ")},secondaryKey:function(e){return r.a.createElement("span",{key:e.id+"s"}," ","|  "+e.email+"    |"||!1," ",e.targetRole+"    |"||!1,"   ",new Date(e.createdAt).toLocaleDateString()||"Unknown"," | ",r.a.createElement(S.a,{label:"OTP l\xf6schen",onClick:function(){t.deleteOtp(e.id)}}))},data:e})))}}]),a}(r.a.Component);Ne.contextType=k;var Re=Ne,_e=function(e){Object(p.a)(a,e);var t=Object(g.a)(a);function a(e){var n;return Object(h.a)(this,a),(n=t.call(this,e)).state={},n.callShopManagamentConfTickets=n.callShopManagamentConfTickets.bind(Object(m.a)(n)),n}return Object(d.a)(a,[{key:"callShopManagamentConfTickets",value:function(){window.location.assign("#/eventmgmt/shop/ConfMaxTickets")}},{key:"render",value:function(){return r.a.createElement(f.a,{name:"purchaseableTicketsPerPerson",className:"quickViewOuterBox"},r.a.createElement(v.a,null,"Ticketanzahl die ein Absolvent erwerben kann:"),r.a.createElement(f.a,{className:"platzhalter"}),r.a.createElement(we.a,{className:"quickViewDatatables",columns:[{property:"Tickettype",header:r.a.createElement(v.a,{weight:"bold"},"Tickettyp"),primary:!0},{property:"Anzahl",header:r.a.createElement(v.a,{weight:"bold"},"freigebene Anzahl")}],data:this.props.maxTicketmenge}),r.a.createElement(f.a,{className:"platzhalter"}),r.a.createElement(f.a,{className:"ButtonBox"},r.a.createElement(S.a,{className:"buttonInDash",label:"Ticketanzahl konfigurieren",onClick:this.callShopManagamentConfTickets})))}}]),a}(r.a.Component),He=function(e){Object(p.a)(a,e);var t=Object(g.a)(a);function a(e){var n;return Object(h.a)(this,a),(n=t.call(this,e)).state={},n}return Object(d.a)(a,[{key:"callConfiguratePaymentMethods",value:function(){window.location.assign("#/eventmgmt/shop/paymentOptions")}},{key:"componentDidMount",value:function(){this.props.getBankStatus(),this.props.getPayPalStatus()}},{key:"render",value:function(){var e=[];return this.props.bankStatus&&e.push({BezahlOption:"Bank\xfcberweisung",Status:"Aktiv"}),this.props.bankStatus||e.push({BezahlOption:"Bank\xfcberweisung",Status:"Deaktiviert"}),this.props.payPalStatus&&e.push({BezahlOption:"PayPal",Status:"Aktiv"}),this.props.payPalStatus||e.push({BezahlOption:"PayPal",Status:"Deaktiviert"}),r.a.createElement(f.a,{name:"paymentOptions",className:"quickViewOuterBox"},r.a.createElement(v.a,null,"\xdcbersicht der konfigurierten Bezahloptionen:"),r.a.createElement(f.a,{className:"platzhalter"}),r.a.createElement(we.a,{className:"quickViewDatatables",columns:[{property:"BezahlOption",header:r.a.createElement(v.a,{weight:"bold"},"Bezahloption"),primary:!0},{property:"Status",header:r.a.createElement(v.a,{weight:"bold"},"Status?")}],data:e}),r.a.createElement(f.a,{className:"platzhalter"}),r.a.createElement(f.a,{className:"ButtonBox"},r.a.createElement(S.a,{className:"buttonInDash",label:"Bezahloptionen konfigurieren",onClick:this.callConfiguratePaymentMethods})))}}]),a}(r.a.Component),Ie=function(e){Object(p.a)(a,e);var t=Object(g.a)(a);function a(e){var n;return Object(h.a)(this,a),(n=t.call(this,e)).state={},n.callShopManagementViewBookings=n.callShopManagementViewBookings.bind(Object(m.a)(n)),n}return Object(d.a)(a,[{key:"callShopManagementViewBookings",value:function(){window.location.assign("#/eventmgmt/shop/viewBookings")}},{key:"render",value:function(){return r.a.createElement(f.a,{name:"statusBookings",className:"quickViewOuterBox"},r.a.createElement(v.a,null,"Anzahl und Status der Buchungen im System:"),r.a.createElement(f.a,{className:"platzhalter"}),r.a.createElement(we.a,{className:"quickViewDatatables",columns:[{property:"status",header:r.a.createElement(v.a,{weight:"bold"},"Status"),primary:!0},{property:"Anzahl",header:r.a.createElement(v.a,{weight:"bold"},"Anzahl")}],data:this.props.statusBookings}),r.a.createElement(f.a,{className:"platzhalter"}),r.a.createElement(f.a,{className:"ButtonBox"},r.a.createElement(S.a,{className:"buttonInDash",label:"Buchungen ",onClick:this.callShopManagementViewBookings})))}}]),a}(r.a.Component),Ve=function(e){Object(p.a)(a,e);var t=Object(g.a)(a);function a(e){var n;return Object(h.a)(this,a),(n=t.call(this,e)).state={},n}return Object(d.a)(a,[{key:"render",value:function(){return r.a.createElement(f.a,{name:"statusSales",className:"quickViewOuterBox"},r.a.createElement(v.a,null,"Anzahl und Status der Ticketbuchungen im System:"),r.a.createElement(f.a,{pad:"small"}),r.a.createElement(we.a,{className:"quickViewDatatables",columns:[{property:"status",header:r.a.createElement(v.a,{weight:"bold"},"Status"),primary:!0},{property:"Anzahl",header:r.a.createElement(v.a,{weight:"bold"},"Anzahl")}],data:this.props.statusSales}),r.a.createElement(f.a,{className:"platzhalter"}))}}]),a}(r.a.Component),Ue=function(e){Object(p.a)(a,e);var t=Object(g.a)(a);function a(e){var n;return Object(h.a)(this,a),(n=t.call(this,e)).state={},n.callShopManagementManageSales=n.callShopManagementManageSales.bind(Object(m.a)(n)),n}return Object(d.a)(a,[{key:"callShopManagementManageSales",value:function(){window.location.assign("#/eventmgmt/shop/ManageSalesStatus")}},{key:"render",value:function(){var e;return this.props.salesStatus&&(e=[{Beschreibung:"Ticketverkauf",Status:"Aktiv"}]),this.props.salesStatus||(e=[{Beschreibung:"Ticketverkauf",Status:"Deaktiviert"}]),r.a.createElement(f.a,{name:"boxManageSales",className:"quickViewOuterBox"},r.a.createElement(v.a,null,"Anzeige f\xfcr den Status und das aktivieren"),r.a.createElement(v.a,null,"und deaktivieren des Ticketverkaufs"),r.a.createElement(f.a,{pad:"small"}),r.a.createElement(we.a,{className:"quickViewDatatables",columns:[{property:"Beschreibung",header:r.a.createElement(v.a,{weight:"bold"},"Status"),primary:!0},{property:"Status",header:r.a.createElement(v.a,{weight:"bold"},"Anzahl")}],data:e}),r.a.createElement(f.a,{className:"platzhalter"}),r.a.createElement(f.a,{"Class-Name":"ButtonBox"},r.a.createElement(S.a,{className:"buttonInDash",label:"Status \xe4ndern",onClick:this.callShopManagementManageSales})))}}]),a}(r.a.Component),Le=function(e){Object(p.a)(a,e);var t=Object(g.a)(a);function a(e){var n;return Object(h.a)(this,a),(n=t.call(this,e)).state={},n.callShopManagementCreateOTPS=n.callShopManagementCreateOTPS.bind(Object(m.a)(n)),n}return Object(d.a)(a,[{key:"callShopManagementCreateOTPS",value:function(){window.location.assign("#/eventmgmt/shop/createOTPS")}},{key:"switchInitialList",value:function(){return this.props.initialList?"Eingelesen":this.props.initialList?void 0:"Nicht Eingelesen"}},{key:"render",value:function(){return r.a.createElement(f.a,{name:"CreateOTPS",className:"quickViewOuterBox"},r.a.createElement(v.a,null,"Einlesen einer E-Mail Liste zum Erstellen"),r.a.createElement(v.a,null,"von One Time Passw\xf6rtern:"),r.a.createElement(f.a,{pad:"small"}),r.a.createElement(v.a,null,"Initiale Erstellung durchgef\xfchrt: "),r.a.createElement(v.a,{weight:"bold"},this.switchInitialList()),r.a.createElement(f.a,{className:"platzhalter"}),r.a.createElement(f.a,{"Class-Name":"ButtonBox"},r.a.createElement(S.a,{className:"buttonInDash",label:"Liste einlesen",onClick:this.callShopManagementCreateOTPS})))}}]),a}(r.a.Component),Ke=function(e){Object(p.a)(a,e);var t=Object(g.a)(a);function a(e){var n;return Object(h.a)(this,a),(n=t.call(this,e)).state={},n.callShopManagementCreateOTPS=n.callShopManagementCreateOTPS.bind(Object(m.a)(n)),n}return Object(d.a)(a,[{key:"callShopManagementCreateOTPS",value:function(){window.location.assign("#/eventmgmt/shop/ManageOTPS")}},{key:"render",value:function(){return r.a.createElement(f.a,{name:"CreateOTPS",className:"quickViewOuterBox"},r.a.createElement(v.a,{weight:"bold",size:"large"},"Erstellen neuer One Time Passw\xf6rter"),r.a.createElement(f.a,{pad:"small",align:"center"},r.a.createElement(v.a,null,"Zum Erstellen neuer One Time Passw\xf6rter f\xfcr:"),r.a.createElement(v.a,{weight:"bold"},"- Administratoren"),r.a.createElement(v.a,{weight:"bold"},"- Absolventen")),r.a.createElement(S.a,{className:"buttonInDash",label:"One Time Passwort verwalten",onClick:this.callShopManagementCreateOTPS}))}}]),a}(r.a.Component),Fe=function(e){Object(p.a)(a,e);var t=Object(g.a)(a);function a(e){var n;return Object(h.a)(this,a),(n=t.call(this,e)).state={},n.callShopManagementViewOTPS=n.callShopManagementViewOTPS.bind(Object(m.a)(n)),n}return Object(d.a)(a,[{key:"callShopManagementViewOTPS",value:function(){window.location.assign("#/eventmgmt/shop/ViewOTPs")}},{key:"render",value:function(){return r.a.createElement(f.a,{name:"CreateOTPS",className:"quickViewOuterBox"},r.a.createElement(v.a,{weight:"bold",size:"large"},"Vorhandene One Time Passw\xf6rter"),r.a.createElement(f.a,{pad:"small",align:"center"},r.a.createElement(v.a,null,"Liste mit den existierenden One Time Passw\xf6rtern"),r.a.createElement(v.a,null,"und die M\xf6glichkeit einzelne zu l\xf6schen.")),r.a.createElement(S.a,{className:"buttonInDash",label:"One Time Passwort verwalten",onClick:this.callShopManagementViewOTPS}))}}]),a}(r.a.Component),We=function(e){Object(p.a)(a,e);var t=Object(g.a)(a);function a(e){var n;return Object(h.a)(this,a),(n=t.call(this,e)).state={initializeStep:0,openBookings:0,initialList:!1,salesStatus:!0,bankStatus:!1,payPalStatus:!1,maxPersonenProEvent:0,maxTicketsProEvent:0,maxTicketmenge:[{Tickettype:"Absolvententickets",Anzahl:1},{Tickettype:"Begleitertickets",Anzahl:2}],statusBookings:[{status:"Gebucht",Anzahl:0},{status:"Offen",Anzahl:0},{status:"Storniert",Anzahl:0}],statusSales:[{status:"Verf\xfcgbare Pl\xe4tze",Anzahl:0},{status:"Verkaufte Pl\xe4tze",Anzahl:0},{status:"Stornierte Tickets",Anzahl:0},{status:"Rollstuhlfahrer",Anzahl:0},{status:"Parktickets",Anzahl:0}]},n.changeInitializeStep=n.changeInitializeStep.bind(Object(m.a)(n)),n.getValuesFromConfig=n.getValuesFromConfig.bind(Object(m.a)(n)),n.setConfMaxTicketsFromConf=n.setConfMaxTicketsFromConf.bind(Object(m.a)(n)),n.setMaxTicketMenge=n.setMaxTicketMenge.bind(Object(m.a)(n)),n.getBookings=n.getBookings.bind(Object(m.a)(n)),n.componentDidMount=n.componentDidMount.bind(Object(m.a)(n)),n.setConfSalesStatus=n.setConfSalesStatus.bind(Object(m.a)(n)),n.createOTPwithEmailAndRole=n.createOTPwithEmailAndRole.bind(Object(m.a)(n)),n.setShopConfigInitialList=n.setShopConfigInitialList.bind(Object(m.a)(n)),n.setBankStatus=n.setBankStatus.bind(Object(m.a)(n)),n.setPayPalStatus=n.setPayPalStatus.bind(Object(m.a)(n)),n.setConfBankStatus=n.setConfBankStatus.bind(Object(m.a)(n)),n.setConfPayPalStatus=n.setConfPayPalStatus.bind(Object(m.a)(n)),n.getPayPalStatus=n.getPayPalStatus.bind(Object(m.a)(n)),n.getBankStatus=n.getBankStatus.bind(Object(m.a)(n)),n.getTickets=n.getTickets.bind(Object(m.a)(n)),n.setTickets=n.setTickets.bind(Object(m.a)(n)),n}return Object(d.a)(a,[{key:"changeInitializeStep",value:function(e){this.setState({initializeStep:e})}},{key:"componentDidMount",value:function(){this.getBookings(),this.getTickets(),this.getValuesFromConfig()}},{key:"getBookings",value:function(){var e=Object(u.a)(l.a.mark((function e(){var t,a,n,r,i,s,c;return l.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,fetch(T.a.BACKEND_BASE_URI+"/api/v2/bookings/",{method:"GET",mode:"cors",cache:"no-cache",headers:{"Content-Type":"application/json",Authorization:"Bearer "+this.context.token}}).catch(console.log);case 2:if((t=e.sent).ok){e.next=18;break}e.t0=t.status,e.next=500===e.t0?7:501===e.t0?9:11;break;case 7:return alert("Die Anmeldung ist aufgrund eines Server-Fehlers fehlgeschlagen. Bitte versuchen Sie es sp\xe4ter erneut."),e.abrupt("break",15);case 9:return alert("Der Server kann die gew\xfcnschte Anfrage nicht ausf\xfchren."),e.abrupt("break",15);case 11:return e.next=13,t.json().catch(console.log);case 13:a=e.sent,alert(a.message);case 15:return e.abrupt("return");case 18:return e.next=20,t.json().catch(console.log);case 20:if(n=e.sent){for(r=0,i=0,s=0,c=0;c<n.length;c++)null!==n[c].paidAt&&!1===n[c].canceled&&(r+=1),null===n[c].paidAt&&!1===n[c].canceled&&(i+=1),!0===n[c].canceled&&(s+=1);this.setBookings(r,i,s)}case 22:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"getTickets",value:function(){var e=Object(u.a)(l.a.mark((function e(){var t,a,n,r,i,s,c,o;return l.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,fetch(T.a.BACKEND_BASE_URI+"/api/v2/ticketsBooked",{method:"GET",mode:"cors",cache:"no-cache",headers:{"Content-Type":"application/json",Authorization:"Bearer "+this.context.token}}).catch(console.log);case 2:if(t=e.sent){e.next=6;break}return console.log("Keine Antwort beim Abruf der Tickets erhalten"),e.abrupt("return");case 6:if(t.ok){e.next=9;break}return console.log("Fehler beim Abruf der Tickets: "+t.message),e.abrupt("return");case 9:if(!t.ok){e.next=14;break}return e.next=12,t.json().catch(console.log);case 12:if((a=e.sent)&&(n=this.state.maxTicketsProEvent,r=0,i=0,s=0,c=0,n)){for(o=0;o<a.length;o++)a[o].createdAt&&!0!==a[o].canceled&&2!==a[o].ticketType&&(r+=1),a[o].createdAt&&!0===a[o].canceled&&(i+=1),!0===a[o].isWheelchairUser&&(s+=1),a[o].createdAt&&!0!==a[o].canceled&&2===a[o].ticketType&&(c+=1);n-=r,this.setTickets(n,r,i,s,c)}case 14:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"getValuesFromConfig",value:function(){var e=Object(u.a)(l.a.mark((function e(){var t,a,n;return l.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,fetch(T.a.BACKEND_BASE_URI+"/api/v2/shopConfig",{method:"GET",mode:"cors",cache:"no-cache",headers:{"Content-Type":"application/json",Authorization:"Bearer "+this.context.token}}).catch(console.log);case 2:if(t=e.sent){e.next=6;break}return console.log("Keine Antwort beim Abruf der Konfiguration erhalten!"),e.abrupt("return");case 6:if(t.ok){e.next=9;break}return console.log("Fehler beim Abrufen der Konfiguration: "+t.message),e.abrupt("return");case 9:if(!t.ok){e.next=21;break}return e.next=12,t.json().catch(console.log);case 12:if(a=e.sent){e.next=18;break}return console.log("Keine Daten beim Abruf der Konfiugration erhalten!"),e.abrupt("return");case 18:n=[{Tickettype:"Absolvententickets",Anzahl:a.max_TicketType_0_pro_Absolvent},{Tickettype:"Begleitertickets",Anzahl:a.max_TicketType_1_pro_Absolvent}],this.setState({salesStatus:a.salesStatus,maxPersonenProEvent:a.max_Person_pro_Event,maxTicketsProEvent:a.max_Tickets_pro_Event,initialList:a.initialeOPTListe,maxTicketmenge:n}),console.log("Die Konfiguration wurde erfolgreich eingelesen!");case 21:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"setConfMaxTicketsFromConf",value:function(){var e=Object(u.a)(l.a.mark((function e(t,a){var n;return l.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,fetch(T.a.BACKEND_BASE_URI+"/api/v2/shopConfig",{method:"PUT",mode:"cors",cache:"no-cache",headers:{"Content-Type":"application/json",Authorization:"Bearer "+this.context.token},body:JSON.stringify({max_TicketType_0_pro_Absolvent:t,max_TicketType_1_pro_Absolvent:a})}).catch(console.log);case 2:if(n=e.sent){e.next=6;break}return console.log("Keine Antwort beim Setzen der maximalen Ticketanzahl vom Backend-Server erhalten!"),e.abrupt("return");case 6:if(n.ok){e.next=9;break}return console.log("Fehler beim Setzten der Werte f\xfcr die maximale Ticketanzahl: "+n.message),e.abrupt("return");case 9:n.ok&&this.setMaxTicketMenge(t,a);case 10:case"end":return e.stop()}}),e,this)})));return function(t,a){return e.apply(this,arguments)}}()},{key:"setMaxTicketMenge",value:function(e,t){var a=[{Tickettype:"Absolvententickets",Anzahl:e},{Tickettype:"Begleitertickets",Anzahl:t}];this.setState({maxTicketmenge:a})}},{key:"setBookings",value:function(e,t,a){var n=[{status:"Gebucht",Anzahl:e},{status:"Offen",Anzahl:t},{status:"Storniert",Anzahl:a}];this.setState({statusBookings:n})}},{key:"setTickets",value:function(e,t,a,n,r){var i=[{status:"Verf\xfcgbare Pl\xe4tze",Anzahl:e},{status:"Verkaufte Pl\xe4tze",Anzahl:t},{status:"Stornierte Tickets",Anzahl:a},{status:"Rollstuhlfahrer",Anzahl:n},{status:"Parktickets",Anzahl:r}];this.setState({statusSales:i})}},{key:"setConfSalesStatus",value:function(){var e=Object(u.a)(l.a.mark((function e(t){var a;return l.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,fetch(T.a.BACKEND_BASE_URI+"/api/v2/shopConfig",{method:"PUT",mode:"cors",cache:"no-cache",headers:{"Content-Type":"application/json",Authorization:"Bearer "+this.context.token},body:JSON.stringify({salesStatus:t})}).catch(console.log);case 2:if(a=e.sent){e.next=6;break}return console.log("Keine Antwort beim Setzen des Verkaufsstatus vom Backend-Server erhalten!"),e.abrupt("return");case 6:if(a.ok){e.next=9;break}return console.log("Fehler beim Setzten des Wertes f\xfcr den Verkaufsstatus: "+a.message),e.abrupt("return");case 9:a.ok&&(this.setSalesStatus(t),t&&console.log("Der Verkauf wurde aktiviert!"),t||console.log("Der Verkauf wurde deaktiviert!"));case 10:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"setSalesStatus",value:function(e){this.setState({salesStatus:e})}},{key:"createOTPwithEmailAndRole",value:function(){var e=Object(u.a)(l.a.mark((function e(t,a){var n;return l.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,fetch(T.a.BACKEND_BASE_URI+"/api/v2/oneTimePasses",{method:"POST",mode:"cors",cache:"no-cache",headers:{"Content-Type":"application/json",Authorization:"Bearer "+this.context.token},body:JSON.stringify({email:t,targetRole:a})}).catch(console.log);case 2:if(n=e.sent){e.next=6;break}return console.log("Keine Antwort vom Backend bei der Erstellung des One Time Passworts f\xfcr die E-Mail:"+t),e.abrupt("return");case 6:if(n.ok){e.next=9;break}return console.log("Fehler bei der Erstellung eines One Time Passwortes: "+n.message),e.abrupt("return");case 9:if(!n.ok){e.next=12;break}return console.log("One Time Passwort f\xfcr die E-Mail: "+t+" und der Rolle: "+a+" erstellt!"),e.abrupt("return",1);case 12:case"end":return e.stop()}}),e,this)})));return function(t,a){return e.apply(this,arguments)}}()},{key:"setShopConfigInitialList",value:function(){var e=Object(u.a)(l.a.mark((function e(t){var a;return l.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,fetch(T.a.BACKEND_BASE_URI+"/api/v2/shopConfig",{method:"PUT",mode:"cors",cache:"no-cache",headers:{"Content-Type":"application/json",Authorization:"Bearer "+this.context.token},body:JSON.stringify({initialeOPTListe:t})}).catch(console.log);case 2:if(a=e.sent){e.next=6;break}return console.log("Keine Antwort beim Setzen des Wertes f\xfcr die intiale OTP-Liste!"),e.abrupt("return");case 6:a.ok||console.log("Fehler beim Setzten des Wertes f\xfcr die intiale OTP-Liste: "+a.message),a.ok&&(t&&console.log("Intiale OTP-Liste wurde eingelesen"),this.setState({initialList:!0}));case 8:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"setConfBankStatus",value:function(){var e=Object(u.a)(l.a.mark((function e(t){var a,n,r;return l.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,fetch(T.a.BACKEND_BASE_URI+"/api/v2/paymentOptions",{method:"GET",mode:"cors",cache:"no-cache",headers:{"Content-Type":"application/json",Authorization:"Bearer "+this.context.token}}).catch(console.log);case 2:if(a=e.sent){e.next=6;break}return console.log("Keine Antwort beim Abrufen der Bankverbindung vom Backend-Server erhalten!"),e.abrupt("return");case 6:if(a.ok){e.next=9;break}return console.log("Fehler beim Abrufen der Bankverbindung vom Backendserver: "+a.message),e.abrupt("return");case 9:if(!a.ok){e.next=24;break}return e.next=12,a.json();case 12:return(n=e.sent).Bank.Aktiviert=t,e.next=16,fetch(T.a.BACKEND_BASE_URI+"/api/v2/paymentOptions",{method:"PUT",mode:"cors",cache:"no-cache",headers:{"Content-Type":"application/json",Authorization:"Bearer "+this.context.token},body:JSON.stringify({Bank:{Empf\u00e4nger:n.Bank.Empf\u00e4nger,Name_der_Bank:n.Bank.Name_der_Bank,IBAN:n.Bank.IBAN,BIC:n.Bank.BIC,Verwendungszweck:n.Bank.Verwendungszweck,Aktiviert:n.Bank.Aktiviert}})}).catch(console.log);case 16:if(r=e.sent){e.next=20;break}return console.log("Keine Antwort beim Schreiben der Bankverbindung auf den Backend-Server!"),e.abrupt("return");case 20:if(r.ok){e.next=23;break}return console.log("Fehler beim Schreiben der Bankverbindung auf den Backend-Server: "+r.message),e.abrupt("return");case 23:r.ok&&(this.setBankStatus(t),t&&console.log("Die Bankverbindung wurde aktiviert!"),t||console.log("Die Bankverbindung wurde deaktiviert!"));case 24:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"setConfPayPalStatus",value:function(){var e=Object(u.a)(l.a.mark((function e(t){var a,n,r;return l.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,fetch(T.a.BACKEND_BASE_URI+"/api/v2/paymentOptions",{method:"GET",mode:"cors",cache:"no-cache",headers:{"Content-Type":"application/json",Authorization:"Bearer "+this.context.token}}).catch(console.log);case 2:if(a=e.sent){e.next=6;break}return console.log("Keine Antwort beim Abrufen der PayPal-Verbindung vom Backend-Server erhalten!"),e.abrupt("return");case 6:if(a.ok){e.next=9;break}return console.log("Fehler beim Abrufen der PayPal-Verbindung vom Backendserver: "+a.message),e.abrupt("return");case 9:return e.next=11,a.json();case 11:return(n=e.sent).PayPal.Aktiviert=t,e.next=15,fetch(T.a.BACKEND_BASE_URI+"/api/v2/paymentOptions",{method:"PUT",mode:"cors",cache:"no-cache",headers:{"Content-Type":"application/json",Authorization:"Bearer "+this.context.token},body:JSON.stringify({PayPal:{PayPal_Link:n.PayPal.PayPal_Link,PayPal_Mail:n.PayPal.PayPal_Mail,PayPal_Verwendung:n.PayPal.PayPal_Verwendung,Aktiviert:n.PayPal.Aktiviert}})}).catch(console.log);case 15:if(r=e.sent){e.next=19;break}return console.log("Keine Antwort beim Schreiben der PayPal-Verbindung auf den Backend-Server!"),e.abrupt("return");case 19:if(r.ok){e.next=22;break}return console.log("Fehler beim Schreiben der PayPal-Verbindung auf den Backend-Server: "+r.message),e.abrupt("return");case 22:r.ok&&(this.setPayPalStatus(t),t&&console.log("Die PayPal-Verbindung wurde aktiviert!"),t||console.log("Die PayPal-Verbindung wurde deaktiviert!"));case 23:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"setBankStatus",value:function(e){this.setState({bankStatus:e})}},{key:"setPayPalStatus",value:function(e){this.setState({payPalStatus:e})}},{key:"getBankStatus",value:function(){var e=Object(u.a)(l.a.mark((function e(){var t,a;return l.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,fetch(T.a.BACKEND_BASE_URI+"/api/v2/paymentOptions",{method:"GET",mode:"cors",cache:"no-cache",headers:{"Content-Type":"application/json",Authorization:"Bearer "+this.context.token}}).catch(console.log);case 2:if(t=e.sent){e.next=6;break}return console.log("Keine Antwort beim Abrufen der Bankverbindung vom Backend-Server erhalten!"),e.abrupt("return");case 6:if(t.ok){e.next=9;break}return console.log("Fehler beim Abrufen der Bankverbindung vom Backendserver: "+t.message),e.abrupt("return");case 9:if(!t.ok){e.next=15;break}return e.next=12,t.json();case 12:a=e.sent,this.setState({bankStatus:a.Bank.Aktiviert}),console.log("Der aktuelle Status der Bankverbindung ist: "+this.state.bankStatus);case 15:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"getPayPalStatus",value:function(){var e=Object(u.a)(l.a.mark((function e(){var t,a;return l.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,fetch(T.a.BACKEND_BASE_URI+"/api/v2/paymentOptions",{method:"GET",mode:"cors",cache:"no-cache",headers:{"Content-Type":"application/json",Authorization:"Bearer "+this.context.token}}).catch(console.log);case 2:if(t=e.sent){e.next=6;break}return console.log("Keine Antwort beim Abrufen der PayPal-Verbindung vom Backend-Server erhalten!"),e.abrupt("return");case 6:if(t.ok){e.next=9;break}return console.log("Fehler beim Abrufen der PayPal-Verbindung vom Backendserver: "+t.message),e.abrupt("return");case 9:if(!t.ok){e.next=15;break}return e.next=12,t.json();case 12:a=e.sent,this.setState({payPalStatus:a.PayPal.Aktiviert}),console.log("Der aktuelle Status der PayPal-Verbindung ist: "+this.state.payPalStatus);case 15:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"render",value:function(){return r.a.createElement(H.c,null,r.a.createElement(H.a,{path:"/eventmgmt/shop/ConfMaxTickets"},r.a.createElement(Oe,{setConfMaxTicketsFromConf:this.setConfMaxTicketsFromConf})),r.a.createElement(H.a,{path:"/eventmgmt/shop/ViewBookings"},r.a.createElement(xe,null)),r.a.createElement(H.a,{path:"/eventmgmt/shop/paymentOptions"},r.a.createElement(ze,{bankStatus:this.state.bankStatus,setConfBankStatus:this.setConfBankStatus,payPalStatus:this.state.payPalStatus,setConfPayPalStatus:this.setConfPayPalStatus})),r.a.createElement(H.a,{path:"/eventmgmt/shop/ManageSalesStatus"},r.a.createElement(Ae,{salesStatus:this.state.salesStatus,setConfSalesStatus:this.setConfSalesStatus})),r.a.createElement(H.a,{path:"/eventmgmt/shop/createOTPs"},r.a.createElement(je,{createOTPwithEmailAndRole:this.createOTPwithEmailAndRole,setShopConfigInitialList:this.setShopConfigInitialList})),r.a.createElement(H.a,{path:"/eventmgmt/shop/ManageOTPs"},r.a.createElement(Me,{createOTPwithEmailAndRole:this.createOTPwithEmailAndRole})),r.a.createElement(H.a,{path:"/eventmgmt/shop/ViewOTPs"},r.a.createElement(Re,null)),r.a.createElement(H.a,{path:"/eventmgmt/shop"},r.a.createElement(f.a,null,r.a.createElement(f.a,null,r.a.createElement(v.a,{size:"xxlarge",weight:"bold",alignSelf:"center"},"Willkommen in der Shop-Verwaltung"),r.a.createElement(f.a,{pad:"medium"})),r.a.createElement(f.a,{direction:"row",wrap:!0,justify:"center"},r.a.createElement(f.a,{ClassName:"twoGroupedBoards",direction:"row",wrap:!0,justify:"center"},r.a.createElement(_e,{maxTicketmenge:this.state.maxTicketmenge}),r.a.createElement(He,{bankStatus:this.state.bankStatus,getBankStatus:this.getBankStatus,payPalStatus:this.state.payPalStatus,getPayPalStatus:this.getPayPalStatus})),r.a.createElement(f.a,{ClassName:"twoGroupedBoards",direction:"row",wrap:!0,justify:"center"},r.a.createElement(Ie,{statusBookings:this.state.statusBookings}),r.a.createElement(Ve,{statusSales:this.state.statusSales})),r.a.createElement(f.a,{ClassName:"twoGroupedBoards",direction:"row",wrap:!0,justify:"center"},r.a.createElement(Ue,{salesStatus:this.state.salesStatus,setSalesStatus:this.setSalesStatus}),r.a.createElement(Le,{initialList:this.state.initialList})),r.a.createElement(f.a,{ClassName:"twoGroupedBoards",direction:"row",wrap:!0,justify:"center"},r.a.createElement(Ke,null),r.a.createElement(Fe,null))))))}}]),a}(r.a.Component);We.contextType=k;var Ge=We,qe=function(e){Object(p.a)(a,e);var t=Object(g.a)(a);function a(e){var n;return Object(h.a)(this,a),(n=t.call(this,e)).rTRHandler=n.rTRHandler.bind(Object(m.a)(n)),n.localTicketMirror=new be,n.state={RTRList:[]},n}return Object(d.a)(a,[{key:"componentDidMount",value:function(){this.context.requireLogin(1)}},{key:"componentDidUpdate",value:function(){this.context.requireLogin(1)}},{key:"rTRHandler",value:function(e){var t=this,a=this.state.RTRList;a.push(e),this.setState({RTRList:a}),e.onConnectionChanged=function(a){switch(a){case"connected":case"disconnected":break;case"failed":t.removeRTR(e)}t.forceUpdate()},e.onGetTicket=function(e,a){t.localTicketMirror.getTicket(e).then((function(e){a(e)})).catch((function(e){a(null,e)}))},e.onObliterateTicket=function(e,a,n){t.localTicketMirror.obliterateTicket(e,a).then((function(e){n(e)})).catch((function(e){n(null,e)}))}}},{key:"removeRTR",value:function(e){console.debug("Attempting to remove closed remote ticket reader");var t=this.state.RTRList,a=t.indexOf(e);t.splice(a,1),this.setState({RTRList:t})}},{key:"render",value:function(){return r.a.createElement(f.a,{className:"EventManagement"},r.a.createElement(b.a,{background:"brand",justify:"between",pad:"10px"},r.a.createElement(c.b,{to:"/eventmgmt"},"Home"),r.a.createElement(_.a,{label:"Account",items:[{label:"Logout",onClick:this.context.logout}]})),r.a.createElement(f.a,{className:"left-right-grid",direction:"row",justify:"start",wrap:!0},r.a.createElement(f.a,{className:"sidebar"},r.a.createElement("ul",null,r.a.createElement("li",null,r.a.createElement(c.b,{to:"/eventmgmt/rtrm"},"Manage Remote Ticket Readers")),r.a.createElement("li",null,r.a.createElement(c.b,{to:"/eventmgmt/entrancedb"},"Entrance Dashboard")),r.a.createElement("li",null,r.a.createElement(c.b,{to:"/eventmgmt/shop"},"Shop Management")))),r.a.createElement(f.a,{className:"main-content",pad:"medium"},r.a.createElement(H.c,null,r.a.createElement(H.a,{path:"/eventmgmt/rtrm"},r.a.createElement(ye,{RTRList:this.state.RTRList,onRTR:this.rTRHandler})),r.a.createElement(H.a,{path:"/eventmgmt/entrancedb"},r.a.createElement(Ee,{localTicketMirror:this.localTicketMirror,onRemoveRTR:function(){}})),r.a.createElement(H.a,{path:"/eventmgmt/shop"},r.a.createElement(Ge,null))))))}}]),a}(r.a.Component);qe.contextType=k;var Je=qe,Ze=a(545),Qe=a(540),Xe=function(e){Object(p.a)(a,e);var t=Object(g.a)(a);function a(e){var n;return Object(h.a)(this,a),(n=t.call(this,e)).state={userContext:null,setupMode:!1},n.logout=n.logout.bind(Object(m.a)(n)),n.initUserContext=n.initUserContext.bind(Object(m.a)(n)),n.setUserContext=n.setUserContext.bind(Object(m.a)(n)),n.checkUserContext=n.checkUserContext.bind(Object(m.a)(n)),n.redirectUserToHome=n.redirectUserToHome.bind(Object(m.a)(n)),n}return Object(d.a)(a,[{key:"componentDidMount",value:function(){var e=this;"#/"!==window.location.hash&&"#"!==window.location.hash&&""!==window.location.hash||window.location.assign("#/login/"),this.detectSystemState(),window.setInterval((function(){e.detectSystemState(),e.detectAuthState(e.state.userContext)}),6e4),this.initUserContext()}},{key:"detectSystemState",value:function(){var e=Object(u.a)(l.a.mark((function e(){return l.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,fetch(T.a.BACKEND_BASE_URI,{method:"GET",mode:"cors",cache:"no-cache"});case 3:200===e.sent.status?this.setState({setupMode:!1}):this.setState({setupMode:!0}),e.next=10;break;case 7:e.prev=7,e.t0=e.catch(0),console.log(e.t0);case 10:case"end":return e.stop()}}),e,this,[[0,7]])})));return function(){return e.apply(this,arguments)}}()},{key:"detectAuthState",value:function(){var e=Object(u.a)(l.a.mark((function e(t){return l.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,fetch(T.a.BACKEND_BASE_URI+"/api/v2/users/"+t.user.id,{method:"GET",mode:"cors",cache:"no-cache",headers:{Authorization:"Bearer "+t.token}});case 3:401===e.sent.status&&(this.clearUserContext(),this.setState({userContext:null})),e.next=10;break;case 7:e.prev=7,e.t0=e.catch(0),console.log(e.t0);case 10:case"end":return e.stop()}}),e,this,[[0,7]])})));return function(t){return e.apply(this,arguments)}}()},{key:"initUserContext",value:function(){var e=JSON.parse(localStorage.getItem("userContext"));this.setState({userContext:e}),this.detectAuthState(e)}},{key:"setUserContext",value:function(e){localStorage.setItem("userContext",JSON.stringify(e)),this.setState({userContext:e})}},{key:"clearUserContext",value:function(){localStorage.clear(),this.setState({userContext:null})}},{key:"logout",value:function(){this.state.userContext&&0===this.state.userContext.user.role&&(window.confirm("Sollen auch eventuell lokal gespeicherten Daten f\xfcr den Einlass unwiederruflich gel\xf6scht werden?","Nein")&&window.indexedDB.deleteDatabase(T.a.IDB_NAME));this.clearUserContext(),window.location.assign("#/login")}},{key:"checkUserContext",value:function(e){(!this.state.userContext||this.state.userContext.user.role>e)&&window.location.assign("#/login/")}},{key:"redirectUserToHome",value:function(){this.state.userContext&&0===this.state.userContext.user.role?window.location.assign("#/eventmgmt/"):this.state.userContext&&1===this.state.userContext.user.role&&window.location.assign("#/guest/")}},{key:"render",value:function(){return r.a.createElement(k.Provider,{value:Object.assign(this.state.userContext?this.state.userContext:{},{logout:this.logout,setUserContext:this.setUserContext,requireLogin:this.checkUserContext,redirectUserToHome:this.redirectUserToHome})},r.a.createElement(Ze.a,{theme:Qe.a},!this.state.setupMode&&r.a.createElement(f.a,null,r.a.createElement(H.c,null,r.a.createElement(H.a,{path:"/guest"},r.a.createElement(ne,{eigenschaft1:"test"})),r.a.createElement(H.a,{path:"/entrance"},r.a.createElement(de,null)),r.a.createElement(H.a,{path:"/eventmgmt"},r.a.createElement(Je,null)),r.a.createElement(H.a,{path:"/login"},r.a.createElement(C,null)),r.a.createElement(H.a,{path:"/"},r.a.createElement("ul",null,r.a.createElement("li",null,r.a.createElement(c.b,{to:"/guest"},"Ticketshop")),r.a.createElement("li",null,r.a.createElement(c.b,{to:"/entrance"},"Ticket-Reader")),r.a.createElement("li",null,r.a.createElement(c.b,{to:"/eventmgmt"},"Event-Management")),r.a.createElement("li",null,r.a.createElement(c.b,{to:"/login"},"Anmelden")))))),this.state.setupMode&&r.a.createElement(f.a,null,r.a.createElement(H.c,null,r.a.createElement(H.a,{path:"/setup"},r.a.createElement(R,null)),r.a.createElement(H.a,{path:"/"},r.a.createElement(f.a,{pad:"medium",alignContent:"center",direction:"column",align:"center"},r.a.createElement(E.a,null,"Wartungsarbeiten"),r.a.createElement("p",null,"Sehr geehrte Besucher*innen,",r.a.createElement("br",null),"das Bachelorsnight Ticketsystem befindet sich derzeit im Wartungsmodus.",r.a.createElement("br",null),"Bitte versuchen Sie es sp\xe4ter erneut.")))))))}}]),a}(r.a.Component),Ye=Boolean("localhost"===window.location.hostname||"[::1]"===window.location.hostname||window.location.hostname.match(/^127(?:\.(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)){3}$/));function $e(e,t){navigator.serviceWorker.register(e).then((function(e){e.onupdatefound=function(){var a=e.installing;null!=a&&(a.onstatechange=function(){"installed"===a.state&&(navigator.serviceWorker.controller?(console.log("New content is available and will be used when all tabs for this page are closed. See https://bit.ly/CRA-PWA."),t&&t.onUpdate&&t.onUpdate(e)):(console.log("Content is cached for offline use."),t&&t.onSuccess&&t.onSuccess(e)))})}})).catch((function(e){console.error("Error during service worker registration:",e)}))}s.a.render(r.a.createElement(c.a,null,r.a.createElement(Xe,null)),document.getElementById("root")),function(e){if("serviceWorker"in navigator){if(new URL("/bnt-frontend",window.location.href).origin!==window.location.origin)return;window.addEventListener("load",(function(){var t="".concat("/bnt-frontend","/service-worker.js");Ye?(!function(e,t){fetch(e,{headers:{"Service-Worker":"script"}}).then((function(a){var n=a.headers.get("content-type");404===a.status||null!=n&&-1===n.indexOf("javascript")?navigator.serviceWorker.ready.then((function(e){e.unregister().then((function(){window.location.reload()}))})):$e(e,t)})).catch((function(){console.log("No internet connection found. App is running in offline mode.")}))}(t,e),navigator.serviceWorker.ready.then((function(){console.log("This web app is being served cache-first by a service worker. To learn more, visit https://bit.ly/CRA-PWA")}))):$e(t,e)}))}}()},58:function(e,t,a){}},[[256,1,2]]]);
//# sourceMappingURL=main.cc7e0c30.chunk.js.map