(this["webpackJsonpexample-client"]=this["webpackJsonpexample-client"]||[]).push([[0],{298:function(e,t,n){},333:function(e,t,n){e.exports=n(643)},338:function(e,t,n){},340:function(e,t,n){},350:function(e,t){},375:function(e,t){},377:function(e,t){},418:function(e,t){},420:function(e,t){},449:function(e,t){},557:function(e,t){},609:function(e,t,n){},634:function(e,t,n){},643:function(e,t,n){"use strict";n.r(t);var a=n(0),r=n.n(a),c=n(79),i=n.n(c),s=n(33),l=(n(338),n(5)),o=n.n(l),u=n(16),d=n(13),h=n(14),m=n(10),b=n(17),f=n(21),p=(n(340),n(175)),k=n(655),v=n(664),g=n(80),E=n(661),w=n(662),T=n(663),y=n(160),C=n.n(y),O=n(161),S=n.n(O),x=function(e){Object(b.a)(n,e);var t=Object(f.a)(n);function n(e){var a;return Object(d.a)(this,n),(a=t.call(this,e)).state={},a.sign=a.sign.bind(Object(m.a)(a)),a.connectWallet=a.connectWallet.bind(Object(m.a)(a)),a}return Object(h.a)(n,[{key:"componentDidMount",value:function(){this.init()}},{key:"displayError",value:function(){alert("Ups, das hat nicht geklappt")}},{key:"init",value:function(){this.setState({walletAvailable:!!window.ethereum}),window.ethereum||(this.walletLink=new S.a({appName:"DHBW Bachelors Night Ticketing 2020",appLogoUrl:"https://einfachtierisch.de/media/cache/article_teaser/cms/2015/09/Katze-lacht-in-die-Kamera-shutterstock-Foonia-76562038.jpg?595617",darkMode:!1}),window.ethereum=this.walletLink.makeWeb3Provider("https://mainnet.infura.io/v3/efaece4f5f4443979063839c124c8171",1)),this.setState({connected:!!window.ethereum.selectedAddress}),this.web3=new C.a(window.ethereum)}},{key:"connectWallet",value:function(){var e=Object(u.a)(o.a.mark((function e(){var t;return o.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,window.ethereum.enable().catch(this.displayError);case 2:if(t=e.sent){e.next=5;break}return e.abrupt("return");case 5:console.log("User's address is ".concat(t[0])),this.web3.eth.defaultAccount=t[0],this.setState({connected:!0});case 8:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"sign",value:function(){var e=Object(u.a)(o.a.mark((function e(t){var n,a,r,c,i=this;return o.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(window.ethereum){e.next=2;break}return e.abrupt("return",this.displayError());case 2:if(window.ethereum.selectedAddress){e.next=4;break}return e.abrupt("return",this.displayError());case 4:n=window.ethereum.selectedAddress,a=t,r=this.web3.utils.stringToHex(a),c=[r,n],"personal_sign",this.web3.currentProvider.send({method:"personal_sign",params:c,from:n},(function(e,t){if(e)return console.error(e);if(t.error)return console.error(t.error);console.log(t);var a=i.web3.eth.accounts.recover(r,t.result);a.toLowerCase()===n.toLowerCase()?alert("Successfully ecRecovered signer as "+n):alert("Failed to verify signer when comparing "+a+" to "+n)}));case 10:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"linkToDownloadMetaMask",value:function(){window.open("https://wallet.coinbase.com/","_blank")}},{key:"render",value:function(){var e=this;return r.a.createElement(p.a,{className:"WalletSetup",direction:"column",gap:"medium",pad:"medium"},r.a.createElement("h1",null,"Wallet Setup"),r.a.createElement(E.a,null,"Um Tickets zu erwerben ben\xf6tigen Sie ein sogenanntes Wallet. Dieses ist vergleichbar mit Ihrer Geldb\xf6rse zu der nur Sie Zugriff haben."),!this.state.walletAvailable&&!this.state.connected&&r.a.createElement(p.a,{gap:"medium"},r.a.createElement(E.a,null,"F\xfcr unser Ticket-System muss dieses Wallet Ethereum-f\xe4hig sein. Wir empfehlen Ihnen daher das Coinbase Wallet. Bitte installieren Sie sich das Coinbase Wallet \xfcber die offizielle Website. Kommen Sie nach Abschluss der Einrichtung wieder auf diese Seite zur\xfcck."),r.a.createElement(w.a,{label:"Coinbase f\xfcr's Smartphone installieren",onClick:this.linkToDownloadMetaMask})),!this.state.connected&&r.a.createElement(p.a,{gap:"medium"},r.a.createElement(E.a,null,"Als N\xe4chstes ben\xf6tigt unsere Plattform die Adresse Ihres Wallets. Bitte best\xe4tigen Sie daher die Verbindung mit Ihrem Wallet \xfcber folgende Schaltfl\xe4che. Sie geben dadurch ",r.a.createElement("b",null,"nicht")," Ihre Kontrolle \xfcber das Wallet ab!"),r.a.createElement(w.a,{label:"Mit dem Wallet verbinden",onClick:this.connectWallet})),r.a.createElement(E.a,null,"Hier folgt eine DEMO!!!"),r.a.createElement(T.a,{placeholder:"Nachricht zum signieren",value:this.state.signMessage,onChange:function(t){e.setState({signMessage:t.target.value})}}),r.a.createElement(w.a,{label:"Sign and Verify Message",onClick:function(){e.sign(e.state.signMessage)}}))}}]),n}(r.a.Component),j=(n(609),function(e){Object(b.a)(n,e);var t=Object(f.a)(n);function n(e){var a;return Object(d.a)(this,n),(a=t.call(this,e)).state={},a}return Object(h.a)(n,[{key:"render",value:function(){return r.a.createElement(p.a,{className:"UserMainMenu",direction:"column",gap:"medium",pad:"medium"},r.a.createElement(s.b,{className:"MenuLink",to:"/guest/tickets"},"Tickets Anzeigen"),r.a.createElement(s.b,{className:"MenuLink",to:"/guest/ticketbestellen"},"Tickets Bestellen"),r.a.createElement(s.b,{className:"MenuLink",to:"/guest/bestellungsuebersicht"},"Bestellungen Anzeigen"),r.a.createElement(s.b,{className:"MenuLink",to:"/guest/setup"},"Setup"))}}]),n}(r.a.Component)),R=(n(298),n(112)),D=n.n(R);function A(e){var t=Object(g.f)().identifier,n=e.tickets.find((function(e){return e.identifier===t}));return r.a.createElement(p.a,{className:"SingleTicket"},n.forename,n.surname,n.ticketType)}function H(e){return r.a.createElement(p.a,{className:"TicketListItem",direction:"row",gap:"small",pad:"small"},r.a.createElement(E.a,{className:"Name"},e.ticket.forename," ",e.ticket.surname),r.a.createElement(E.a,{className:"Type"},e.ticket.ticketType),r.a.createElement(w.a,{label:"Anzeigen",onClick:function(){window.location.assign("#/guest/tickets/"+e.ticket.identifier)}}))}var N=function(e){Object(b.a)(n,e);var t=Object(f.a)(n);function n(e){var a;return Object(d.a)(this,n),(a=t.call(this,e)).state={tickets:[],loading:!1},a}return Object(h.a)(n,[{key:"componentDidMount",value:function(){this.fetchTickets()}},{key:"fetchTickets",value:function(){var e=Object(u.a)(o.a.mark((function e(){var t,n;return o.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return this.setState({loading:!0}),"0x3Da85f73bC1B1662FE247391dEcD2a52f139fd13",e.next=4,fetch("http://localhost:3000/api/v1/users/0x3Da85f73bC1B1662FE247391dEcD2a52f139fd13/tickets",{mode:"cors",cache:"no-cache",headers:{"Content-Type":"application/json",Authorization:"Bearer 43059960ead1db519cbbed4aa934462808262fa6204daefabcab4b0b38b667d61828556556e4b9e80b6a91e9990fc8704bbf399cdafd41b06ddc0c31a500accb94b96fa096bf8789c7c582f9e5df0ead8f23ef77a9b045ccbb78a60cd2401592e79b8c396cd4520297cfb0603011a7f373f9dbbc6a37527bd160b5e754850cbf8779a4c5049e816a9b9bee268e110baf53e901e80aa8df89d6a07b92cf33b581294bedc1b8da2c9a583845b13766f4c89abc9ac3466b69748a1ba0bf6a80a8c2b6aa6ec084c88c2cc4d212470089dbb9e4bce056c90e8a0ebaa5b9e563c80d20ac173b791769eac9d29c509810086f1700c7cec0071a03bb7aed67fec7215979"}}).catch(console.log);case 4:if(t=e.sent){e.next=7;break}return e.abrupt("return");case 7:return e.next=9,t.json().catch(console.log);case 9:if(n=e.sent){e.next=12;break}return e.abrupt("return");case 12:n.forEach((function(e){switch(e.ticketType){case"0":e.ticketType="Absolvent";break;case"1":e.ticketType="Begleitperson";break;case"2":e.ticketType="Parkticket"}})),this.setState({tickets:n,loading:!1});case 14:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"generateQRCodes",value:function(){var e=this,t=[];this.state.tickets.forEach((function(n,a,r){var c=n.identifier;D.a.toDataURL(c).then((function(c){n.qrcode=c,t.push(n),a===r.length-1&&e.setState({tickets:t})})).catch(console.log)}))}},{key:"render",value:function(){var e=this.state.tickets.map((function(e){return r.a.createElement(H,{key:e.identifier,ticket:e})}));return r.a.createElement(p.a,{className:"TicketOverview",direction:"column",gap:"medium",pad:"medium"},r.a.createElement(g.c,null,r.a.createElement(g.a,{path:"/guest/tickets/:identifier"},r.a.createElement(s.b,{to:"/guest/tickets/"},"Alle Tickets anzeigen"),r.a.createElement(A,{tickets:this.state.tickets})),r.a.createElement(g.a,{path:"/guest/tickets/"},r.a.createElement(p.a,null,r.a.createElement(p.a,null,r.a.createElement("h1",{className:"NumberOfTickets"},this.state.tickets.length)),r.a.createElement(p.a,{className:"TicketList"},this.state.loading&&r.a.createElement("p",{className:"loader"}),e)))))}}]),n}(r.a.Component),B=function(e){Object(b.a)(n,e);var t=Object(f.a)(n);function n(e){var a;return Object(d.a)(this,n),(a=t.call(this,e)).connectWallet=a.connectWallet.bind(Object(m.a)(a)),a.createCoinbaseWallet=a.createCoinbaseWallet.bind(Object(m.a)(a)),a.createUser=a.createUser.bind(Object(m.a)(a)),a.otpBest\u00e4tigen=a.otpBest\u00e4tigen.bind(Object(m.a)(a)),a.otpInputHandler=a.otpInputHandler.bind(Object(m.a)(a)),a.setState1=a.setState1.bind(Object(m.a)(a)),a.setState6=a.setState6.bind(Object(m.a)(a)),a.sign=a.sign.bind(Object(m.a)(a)),a.state={otp:"",step:0,Token:""},a.tokenHandler=a.tokenHandler.bind(Object(m.a)(a)),a.verifyAddress=a.verifyAddress.bind(Object(m.a)(a)),a.walletLogin=a.walletLogin.bind(Object(m.a)(a)),a.walletVerbinden=a.walletVerbinden.bind(Object(m.a)(a)),a}return Object(h.a)(n,[{key:"componentDidMount",value:function(){this.init()}},{key:"init",value:function(){this.setState({walletAvailable:!!window.ethereum}),window.ethereum||(this.walletLink=new S.a({appName:"DHBW Bachelors Night Ticketing - 2020",appLogoUrl:"https://einfachtierisch.de/media/cache/article_teaser/cms/2015/09/Katze-lacht-in-die-Kamera-shutterstock-Foonia-76562038.jpg?595617",darkMode:!1}),window.ethereum=this.walletLink.makeWeb3Provider("https://mainnet.infura.io/v3/efaece4f5f4443979063839c124c8171",1)),this.setState({connected:!!window.ethereum.selectedAddress}),this.web3=new C.a(window.ethereum)}},{key:"otpInputHandler",value:function(e){this.setState({otp:e.target.value})}},{key:"tokenHandler",value:function(e){this.setState({Token:e.target.value})}},{key:"otpBest\xe4tigen",value:function(){console.log(this.state.otp),this.setState({step:2})}},{key:"createCoinbaseWallet",value:function(){window.open("https://wallet.coinbase.com/#signup","_blank")}},{key:"connectWallet",value:function(){var e=Object(u.a)(o.a.mark((function e(){var t;return o.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,window.ethereum.enable().catch(this.displayError);case 2:if(t=e.sent){e.next=5;break}return e.abrupt("return");case 5:console.log("User's address is ".concat(t[0])),this.setState({connected:!0}),this.setState({step:3});case 8:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"displayError",value:function(){alert("Ups, das hat leider nicht funktioniert. Bitte versuche es erneut.")}},{key:"verifyAddress",value:function(){var e=Object(u.a)(o.a.mark((function e(){var t,n,a,r=this;return o.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(window.ethereum){e.next=2;break}return e.abrupt("return",this.displayError());case 2:if(window.ethereum.selectedAddress){e.next=4;break}return e.abrupt("return",this.displayError());case 4:t=window.ethereum.selectedAddress,"Drei3333",n=this.web3.utils.stringToHex("Drei3333"),a=[n,t],"personal_sign",this.web3.currentProvider.send({method:"personal_sign",params:a,from:t},(function(e,a){if(e)return console.error(e);if(a.error)return console.error(a.error);console.log(a);var c=r.web3.eth.accounts.recover(n,a.result);c.toLowerCase()===t.toLowerCase()?(alert("Successfully ecRecovered signer as "+t),r.setState({step:4})):alert("Failed to verify signer when comparing "+c+" to "+t)}));case 10:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"createUser",value:function(){var e=Object(u.a)(o.a.mark((function e(){var t,n;return o.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,fetch("http://localhost:3000/auth/otpcreate/"+this.state.otp,{method:"POST",mode:"cors",cache:"no-cache",headers:{"Content-Type":"application/json"},body:JSON.stringify({address:window.ethereum.selectedAddress})}).catch(console.log);case 2:if(t=e.sent){e.next=6;break}return alert("Fehler"),e.abrupt("return");case 6:return e.next=8,t.json().catch(console.log);case 8:n=e.sent,console.log(n),this.setState({step:5});case 11:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"walletLogin",value:function(){var e=Object(u.a)(o.a.mark((function e(){var t,n;return o.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,fetch("http://localhost:3000/auth/login",{method:"POST",mode:"cors",cache:"no-cache",headers:{"Content-Type":"application/json"},body:JSON.stringify({address:window.ethereum.selectedAddress})}).catch(console.log);case 2:if(t=e.sent){e.next=6;break}return alert("Fehler!"),e.abrupt("return");case 6:return e.next=8,t.json().catch(console.log);case 8:n=e.sent,console.log(n),n.challenge?this.sign(n.challenge):alert("Ihre aktuelle Ethereum Adresse ist uns nicht bekannt. M\xf6glicherweise haben Sie noch kein Konto bei uns!");case 11:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"sign",value:function(){var e=Object(u.a)(o.a.mark((function e(t){var n,a,r,c,i=this;return o.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(window.ethereum){e.next=2;break}return e.abrupt("return",this.displayError());case 2:if(window.ethereum.selectedAddress){e.next=4;break}return e.abrupt("return",this.displayError());case 4:n=window.ethereum.selectedAddress,a=t,r=this.web3.utils.stringToHex(a),c=[r,n],"personal_sign",this.web3.currentProvider.send({method:"personal_sign",params:c,from:n},function(){var e=Object(u.a)(o.a.mark((function e(a,r){var c,s;return o.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!a){e.next=2;break}return e.abrupt("return",console.error(a));case 2:if(!r.error){e.next=4;break}return e.abrupt("return",console.error(r.error));case 4:return console.log(r),e.next=7,fetch("http://localhost:3000/auth/chr/"+t,{method:"POST",mode:"cors",cache:"no-cache",headers:{"Content-Type":"application/json"},body:JSON.stringify({address:n,signature:r.result})}).catch(console.log);case 7:if(c=e.sent){e.next=11;break}return alert("Fehler"),e.abrupt("return");case 11:return console.log(c),e.next=14,c.json().catch(console.log);case 14:if(s=e.sent,console.log(s),s){e.next=18;break}return e.abrupt("return");case 18:i.setToken(s.token);case 19:case"end":return e.stop()}}),e)})));return function(t,n){return e.apply(this,arguments)}}());case 10:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"setState1",value:function(){this.setState({step:1})}},{key:"setState6",value:function(){this.setState({step:6})}},{key:"walletVerbinden",value:function(){var e=Object(u.a)(o.a.mark((function e(){var t;return o.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,window.ethereum.enable().catch(this.displayError);case 2:if(t=e.sent){e.next=5;break}return e.abrupt("return");case 5:console.log("User's address is ".concat(t[0])),this.setState({connected:!0}),this.setState({step:6});case 8:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"setToken",value:function(e){localStorage.setItem("Tokenwert",e);var t=localStorage.getItem("Tokenwert");console.log(t)}},{key:"render",value:function(){var e=this;return r.a.createElement(p.a,{className:"AccountManagement",pad:"medium",gap:"small"},0===this.state.step&&r.a.createElement(p.a,{gap:"small"},r.a.createElement(E.a,null,"Klicke hier, um einen neuen Account anzulegen"),r.a.createElement(w.a,{label:"Neuen Account anlegen",gap:"small",onClick:this.setState1}),r.a.createElement(E.a,null,"Klicke hier, um dich mit einem bestehenden Account anzumelden"),r.a.createElement(w.a,{label:"Mit bestehendem Account anmelden",onClick:this.setState6})),1===this.state.step&&r.a.createElement(p.a,{gap:"small"},r.a.createElement(E.a,null,"Bitte geben Sie das OneTime-Passwort ein und best\xe4tigen Sie die Eingabe"),r.a.createElement(T.a,{placeholder:"OTP eingeben",value:this.state.otp,onChange:this.otpInputHandler}),r.a.createElement(w.a,{label:"Eingabe best\xe4tigen",onClick:this.otpBest\u00e4tigen})),2===this.state.step&&r.a.createElement(p.a,{classname:"WalletSetup",direction:"column",gap:"small"},r.a.createElement("h1",null,"Wallet Setup"),r.a.createElement(E.a,null,"Um Tickets zu erwerben ben\xf6tigen Sie ein sogenanntes Wallet. Dieses ist vergleichbar mit Ihrer Geldb\xf6rse zu der nur Sie Zugriff haben."),!this.state.walletAvailable&&!this.state.connected&&r.a.createElement(p.a,{gap:"small"},r.a.createElement(w.a,{label:"Wallet auf dem Smartphone erstellen",onClick:this.createCoinbaseWallet})),!this.state.connected&&r.a.createElement(p.a,{gap:"small"},r.a.createElement(E.a,null,"Als N\xe4chstes ben\xf6tigt unsere Plattform die Addresse Ihres Wallets. Bitte best\xe4tigen Sie daher die Verbindung mit Ihrem Wallet \xfcber folgende Schaltfl\xe4che.Sie geben dadurch ",r.a.createElement("b",null,"nicht")," Ihre Kontrolle \xfcber das Wallet ab! Nach einem Klick auf den Button muss mit Coinbase Wallet der angezeigte QR-Code eingescannt werden, um das Wallet zu \xfcberpr\xfcfen."),r.a.createElement(w.a,{label:"Mit vorhandenem Wallet anmelden",onClick:this.connectWallet})),this.state.walletAvailable&&this.state.connected&&r.a.createElement("p",null,"Test")),3===this.state.step&&r.a.createElement(p.a,{gap:"small"},r.a.createElement(E.a,null,"Ein Wallet wurde erfolgreich verbunden. Das Wallet muss anhand einer Testsignatur \xfcberpr\xfcft werden."),r.a.createElement(w.a,{label:"F\xfchre Testsignatur aus",onClick:this.verifyAddress})),4===this.state.step&&r.a.createElement(p.a,{gap:"small"},r.a.createElement(E.a,null,"Klicke auf den Button, um einen Benutzer zu erstellen."),r.a.createElement(w.a,{label:"Benutzer erstellen",onClick:this.createUser})),5===this.state.step&&r.a.createElement(p.a,{gap:"small"},r.a.createElement(E.a,null,"Der Benutzer wurde erfolgreich angelegt. Klicke auf den Button, um zur Anmeldung zu gelangen. "),r.a.createElement(w.a,{label:"Zur Anmeldung",onClick:this.setState6})),6===this.state.step&&r.a.createElement(p.a,{gap:"small"},r.a.createElement("h1",null,"Anmeldung mit einem vorhandenen Wallet"),!this.state.walletAvailable&&!this.state.connected&&r.a.createElement(p.a,{gap:"small"},r.a.createElement(E.a,null,"Es ist kein Wallet verf\xfcgbar. Bitte erstellen Sie ein Wallet und verbinden Sie dieses."),r.a.createElement(w.a,{label:"Wallet erstellen",onClick:this.createCoinbaseWallet})),!this.state.connected&&r.a.createElement(p.a,{gap:"small"},r.a.createElement(E.a,null,"Ihr Wallet scheint nicht verbunden zu sein. Bitte verbinden Sie das Wallet."),r.a.createElement(w.a,{label:"Wallet verbinden",onClick:this.walletVerbinden})),this.state.connected&&r.a.createElement(p.a,{gap:"small"},r.a.createElement(E.a,null,"Ein Wallet ist vorhanden und verbunden. Die Anmeldung ist m\xf6glich."),r.a.createElement(w.a,{label:"Anmeldung starten",onClick:this.walletLogin}))),888===this.state.step&&r.a.createElement(p.a,{gap:"small"},r.a.createElement("h1",null,"Willkommen bei Barry's Testgel\xe4nde"),r.a.createElement(T.a,{placeholder:"Test-Token eingeben",value:this.state.Token,onChange:this.tokenHandler}),r.a.createElement(w.a,{label:"Test",onClick:function(){e.setToken(e.state.Token)}})))}}]),n}(r.a.Component),M=n(660),W=n(654),I=function(e){Object(b.a)(n,e);var t=Object(f.a)(n);function n(e){return Object(d.a)(this,n),t.call(this,e)}return Object(h.a)(n,[{key:"render",value:function(){var e=[];this.props.tickets.forEach((function(t){e.push(r.a.createElement(p.a,{key:t.identifier,pad:"small"},r.a.createElement("span",null,"Ticket Identifier: ",t.identifier),r.a.createElement("span",null,"Nachname: ",t.surname),r.a.createElement("span",null,"Vorname: ",t.forename,"/"),r.a.createElement("span",null,"Ticket Typ: ",t.ticketType)))}));var t=this.props.booking,n="Buchungs-ID: "+t.id+" Account: "+t.user+" Buchungsdatum: "+t.dateBooked+" Bezahldatum: "+t.datePaid;return r.a.createElement(M.a,{label:n},r.a.createElement(E.a,{margin:"small"},"Folgende Tickets wurden gebucht:"),e)}}]),n}(r.a.Component),L=function(e){Object(b.a)(n,e);var t=Object(f.a)(n);function n(e){var a;return Object(d.a)(this,n),(a=t.call(this,e)).loadListHandler=a.loadListHandler.bind(Object(m.a)(a)),a.loadTicketsHandler=a.loadTicketsHandler.bind(Object(m.a)(a)),a.state={buchungen:[],tickets:[]},a}return Object(h.a)(n,[{key:"componentDidMount",value:function(){this.loadListHandler()}},{key:"loadListHandler",value:function(){var e=Object(u.a)(o.a.mark((function e(){var t,n;return o.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return this.setState({loading:!0}),e.next=3,fetch("http://localhost:3000/api/v1/users/0x1/bookings",{method:"GET",mode:"cors",cache:"no-cache",headers:{"Content-Type":"application/json",Authorization:"Bearer 43059960ead1db519cbbed4aa934462808262fa6204daefabcab4b0b38b667d61828556556e4b9e80b6a91e9990fc8704bbf399cdafd41b06ddc0c31a500accb94b96fa096bf8789c7c582f9e5df0ead8f23ef77a9b045ccbb78a60cd2401592e79b8c396cd4520297cfb0603011a7f373f9dbbc6a37527bd160b5e754850cbf8779a4c5049e816a9b9bee268e110baf53e901e80aa8df89d6a07b92cf33b581294bedc1b8da2c9a583845b13766f4c89abc9ac3466b69748a1ba0bf6a80a8c2b6aa6ec084c88c2cc4d212470089dbb9e4bce056c90e8a0ebaa5b9e563c80d20ac173b791769eac9d29c509810086f1700c7cec0071a03bb7aed67fec7215979"}}).catch(console.log);case 3:if(t=e.sent){e.next=6;break}return e.abrupt("return");case 6:return console.log(t),e.next=9,t.json().catch(console.log);case 9:if(n=e.sent){e.next=12;break}return e.abrupt("return");case 12:this.setState({buchungen:n,loading:!1});case 13:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"loadTicketsHandler",value:function(){var e=Object(u.a)(o.a.mark((function e(t){var n,a,r,c;return o.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(void 0!==t){e.next=2;break}return e.abrupt("return");case 2:if(n=this.state.buchungen[t].id,-1===this.state.tickets.findIndex((function(e){return e.booking===n}))){e.next=6;break}return e.abrupt("return");case 6:return e.next=8,fetch("http://localhost:3000/api/v1/bookings/"+n+"/ticketsBooked",{method:"GET",mode:"cors",cache:"no-cache",headers:{"Content-Type":"application/json",Authorization:"Bearer 43059960ead1db519cbbed4aa934462808262fa6204daefabcab4b0b38b667d61828556556e4b9e80b6a91e9990fc8704bbf399cdafd41b06ddc0c31a500accb94b96fa096bf8789c7c582f9e5df0ead8f23ef77a9b045ccbb78a60cd2401592e79b8c396cd4520297cfb0603011a7f373f9dbbc6a37527bd160b5e754850cbf8779a4c5049e816a9b9bee268e110baf53e901e80aa8df89d6a07b92cf33b581294bedc1b8da2c9a583845b13766f4c89abc9ac3466b69748a1ba0bf6a80a8c2b6aa6ec084c88c2cc4d212470089dbb9e4bce056c90e8a0ebaa5b9e563c80d20ac173b791769eac9d29c509810086f1700c7cec0071a03bb7aed67fec7215979"}}).catch(console.log);case 8:if(a=e.sent){e.next=11;break}return e.abrupt("return");case 11:return e.next=13,a.json().catch(console.log);case 13:if(r=e.sent){e.next=16;break}return e.abrupt("return");case 16:c=(c=this.state.tickets).concat(r),this.setState({tickets:c});case 19:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"render",value:function(){var e=this,t=[];return this.state.buchungen.forEach((function(n){var a=e.state.tickets.filter((function(e){return e.booking===n.id}));t.push(r.a.createElement(I,{key:n.id,booking:n,tickets:a}))})),r.a.createElement(p.a,{className:"BookingOverview",direction:"column",gap:"medium",pad:"medium"},r.a.createElement(p.a,null,this.state.loading&&r.a.createElement("p",{className:"loader"}),r.a.createElement(W.a,{onActive:function(t){e.loadTicketsHandler(t[0])}},t)))}}]),n}(r.a.Component),_=function(e){Object(b.a)(n,e);var t=Object(f.a)(n);function n(e){var a;return Object(d.a)(this,n),(a=t.call(this,e)).increment=function(e){"guest"===e&&a.state.guestcount<2?a.setState({guestcount:a.state.guestcount+1}):"park"===e&&a.state.parkcount<3&&a.setState({parkcount:a.state.parkcount+1})},a.decrement=function(e){"guest"===e&&a.state.guestcount>0?a.setState({guestcount:a.state.guestcount-1}):"park"===e&&a.state.parkcount>0&&a.setState({parkcount:a.state.parkcount-1})},a.WindowAbsolventTicket=a.WindowAbsolventTicket.bind(Object(m.a)(a)),a.WindowGuestTicket=a.WindowGuestTicket.bind(Object(m.a)(a)),a.WindowParkTicket=a.WindowParkTicket.bind(Object(m.a)(a)),a.ToOverview=a.ToOverview.bind(Object(m.a)(a)),a.ToPayment=a.ToPayment.bind(Object(m.a)(a)),a.state={guestcount:0,parkcount:0,step:0},a}return Object(h.a)(n,[{key:"WindowAbsolventTicket",value:function(){this.setState({step:0})}},{key:"WindowGuestTicket",value:function(){this.setState({step:1})}},{key:"WindowParkTicket",value:function(){this.setState({step:2})}},{key:"ToOverview",value:function(){this.setState({step:3})}},{key:"ToPayment",value:function(){this.setState({step:4})}},{key:"render",value:function(){var e=this;return r.a.createElement(p.a,{className:"TicketBestellung",direction:"column",gap:"medium",pad:"medium"},0===this.state.step&&r.a.createElement(p.a,{gap:"small"},"Klicke hier, um ein Absolvententicket zu kaufen.",r.a.createElement(w.a,{label:" Ein Absolventen Ticket kaufen",onClick:this.WindowGuestTicket,gap:"small"})),1===this.state.step&&r.a.createElement(p.a,{gap:"small"},r.a.createElement(E.a,null,"Bitte geben sie an, wie viele G\xe4ste Sie mitnehmen wollen."),r.a.createElement(w.a,{onClick:function(){return e.increment("guest")},className:"guestcount",label:"+"}),r.a.createElement(w.a,{onClick:function(){return e.decrement("guest")},className:"guestcount",label:"-"}),r.a.createElement("h2",null,this.state.guestcount),r.a.createElement(w.a,{onClick:this.WindowAbsolventTicket,label:"Zur\xfcck"}),r.a.createElement(w.a,{onClick:this.WindowParkTicket,label:"Weiter"})),2===this.state.step&&r.a.createElement(p.a,{gap:"small"},r.a.createElement(E.a,null,"Bitte geben sie an, wie viele Parktickets Sie ben\xf6tigen."),r.a.createElement(w.a,{onClick:function(){return e.increment("park")},className:"parkcount",label:"+"}),r.a.createElement(w.a,{onClick:function(){return e.decrement("park")},className:"parkcount",label:"-"}),r.a.createElement("h2",null,this.state.parkcount),r.a.createElement(w.a,{onClick:this.WindowGuestTicket,label:"Zur\xfcck"}),r.a.createElement(w.a,{onClick:this.ToOverview,label:"Weiter"})),3===this.state.step&&r.a.createElement(p.a,{gap:"small"},r.a.createElement(E.a,null,"Sie haben folgendes bestellt: ",r.a.createElement("br",null),"Absolvententicket 1 ",r.a.createElement("br",null),"G\xe4steticket ",this.state.guestcount," ",r.a.createElement("br",null),"Parkticket ",this.state.parkcount),r.a.createElement(w.a,{onClick:this.WindowParkTicket,label:"Zur\xfcck"}),r.a.createElement(w.a,{onClick:this.ToPayment,label:"Zahlungspflichtig bestellen"})),4===this.state.step&&r.a.createElement(p.a,{gap:"small"},r.a.createElement(E.a,null,"Sie haben folgende Tickets Zahlungspflichtig bestellt.  ",r.a.createElement("br",null),"Bitte \xfcberweisen Sie folgenden Betrag auf das Konto: XXXXYYYYZZZZ.",r.a.createElement("br",null),"Geben Sie ihren Namen als Verwendungszweck an.",r.a.createElement("br",null),"Nach Rechnungseingang erhalten Sie Ihre Tickets an ihr Wallet gesendet.",r.a.createElement("br",null)),r.a.createElement(E.a,null,"Sie haben folgendes bestellt: ",r.a.createElement("br",null),"Absolvententicket 1 ",r.a.createElement("br",null),"G\xe4steticket ",this.state.guestcount," ",r.a.createElement("br",null),"Parkticket ",this.state.parkcount)))}}]),n}(r.a.Component),P=function(e){Object(b.a)(n,e);var t=Object(f.a)(n);function n(e){var a;return Object(d.a)(this,n),(a=t.call(this,e)).state={},a}return Object(h.a)(n,[{key:"render",value:function(){return r.a.createElement(p.a,{className:"Guest"},r.a.createElement(k.a,{background:"brand",justify:"between",pad:"10px"},r.a.createElement(s.b,{to:"/guest"},"Home"),r.a.createElement(v.a,{label:"Account",items:[{label:"Logout"}]})),r.a.createElement(g.c,null,r.a.createElement(g.a,{path:"/guest/ticketbestellen"},r.a.createElement(_,null)),r.a.createElement(g.a,{path:"/guest/tickets/"},r.a.createElement(N,null)),r.a.createElement(g.a,{path:"/guest/setup"},r.a.createElement(B,null)),r.a.createElement(g.a,{path:"/guest/demosetup"},r.a.createElement(x,null)),r.a.createElement(g.a,{path:"/guest/bestellungsuebersicht"},r.a.createElement(L,null)),r.a.createElement(g.a,{path:"/guest/"},r.a.createElement(j,null))))}}]),n}(r.a.Component),U=n(327),z=n(325),G=n.n(z),V=function(e){Object(b.a)(n,e);var t=Object(f.a)(n);function n(e){var a;return Object(d.a)(this,n),(a=t.call(this,e)).state={},a.video=r.a.createRef(),a.canvasElement=r.a.createRef(),a.startScan=a.startScan.bind(Object(m.a)(a)),a.tick=a.tick.bind(Object(m.a)(a)),a}return Object(h.a)(n,[{key:"componentWillUnmount",value:function(){this.stopScan()}},{key:"tick",value:function(){if(this.video&&this.video.current){if(this.video.current.readyState===this.video.current.HAVE_ENOUGH_DATA){this.canvasElement.current.height=320,this.canvasElement.current.width=320,this.canvas.drawImage(this.video.current,0,0,this.canvasElement.current.width,this.canvasElement.current.height);var e=this.canvas.getImageData(0,0,this.canvasElement.current.width,this.canvasElement.current.height),t=G()(e.data,e.width,e.height,{inversionAttempts:"dontInvert"});if(t)switch(this.props.contentType){case"ETHEREUM_ADDRESS":var n=t.data.match(Object(U.a)(/(?:ethereum:)(0x[0-9A-Za-z]*)/,{address:1}));if(n&&n.groups.address)return this.stopScan(),void this.props.onDone(n.groups.address);break;case"ETHEREUM_SIGNATURE":case"IP_ADDRESS":case"JSON_DATA":break;default:return this.stopScan(),void this.props.onDone(t.data)}}requestAnimationFrame(this.tick)}}},{key:"startScan",value:function(){var e=this;if(!navigator.mediaDevices)return alert("Der Browser unterst\xfctzt diese Funktion nicht.");navigator.mediaDevices.getUserMedia({video:{facingMode:"environment",width:320,height:320}}).then((function(t){e.canvas=e.canvasElement.current.getContext("2d"),e.video.current.srcObject=t,e.video.current.setAttribute("playsinline",!0),e.video.current.play(),requestAnimationFrame(e.tick),e.setState({isScanning:!0})})).catch((function(e){console.error(e),alert("Sorry, Kamera-Stream konnte nicht geladen werden.")}))}},{key:"stopScan",value:function(){this.video&&this.video.current&&this.video.current.srcObject&&(this.video.current.srcObject.getVideoTracks()[0].stop(),this.setState({isScanning:!1}))}},{key:"render",value:function(){return r.a.createElement(p.a,{className:"QRScanner"},r.a.createElement("div",null,r.a.createElement("canvas",{ref:this.canvasElement,hidden:!this.state.isScanning}),r.a.createElement("video",{ref:this.video,hidden:!0})),!this.state.isScanning&&r.a.createElement(w.a,{label:this.props.label||"Scan",onClick:this.startScan}))}}]),n}(r.a.Component),F=(n(634),function(e){Object(b.a)(n,e);var t=Object(f.a)(n);function n(e){var a;return Object(d.a)(this,n),(a=t.call(this,e)).state={},a}return Object(h.a)(n,[{key:"render",value:function(){return r.a.createElement("div",{className:"dialog"},r.a.createElement("div",{className:"dialog-background-box"}),r.a.createElement("div",{className:"dialog-center"},r.a.createElement("div",{className:"dialog-content"},r.a.createElement("div",{className:"dialog-header"},r.a.createElement("h1",null,this.props.title),r.a.createElement(w.a,{className:"abort",onClick:this.props.onAbort},"X")),r.a.createElement("div",{className:"dialog-body"},this.props.children))))}}]),n}(r.a.Component)),q=(n(308),function(){function e(){Object(d.a)(this,e),this._iceCandidatesHandler=this._iceCandidatesHandler.bind(this),this._dataChannelOpenHandler=this._dataChannelOpenHandler.bind(this),this._receiveChannelHandler=this._receiveChannelHandler.bind(this),this._dataChannelClosedHandler=this._dataChannelClosedHandler.bind(this),this._connectionChangeHandler=this._connectionChangeHandler.bind(this),this._generateAnswer=this._generateAnswer.bind(this),this.requestMap=new Map,this.icecandidates=[],this.remoteICECandidates=[],this.onConnectionChanged=function(e){},this._initConnection()}return Object(h.a)(e,[{key:"_initConnection",value:function(){var e=Object(u.a)(o.a.mark((function e(){return o.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:null,this.localPeerConnection=new RTCPeerConnection(null),this.localPeerConnection.addEventListener("icecandidate",this._iceCandidatesHandler),this.localPeerConnection.addEventListener("connectionstatechange",this._connectionChangeHandler),this.localPeerConnection.addEventListener("datachannel",this._receiveChannelHandler);case 5:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"_iceCandidatesHandler",value:function(e){this.icecandidates.push(e.candidate),this.answer&&!this.qrcode&&setTimeout(this._generateAnswer,200)}},{key:"_connectionChangeHandler",value:function(e){console.debug(e);var t=e.target.connectionState;this.onConnectionChanged(t)}},{key:"_dataChannelOpenHandler",value:function(e){console.debug(e),this.onReady()}},{key:"_dataChannelClosedHandler",value:function(e){console.debug(e)}},{key:"_messageHandler",value:function(e){console.debug(e.data),alert(e.data)}},{key:"_receiveChannelHandler",value:function(e){this.dataChannel=e.channel,this.dataChannel.addEventListener("message",this._messageHandler),this.dataChannel.addEventListener("open",this._dataChannelOpenHandler),this.dataChannel.addEventListener("close",this._dataChannelClosedHandler)}},{key:"_createUUID",value:function(){var e=(new Date).getTime();return"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,(function(t){var n=(e+16*Math.random())%16|0;return e=Math.floor(e/16),("x"===t?n:0&n).toString(16)}))}},{key:"readTicketRemote",value:function(e){var t=this;return new Promise((function(n,a){var r=t._createUUID();t.requestMap.set(r,{resolve:n,reject:a});var c={type:"Request",reqId:r,context:"ticketMirror",method:"getTicket",params:[e]};try{t.dataChannel.send(JSON.stringify(c))}catch(i){a(i)}}))}},{key:"obliterateTicketRemote",value:function(e,t){var n=this;return new Promise((function(a,r){var c=n._createUUID();n.requestMap.set(c,{resolve:a,reject:r});var i={type:"Request",reqId:c,context:"ticketMirror",method:"obliterateTicket",params:[e,t]};try{n.dataChannel.send(JSON.stringify(i))}catch(s){r(s)}}))}},{key:"setMasterConfig",value:function(){var e=Object(u.a)(o.a.mark((function e(t){var n=this;return o.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.localPeerConnection.setRemoteDescription(new RTCSessionDescription(t.offer)).catch(console.error);case 2:return t.candidates.forEach((function(e){n.localPeerConnection.addIceCandidate(e).catch(console.error),n.remoteICECandidates.push(e)})),e.next=5,this.localPeerConnection.createAnswer().catch(console.error);case 5:return this.answer=e.sent,e.next=8,this.localPeerConnection.setLocalDescription(this.answer).catch(console.error);case 8:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"_generateAnswer",value:function(){var e={answer:this.answer,candidates:this.icecandidates};this.onAnswer(e)}},{key:"toJSON",value:function(){var e={localDescription:this.localPeerConnection.currentLocalDescription,remoteDescription:this.localPeerConnection.currentRemoteDescription,candidates:this.remoteICECandidates};return JSON.stringify(e)}}]),e}()),J=n(117),K=n.n(J),Q=function(e){Object(b.a)(n,e);var t=Object(f.a)(n);function n(e){var a;return Object(d.a)(this,n),(a=t.call(this,e)).state={connected:null},a.connectTicketReader=a.connectTicketReader.bind(Object(m.a)(a)),a.scanDoneHandler=a.scanDoneHandler.bind(Object(m.a)(a)),a.ticketReader=null,a}return Object(h.a)(n,[{key:"connectTicketReader",value:function(){var e=this,t=new q;t.onReady=function(){e.ticketReader=e.state.connectTR,e.setState({connectTR:null})},t.onConnectionChanged=function(t){switch(t){case"connected":case"disconnected":case"failed":case"closed":e.setState({connected:t})}},t.onAnswer=function(){var t=Object(u.a)(o.a.mark((function t(n){var a,r;return o.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return a=K.a.deflate(JSON.stringify(n),{level:9,to:"string"}),t.next=3,D.a.toDataURL(a).catch(console.error);case 3:r=t.sent,e.setState({TRQRCode:r,connectTRStep:1});case 5:case"end":return t.stop()}}),t)})));return function(e){return t.apply(this,arguments)}}(),this.setState({connectTR:t,connectTRStep:0})}},{key:"scanDoneHandler",value:function(e){var t=JSON.parse(K.a.inflate(e,{to:"string"}));this.state.connectTR.setMasterConfig(t)}},{key:"render",value:function(){var e=this;return r.a.createElement(p.a,{className:"EntranceManagement",pad:"medium"},!this.state.connected&&r.a.createElement(p.a,null,r.a.createElement("p",null,"Wenn Sie dieses Ger\xe4t als Ticket Leser verwenden m\xf6chten, m\xfcssen Sie es erst mit dem Event-Manager verbinden."),r.a.createElement("p",null,"Bitte stellen Sie sicher, dass dieses Ger\xe4t mit dem selben lokalen Netzwerk, wie der Event-Manager verbunden ist."),r.a.createElement(w.a,{onClick:this.connectTicketReader,label:"Ticket Reader Aktivieren"}),this.state.connectTR&&r.a.createElement(F,{title:"Als Ticket Reader verbinden",onAbort:function(){e.setState({connectTR:null})}},0===this.state.connectTRStep&&r.a.createElement("div",null,r.a.createElement("div",{className:"scanner"},r.a.createElement(V,{onDone:this.scanDoneHandler,label:"Scanvorgang starten"})),r.a.createElement("div",{className:"description"},r.a.createElement("p",null,"Bitte den Code des Initiators scannen"))),1===this.state.connectTRStep&&r.a.createElement("div",null,r.a.createElement("div",{className:"qrcode"},!this.state.TRQRCode&&r.a.createElement("div",{className:"loader"},"Loading..."),this.state.TRQRCode&&r.a.createElement("img",{src:this.state.TRQRCode,width:"100%",alt:"Ein QR-Code sollte hier angezeigt werden."})),r.a.createElement("div",{className:"description"},r.a.createElement("p",null,"Bitte nun mit dem Initiator Ger\xe4t scannen"))))),"connected"===this.state.connected&&r.a.createElement(g.c,null,r.a.createElement(g.a,{path:"/entrance/"},r.a.createElement("p",null,"Wunderbar, Sie sind verbunden..."),r.a.createElement("p",null,"In Zukunft sollten hier Funktionen zum Ticket-Scan stehen..."),r.a.createElement(w.a,{label:"Lese ein Beispiel Ticket",onClick:function(){e.ticketReader.readTicketRemote("2537f4c1-2bfa-416f-9098-9b61fe4bb59d")}}),r.a.createElement(w.a,{label:"Entwerte Ticket",onClick:function(){e.ticketReader.obliterateTicketRemote(123,"signature")}}),r.a.createElement(w.a,{label:"Beispiel Funktion 3"}))),"disconnected"===this.state.connected&&r.a.createElement(g.c,null,r.a.createElement(g.a,{path:"/entrance/"},r.a.createElement("p",null,"Die Verbindung wurde unterbrochen!"),r.a.createElement("p",null,"Bitte warten Sie einen Moment..."))),"failed"===this.state.connected&&r.a.createElement(g.c,null,r.a.createElement(g.a,{path:"/entrance/"},r.a.createElement("p",null,"Die Verbindung wurde unterbrochen!"),r.a.createElement("p",null,"Bitte aktivieren Sie den Reader erneut."),r.a.createElement(w.a,{onClick:function(){e.setState({connected:null}),e.connectTicketReader()},label:"Ticket Reader Aktivieren"}))))}}]),n}(r.a.Component),Z=function(){function e(){if(Object(d.a)(this,e),this._createDB=this._createDB.bind(this),this.dumpTicketMirror=this.dumpTicketMirror.bind(this),this.getTicketList=this.getTicketList.bind(this),!window.indexedDB)throw Error("Your browser doesn't support a stable version of IndexedDB. Such and such feature will not be available.");this.waitingForIDBReadyQueue=[],this._initDB()}return Object(h.a)(e,[{key:"_initDB",value:function(){var e=this;console.debug("Initializing IDB Connection");var t=window.indexedDB.open("TicketMirror",1);t.addEventListener("upgradeneeded",this._createDB),t.addEventListener("success",(function(t){console.debug("IDB Connection established"),e.db=t.target.result,e.waitingForIDBReadyQueue.forEach((function(t){t(e.db)}))})),t.addEventListener("error",(function(e){console.error("Database error: "+e.target.errorCode)}))}},{key:"_createDB",value:function(e){this.db=e.target.result,this.db.createObjectStore("tickets",{keyPath:"identifier"})}},{key:"_getIDB",value:function(){var e=this;return new Promise((function(t){e.db?t(e.db):e.waitingForIDBReadyQueue.push(t)}))}},{key:"dumpTicketMirror",value:function(){var e=Object(u.a)(o.a.mark((function e(){var t,n;return o.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this._getIDB().catch(console.error);case 2:if(t=e.sent){e.next=5;break}return e.abrupt("return");case 5:n=t.transaction("tickets","readwrite").objectStore("tickets"),[{identifier:"ca6c9409-0ec9-42fb-9ca7-d42a74642d7e",isValid:!0,isUsed:!1,ticketType:"Parken"},{identifier:"cea4b540-63a4-4abd-9a9a-499bb3879b8c",isValid:!1,isUsed:!0,ticketType:"Begleitperson"},{identifier:"2537f4c1-2bfa-416f-9098-9b61fe4bb59d",isValid:!0,isUsed:!1,ticketType:"Begleitperson"},{identifier:"c3573a44-f9e8-4772-bf80-57d1d07239c8",isValid:!0,isUsed:!0,ticketType:"Begleitperson"},{identifier:"5506d14d-8090-411a-897c-3f6c898ec8d2",isValid:!0,isUsed:!0,ticketType:"Begleitperson"}].forEach((function(e){n.add(e)}));case 8:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"getTicketList",value:function(){var e=this;return new Promise(function(){var t=Object(u.a)(o.a.mark((function t(n,a){var r,c,i;return o.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,e._getIDB().catch(console.error);case 2:if(r=t.sent){t.next=5;break}return t.abrupt("return",a());case 5:c=r.transaction("tickets","readonly").objectStore("tickets"),(i=c.getAll()).onerror=a,i.onsuccess=function(e){var t=e.target.result;return n(t)};case 9:case"end":return t.stop()}}),t)})));return function(e,n){return t.apply(this,arguments)}}())}},{key:"getTicket",value:function(e){var t=this;return new Promise(function(){var n=Object(u.a)(o.a.mark((function n(a,r){var c,i,s;return o.a.wrap((function(n){for(;;)switch(n.prev=n.next){case 0:return n.next=2,t._getIDB().catch(console.error);case 2:if(c=n.sent){n.next=5;break}return n.abrupt("return",r());case 5:i=c.transaction("tickets","readonly").objectStore("tickets"),(s=i.get(e)).onerror=r,s.onsuccess=function(e){var t=e.target.result;return t?a(t):r("Ticket does not exist.")};case 9:case"end":return n.stop()}}),n)})));return function(e,t){return n.apply(this,arguments)}}())}},{key:"obliterateTicket",value:function(e,t){var n=this;return new Promise(function(){var t=Object(u.a)(o.a.mark((function t(a,r){var c,i,s;return o.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,n._getIDB().catch(console.error);case 2:if(c=t.sent){t.next=5;break}return t.abrupt("return",r());case 5:i=c.transaction("tickets","readwrite").objectStore("tickets"),(s=i.get(e)).onerror=r,s.onsuccess=function(e){var t=e.target.result;if(!t)return r("Ticket does not exist.");if(!t.isValid)return r("Ticket is not valid.");if(t.isUsed)return r("Ticket was already used.");t.isUsed=!0;var n=i.put(t);n.onerror=r,n.onsuccess=a};case 9:case"end":return t.stop()}}),t)})));return function(e,n){return t.apply(this,arguments)}}())}}]),e}(),X=function(e){Object(b.a)(n,e);var t=Object(f.a)(n);function n(e){var a;if(Object(d.a)(this,n),(a=t.call(this,e)).state={tickets:[]},a.handleDumpMirror=a.handleDumpMirror.bind(Object(m.a)(a)),a.showTickets=a.showTickets.bind(Object(m.a)(a)),!a.props.localTicketMirror)throw new Error("Missing LocalTicketMirror");return a.showTickets(),a}return Object(h.a)(n,[{key:"handleDumpMirror",value:function(){this.props.localTicketMirror.dumpTicketMirror(),this.showTickets()}},{key:"showTickets",value:function(){var e=Object(u.a)(o.a.mark((function e(){var t,n;return o.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t=this.props.localTicketMirror,e.next=3,t.getTicketList().catch(console.error);case 3:if(n=e.sent){e.next=6;break}return e.abrupt("return");case 6:this.setState({tickets:n});case 7:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"render",value:function(){var e=this.state.tickets.map((function(e){return r.a.createElement("li",{key:e.identifier},e.isValid&&"Valid",!e.isValid&&"Not Valid"," -  ",e.isUsed&&"Used",!e.isUsed&&"Not Used"," - ",e.ticketType)}));return r.a.createElement(p.a,{className:"IndexedDBExample",pad:"medium"},r.a.createElement("ul",null,e),r.a.createElement(w.a,{label:"Dump Mirror",onClick:this.handleDumpMirror}))}}]),n}(r.a.Component),Y=function(){function e(){Object(d.a)(this,e),this.iceCandidatesHandler=this.iceCandidatesHandler.bind(this),this.dataChannelOpenHandler=this.dataChannelOpenHandler.bind(this),this.generateOfferCode=this.generateOfferCode.bind(this),this.dataChannelClosedHandler=this.dataChannelClosedHandler.bind(this),this.connectionChangeHandler=this.connectionChangeHandler.bind(this),this.setTicketReaderConfig=this.setTicketReaderConfig.bind(this),this.messageHandler=this.messageHandler.bind(this),this.uuid=this.createUUID(),this.onConnectionChanged=function(e){},this.onReady=function(){},this.onOffer=function(e){},this.onGetTicket=function(e,t){},this.onObliterateTicket=function(e,t,n){},this.initConnection()}return Object(h.a)(e,[{key:"initConnection",value:function(){this.icecandidates=[],this.localPeerConnection=new RTCPeerConnection(null),this.localPeerConnection.addEventListener("icecandidate",this.iceCandidatesHandler),this.localPeerConnection.addEventListener("connectionstatechange",this.connectionChangeHandler),this.dataChannel=this.localPeerConnection.createDataChannel("sendDataChannel",null),this.dataChannel.addEventListener("message",this.messageHandler),this.dataChannel.addEventListener("open",this.dataChannelOpenHandler),this.dataChannel.addEventListener("close",this.dataChannelClosedHandler),this.createOffer()}},{key:"iceCandidatesHandler",value:function(e){this.icecandidates.push(e.candidate),this.offer&&!this.qrcode&&setTimeout(this.generateOfferCode,200)}},{key:"connectionChangeHandler",value:function(e){console.debug(e);var t=e.target.connectionState;this.onConnectionChanged(t)}},{key:"dataChannelOpenHandler",value:function(e){console.debug(e),this.onReady(),this.dataChannel.send("Hallo Client!")}},{key:"dataChannelClosedHandler",value:function(e){console.debug("Data Channel Closed",e)}},{key:"messageHandler",value:function(e){var t,n=this;console.debug("Message received:",e.data);try{t=JSON.parse(e.data)}catch(a){return console.error(a),void console.debug("Message was:",e.data)}switch(t.context){case"ticketMirror":"getTicket"===t.method?this.onGetTicket(t.params[0],(function(e,a){var r={reqId:t.reqId,result:{ticket:e,errorMessage:a}};try{n.dataChannel.send(JSON.stringify(r))}catch(c){console.error(c)}})):"obliterateTicket"===t.method&&this.onObliterateTicket(t.params[0],t.params[1],(function(e,a){var r={reqId:t.reqId,result:{success:e,errorMessage:a}};try{n.dataChannel.send(JSON.stringify(r))}catch(c){console.error(c)}}))}}},{key:"createUUID",value:function(){var e=(new Date).getTime();return"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,(function(t){var n=(e+16*Math.random())%16|0;return e=Math.floor(e/16),("x"===t?n:0&n).toString(16)}))}},{key:"createOffer",value:function(){var e=Object(u.a)(o.a.mark((function e(){return o.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.localPeerConnection.createOffer().catch(console.error);case 2:return this.offer=e.sent,e.next=5,this.localPeerConnection.setLocalDescription(this.offer).catch(console.error);case 5:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"generateOfferCode",value:function(){var e=Object(u.a)(o.a.mark((function e(){var t;return o.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:t={offer:this.offer,candidates:this.icecandidates},this.onOffer(t);case 2:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"setTicketReaderConfig",value:function(){var e=Object(u.a)(o.a.mark((function e(t){var n=this;return o.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.localPeerConnection.setRemoteDescription(new RTCSessionDescription(t.answer)).catch(this.handleError);case 2:t.candidates.forEach((function(e){n.localPeerConnection.addIceCandidate(e).catch(n.handleError)}));case 3:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()}]),e}(),$=function(e){Object(b.a)(n,e);var t=Object(f.a)(n);function n(e){var a;return Object(d.a)(this,n),(a=t.call(this,e)).state={},a.connectRemoteTicketReader=a.connectRemoteTicketReader.bind(Object(m.a)(a)),a.scanDoneHandler=a.scanDoneHandler.bind(Object(m.a)(a)),a}return Object(h.a)(n,[{key:"scanDoneHandler",value:function(e){var t=JSON.parse(K.a.inflate(e,{to:"string"}));this.state.connectRTR.setTicketReaderConfig(t)}},{key:"connectRemoteTicketReader",value:function(){var e=this,t=new Y;t.onReady=function(){e.setState({connectRTR:null}),e.props.onRTR(t)},t.onOffer=function(){var t=Object(u.a)(o.a.mark((function t(n){var a,r;return o.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return a=K.a.deflate(JSON.stringify(n),{level:9,to:"string"}),t.next=3,D.a.toDataURL(a).catch(console.error);case 3:r=t.sent,e.setState({RTRQRCode:r});case 5:case"end":return t.stop()}}),t)})));return function(e){return t.apply(this,arguments)}}(),this.setState({connectRTR:t,addRTRStep:0})}},{key:"disconnectRemoteTicketReader",value:function(e){}},{key:"disconnectAll",value:function(){}},{key:"render",value:function(){var e=this;return r.a.createElement(p.a,{className:"TicketReaderManager",pad:"medium"},r.a.createElement("p",null,"Derzeit sind ",this.props.RTRList.length," Ticket Leser verbunden."),r.a.createElement(w.a,{onClick:this.connectRemoteTicketReader,label:"Ticket Leser Hinzuf\xfcgen"}),this.state.connectRTR&&r.a.createElement(F,{title:"Remote Ticket Reader Hinzuf\xfcgen",onAbort:function(){e.setState({connectRTR:null})}},0===this.state.addRTRStep&&r.a.createElement("div",null,r.a.createElement("div",{className:"ticket-reader-qrcode"},!this.state.RTRQRCode&&r.a.createElement("div",{className:"loader"},"Loading..."),this.state.RTRQRCode&&r.a.createElement("img",{src:this.state.RTRQRCode,width:"100%",alt:"Ein QR-Code sollte hier angezeigt werden."})),r.a.createElement("div",{className:"ticket-reader-description"},r.a.createElement("p",null,"Bitte mit dem Zielger\xe4t scannen")),r.a.createElement("div",{className:"ticket-reader-action"},r.a.createElement(w.a,{onClick:function(){e.setState({addRTRStep:1})},label:"Weiter"}))),1===this.state.addRTRStep&&r.a.createElement("div",null,r.a.createElement("div",{className:"ticket-reader-scanner"},r.a.createElement(V,{onDone:this.scanDoneHandler,label:"Scanvorgang starten"})),r.a.createElement("div",{className:"ticket-reader-description"},r.a.createElement("p",null,"Bitte nun den Code des Zielger\xe4ts scannen")))))}}]),n}(r.a.Component),ee=n(658),te=(r.a.Component,function(e){Object(b.a)(n,e);var t=Object(f.a)(n);function n(e){var a;return Object(d.a)(this,n),(a=t.call(this,e)).state={dateiTyp:"CSV"},a}return Object(h.a)(n,[{key:"render",value:function(){var e=this;return r.a.createElement(p.a,{className:"SystemInitalisierung",direction:"column",gap:"medium",pad:"medium"},r.a.createElement(p.a,{className:"Auswahlmen\xfc"},r.a.createElement(ee.a,{options:["CSV","XLSX"],value:this.state.dateiTyp,onChange:function(t){t.value;var n=t.option;e.setState({dateiTyp:n})}})))}}]),n}(r.a.Component)),ne=function(e){Object(b.a)(n,e);var t=Object(f.a)(n);function n(e){var a;return Object(d.a)(this,n),(a=t.call(this,e)).rTRHandler=a.rTRHandler.bind(Object(m.a)(a)),a.localTicketMirror=new Z,a.state={RTRList:[]},a}return Object(h.a)(n,[{key:"rTRHandler",value:function(e){var t=this,n=this.state.RTRList;n.push(e),this.setState({RTRList:n}),e.onConnectionChanged=function(e){console.log(e)},e.onGetTicket=function(e,n){t.localTicketMirror.getTicket(e).then((function(e){n(e)})).catch((function(e){n(null,e)}))},e.onObliterateTicket=function(e,t,n){n(!0)}}},{key:"render",value:function(){return r.a.createElement(p.a,{className:"EventManagement"},r.a.createElement("ul",null,r.a.createElement("li",null,r.a.createElement(s.b,{to:"/eventmgmt/rtrm"},"Manage Remote Ticket Readers")),r.a.createElement("li",null,r.a.createElement(s.b,{to:"/eventmgmt/entrancedb"},"Show Entrance Dashboard")),r.a.createElement("li",null,r.a.createElement(s.b,{to:"/eventmgmt/ticketshop"},"Manage Ticketshop")),r.a.createElement("li",null,r.a.createElement(s.b,{to:"/eventmgmt/SystemInitalisierung"},"System Initalisieren"))),r.a.createElement(g.c,null,r.a.createElement(g.a,{path:"/eventmgmt/rtrm"},r.a.createElement($,{RTRList:this.state.RTRList,onRTR:this.rTRHandler})),r.a.createElement(g.a,{path:"/eventmgmt/entrancedb"},r.a.createElement(X,{localTicketMirror:this.localTicketMirror})),r.a.createElement(g.a,{path:"/eventmgmt/SystemInitalisierung"},r.a.createElement(te,null)),r.a.createElement(g.a,{path:"/eventmgmt/ticketshop"},r.a.createElement(p.a,{pad:"medium"},"Hier m\xfcsste dann sowas wie ein Ticketshop Management Dashboard hin..."))))}}]),n}(r.a.Component),ae=n(659),re=n(656),ce=function(e){Object(b.a)(n,e);var t=Object(f.a)(n);function n(e){var a;return Object(d.a)(this,n),(a=t.call(this,e)).state={account:null},a.scanDoneHandler=a.scanDoneHandler.bind(Object(m.a)(a)),a.obliterateTokens=a.obliterateTokens.bind(Object(m.a)(a)),a}return Object(h.a)(n,[{key:"errorDisplay",value:function(e){alert("Sorry, there was an error. Please try again.")}},{key:"scanDoneHandler",value:function(e){var t=this;this.getAccountDetails(e).then((function(n){if(!n.verified)return alert("Account nicht f\xfcr TBN-Nutzung verifiziert");t.getAccountBalance(e).then((function(a){var r=t.state;r.account={address:e,balance:a,verified:n.verified,paidTickets:n.paidTickets,poolTickets:n.poolTickets,parkTickets:n.parkTickets},t.setState(r)}))}))}},{key:"getAccountBalance",value:function(){var e=Object(u.a)(o.a.mark((function e(t){var n,a;return o.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,fetch("http://localhost:3000/balanceOf?address="+t,{method:"GET",mode:"cors",cache:"no-cache"}).catch(this.errorDisplay);case 2:return n=e.sent,e.next=5,n.json().catch(this.errorDisplay);case 5:return a=e.sent,e.abrupt("return",a);case 7:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"getAccountDetails",value:function(){var e=Object(u.a)(o.a.mark((function e(t){var n,a;return o.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,fetch("http://localhost:3000/accountDetails?address="+t,{method:"GET",mode:"cors",cache:"no-cache"}).catch(this.errorDisplay);case 2:return n=e.sent,e.next=5,n.json().catch(this.errorDisplay);case 5:return a=e.sent,e.abrupt("return",a);case 7:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"obliterateTokens",value:function(e){var t=this;return new Promise((function(e,n){setTimeout((function(){e("\xdcbertragen"),t.scanDoneHandler(null)}),3e3)}))}},{key:"render",value:function(){return r.a.createElement(ae.a,{theme:re.a},r.a.createElement(g.c,null,r.a.createElement(g.a,{exact:!0,path:"/"},r.a.createElement("ul",null,r.a.createElement("li",null,r.a.createElement(s.b,{to:"/guest"},"Gast")),r.a.createElement("li",null,r.a.createElement(s.b,{to:"/entrance"},"Einlass-Management")),r.a.createElement("li",null,r.a.createElement(s.b,{to:"/eventmgmt"},"Event-Management"))))),r.a.createElement(g.c,null,r.a.createElement(g.a,{path:"/guest"},r.a.createElement(P,{eigenschaft1:"test"})),r.a.createElement(g.a,{path:"/entrance"},r.a.createElement(Q,null)),r.a.createElement(g.a,{path:"/eventmgmt"},r.a.createElement(ne,null))))}}]),n}(r.a.Component);Boolean("localhost"===window.location.hostname||"[::1]"===window.location.hostname||window.location.hostname.match(/^127(?:\.(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)){3}$/));i.a.render(r.a.createElement(s.a,null,r.a.createElement(ce,null)),document.getElementById("root")),"serviceWorker"in navigator&&navigator.serviceWorker.ready.then((function(e){e.unregister()}))}},[[333,1,2]]]);
//# sourceMappingURL=main.7e2e41df.chunk.js.map